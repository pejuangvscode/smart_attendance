<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/build.gradle.kts">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/build.gradle.kts" />
              <option name="originalContent" value="plugins {&#10;    alias(libs.plugins.android.application)&#10;    alias(libs.plugins.kotlin.android)&#10;    alias(libs.plugins.kotlin.compose)&#10;    kotlin(&quot;plugin.serialization&quot;) version &quot;2.0.21&quot;&#10;}&#10;&#10;android {&#10;    namespace = &quot;com.example.smartattendance&quot;&#10;    compileSdk = 36&#10;&#10;    defaultConfig {&#10;        applicationId = &quot;com.example.smartattendance&quot;&#10;        minSdk = 26&#10;        targetSdk = 34&#10;        versionCode = 1&#10;        versionName = &quot;1.0&quot;&#10;&#10;        testInstrumentationRunner = &quot;androidx.test.runner.AndroidJUnitRunner&quot;&#10;    }&#10;&#10;    buildTypes {&#10;        release {&#10;            isMinifyEnabled = false&#10;            proguardFiles(&#10;                getDefaultProguardFile(&quot;proguard-android-optimize.txt&quot;),&#10;                &quot;proguard-rules.pro&quot;&#10;            )&#10;        }&#10;    }&#10;    compileOptions {&#10;        sourceCompatibility = JavaVersion.VERSION_1_8&#10;        targetCompatibility = JavaVersion.VERSION_1_8&#10;    }&#10;    kotlinOptions {&#10;        jvmTarget = &quot;1.8&quot;&#10;    }&#10;    buildFeatures {&#10;        compose = true&#10;    }&#10;    composeOptions {&#10;        kotlinCompilerExtensionVersion = &quot;1.5.8&quot;&#10;    }&#10;}&#10;&#10;dependencies {&#10;&#10;    implementation(libs.androidx.core.ktx)&#10;    implementation(libs.androidx.lifecycle.runtime.ktx)&#10;    implementation(libs.androidx.activity.compose)&#10;    implementation(platform(libs.androidx.compose.bom))&#10;    implementation(libs.androidx.compose.ui)&#10;    implementation(libs.androidx.compose.ui.graphics)&#10;    implementation(libs.androidx.compose.ui.tooling.preview)&#10;    implementation(libs.androidx.compose.material3)&#10;    implementation(&quot;androidx.compose.material:material-icons-extended&quot;)&#10;    implementation(&quot;androidx.navigation:navigation-compose:2.7.6&quot;)&#10;&#10;    // Camera dependencies - updated to compatible versions&#10;    implementation(&quot;androidx.camera:camera-camera2:1.3.1&quot;)&#10;    implementation(&quot;androidx.camera:camera-lifecycle:1.3.1&quot;)&#10;    implementation(&quot;androidx.camera:camera-view:1.3.1&quot;)&#10;    implementation(&quot;androidx.activity:activity-compose:1.8.2&quot;)&#10;&#10;    implementation(platform(&quot;io.github.jan-tennert.supabase:bom:3.2.4&quot;))&#10;    implementation(&quot;io.github.jan-tennert.supabase:postgrest-kt&quot;)&#10;    implementation(&quot;io.github.jan-tennert.supabase:auth-kt&quot;)&#10;&#10;    implementation(&quot;io.ktor:ktor-client-android:3.3.0&quot;)&#10;    implementation(libs.androidx.compose.foundation)&#10;&#10;    // DataStore dependency for session management&#10;    implementation(&quot;androidx.datastore:datastore-preferences:1.0.0&quot;)&#10;&#10;    // Google Play Services Location&#10;    implementation(&quot;com.google.android.gms:play-services-location:21.0.1&quot;)&#10;    implementation(&quot;org.jetbrains.kotlinx:kotlinx-coroutines-play-services:1.7.3&quot;)&#10;&#10;    testImplementation(libs.junit)&#10;    androidTestImplementation(libs.androidx.junit)&#10;    androidTestImplementation(libs.androidx.espresso.core)&#10;    androidTestImplementation(platform(libs.androidx.compose.bom))&#10;    androidTestImplementation(libs.androidx.compose.ui.test.junit4)&#10;    debugImplementation(libs.androidx.compose.ui.tooling)&#10;    debugImplementation(libs.androidx.compose.ui.test.manifest)&#10;}" />
              <option name="updatedContent" value="plugins {&#10;    alias(libs.plugins.android.application)&#10;    alias(libs.plugins.kotlin.android)&#10;    alias(libs.plugins.kotlin.compose)&#10;    kotlin(&quot;plugin.serialization&quot;) version &quot;2.0.21&quot;&#10;}&#10;&#10;android {&#10;    namespace = &quot;com.example.smartattendance&quot;&#10;    compileSdk = 36&#10;&#10;    defaultConfig {&#10;        applicationId = &quot;com.example.smartattendance&quot;&#10;        minSdk = 26&#10;        targetSdk = 34&#10;        versionCode = 1&#10;        versionName = &quot;1.0&quot;&#10;&#10;        testInstrumentationRunner = &quot;androidx.test.runner.AndroidJUnitRunner&quot;&#10;    }&#10;&#10;    buildTypes {&#10;        release {&#10;            isMinifyEnabled = false&#10;            proguardFiles(&#10;                getDefaultProguardFile(&quot;proguard-android-optimize.txt&quot;),&#10;                &quot;proguard-rules.pro&quot;&#10;            )&#10;        }&#10;    }&#10;    compileOptions {&#10;        sourceCompatibility = JavaVersion.VERSION_1_8&#10;        targetCompatibility = JavaVersion.VERSION_1_8&#10;    }&#10;    kotlinOptions {&#10;        jvmTarget = &quot;1.8&quot;&#10;    }&#10;    buildFeatures {&#10;        compose = true&#10;    }&#10;    composeOptions {&#10;        kotlinCompilerExtensionVersion = &quot;1.5.8&quot;&#10;    }&#10;}&#10;&#10;dependencies {&#10;&#10;    implementation(libs.androidx.core.ktx)&#10;    implementation(libs.androidx.lifecycle.runtime.ktx)&#10;    implementation(libs.androidx.activity.compose)&#10;    implementation(platform(libs.androidx.compose.bom))&#10;    implementation(libs.androidx.compose.ui)&#10;    implementation(libs.androidx.compose.ui.graphics)&#10;    implementation(libs.androidx.compose.ui.tooling.preview)&#10;    implementation(libs.androidx.compose.material3)&#10;    implementation(&quot;androidx.compose.material:material-icons-extended&quot;)&#10;    implementation(&quot;androidx.navigation:navigation-compose:2.7.6&quot;)&#10;&#10;    // Camera dependencies - updated to compatible versions&#10;    implementation(&quot;androidx.camera:camera-camera2:1.3.1&quot;)&#10;    implementation(&quot;androidx.camera:camera-lifecycle:1.3.1&quot;)&#10;    implementation(&quot;androidx.camera:camera-view:1.3.1&quot;)&#10;    implementation(&quot;androidx.activity:activity-compose:1.8.2&quot;)&#10;&#10;    implementation(platform(&quot;io.github.jan-tennert.supabase:bom:3.2.4&quot;))&#10;    implementation(&quot;io.github.jan-tennert.supabase:postgrest-kt&quot;)&#10;    implementation(&quot;io.github.jan-tennert.supabase:auth-kt&quot;)&#10;    &#10;    // QR Code generation for MFA&#10;    implementation(&quot;com.google.zxing:core:3.5.3&quot;)&#10;    implementation(&quot;androidx.compose.ui:ui-graphics:1.6.0&quot;)&#10;&#10;    implementation(&quot;io.ktor:ktor-client-android:3.3.0&quot;)&#10;    implementation(libs.androidx.compose.foundation)&#10;&#10;    // DataStore dependency for session management&#10;    implementation(&quot;androidx.datastore:datastore-preferences:1.0.0&quot;)&#10;&#10;    // Google Play Services Location&#10;    implementation(&quot;com.google.android.gms:play-services-location:21.0.1&quot;)&#10;    implementation(&quot;org.jetbrains.kotlinx:kotlinx-coroutines-play-services:1.7.3&quot;)&#10;&#10;    testImplementation(libs.junit)&#10;    androidTestImplementation(libs.androidx.junit)&#10;    androidTestImplementation(libs.androidx.espresso.core)&#10;    androidTestImplementation(platform(libs.androidx.compose.bom))&#10;    androidTestImplementation(libs.androidx.compose.ui.test.junit4)&#10;    debugImplementation(libs.androidx.compose.ui.tooling)&#10;    debugImplementation(libs.androidx.compose.ui.test.manifest)&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/MainActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/MainActivity.kt" />
              <option name="originalContent" value="package com.example.smartattendance&#10;&#10;import android.app.Activity&#10;import android.graphics.Bitmap&#10;import android.os.Bundle&#10;import androidx.activity.ComponentActivity&#10;import androidx.activity.compose.setContent&#10;import androidx.activity.enableEdgeToEdge&#10;import androidx.compose.animation.AnimatedVisibility&#10;import androidx.compose.animation.ExperimentalAnimationApi&#10;import androidx.compose.animation.core.FastOutSlowInEasing&#10;import androidx.compose.animation.core.tween&#10;import androidx.compose.animation.fadeIn&#10;import androidx.compose.animation.fadeOut&#10;import androidx.compose.animation.slideInHorizontally&#10;import androidx.compose.animation.slideInVertically&#10;import androidx.compose.animation.slideOutHorizontally&#10;import androidx.compose.animation.slideOutVertically&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.ExperimentalMaterial3Api&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.Surface&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.SideEffect&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.platform.LocalView&#10;import androidx.core.view.WindowCompat&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.ui.components.AppBottomNavigation&#10;import com.example.smartattendance.ui.screens.AttendanceDetailScreen&#10;import com.example.smartattendance.ui.screens.AttendanceScreen&#10;import com.example.smartattendance.ui.screens.CameraScreen&#10;import com.example.smartattendance.ui.screens.HistoryScreen&#10;import com.example.smartattendance.ui.screens.HomeScreen&#10;import com.example.smartattendance.ui.screens.ListScreen&#10;import com.example.smartattendance.ui.screens.LoginScreen&#10;import com.example.smartattendance.ui.screens.RequestPermissionScreen&#10;import com.example.smartattendance.ui.screens.ScheduleScreen&#10;import com.example.smartattendance.ui.screens.ScheduleDetailScreen&#10;import com.example.smartattendance.ui.screens.SignUpScreen&#10;import com.example.smartattendance.ui.screens.SubmissionCompleteScreen&#10;import com.example.smartattendance.ui.screens.SubmitAttendanceScreen&#10;import com.example.smartattendance.ui.screens.CreatePermissionFormScreen&#10;import com.example.smartattendance.ui.theme.SmartAttendanceTheme&#10;import com.example.smartattendance.utils.SessionManager&#10;import androidx.navigation.NavType&#10;import androidx.navigation.navArgument&#10;import com.example.smartattendance.ui.screens.SubmissionScreen&#10;import com.example.smartattendance.ui.screens.SubmitionComplete&#10;&#10;class MainActivity : ComponentActivity() {&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        // This enables edge-to-edge display and makes the status bar transparent.&#10;        enableEdgeToEdge()&#10;&#10;        setContent {&#10;            SmartAttendanceTheme {&#10;                Surface(&#10;                    modifier = Modifier.fillMaxSize(),&#10;                    color = Color.White&#10;                ) {&#10;                    AppNavigation()&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class, ExperimentalAnimationApi::class)&#10;@Composable&#10;fun AppNavigation() {&#10;    val navController = rememberNavController()&#10;    val navBackStackEntry by navController.currentBackStackEntryAsState()&#10;    val currentRoute = navBackStackEntry?.destination?.route ?: &quot;login&quot;&#10;    // Initialize SessionManager&#10;    val context = LocalView.current.context&#10;    val sessionManager = remember { SessionManager(context) }&#10;&#10;    // State for captured photo and attendance detail parameters&#10;    var capturedPhoto by remember { mutableStateOf&lt;Bitmap?&gt;(null) }&#10;    var isLateAttendance by remember { mutableStateOf(false) }&#10;    var selectedClassName by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedStatus by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedCourseCode by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedLecturerId by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedRoom by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedDay by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedStartTime by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedEndTime by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedAttendanceDate by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedRecordedAt by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    // State to hold the current user&#10;    var user by remember { mutableStateOf&lt;AuthApi.User?&gt;(null) }&#10;&#10;    // Check session on app start&#10;    var startDestination by remember { mutableStateOf(&quot;login&quot;) }&#10;    LaunchedEffect(Unit) {&#10;        sessionManager.userFlow.collect { savedUser -&gt;&#10;            if (savedUser != null) {&#10;                user = savedUser&#10;                startDestination = &quot;home&quot;&#10;            } else {&#10;                startDestination = &quot;login&quot;&#10;            }&#10;        }&#10;    }&#10;&#10;&#10;    // --- Dynamic Status Bar Color ---&#10;    val view = LocalView.current&#10;    // This effect runs whenever the currentRoute changes.&#10;    // It adjusts the status bar icon color based on the screen's background.&#10;    if (!view.isInEditMode) {&#10;        SideEffect {&#10;            val window = (view.context as Activity).window&#10;            // When on 'home' screen (dark header), icons are light (false).&#10;            // On other screens (light background), icons are dark (true).&#10;            WindowCompat.getInsetsController(window, view).isAppearanceLightStatusBars = currentRoute != &quot;home&quot;&#10;        }&#10;    }&#10;    // --- End of Status Bar Logic ---&#10;&#10;    // Routes where bottom navigation should be shown&#10;    val routesWithBottomNav = setOf(&quot;home&quot;, &quot;attendance&quot;, &quot;history&quot;, &quot;schedule&quot;, &quot;request_permission&quot;, &quot;create_permission_request&quot;, &quot;submission_complete&quot;, &quot;pending_request&quot;)&#10;&#10;    Scaffold(&#10;        bottomBar = {&#10;            AnimatedVisibility(&#10;                visible = currentRoute in routesWithBottomNav,&#10;                enter = slideInVertically(&#10;                    initialOffsetY = { it },&#10;                    animationSpec = tween(300, easing = FastOutSlowInEasing)&#10;                ) + fadeIn(animationSpec = tween(300)),&#10;                exit = slideOutVertically(&#10;                    targetOffsetY = { it },&#10;                    animationSpec = tween(300, easing = FastOutSlowInEasing)&#10;                ) + fadeOut(animationSpec = tween(300))&#10;            ) {&#10;                AppBottomNavigation(&#10;                    currentRoute = currentRoute,&#10;                    onNavigate = { route -&gt;&#10;                        when (route) {&#10;                            &quot;home&quot; -&gt; {&#10;                                navController.navigate(&quot;home&quot;) {&#10;                                    popUpTo(&quot;home&quot;) { inclusive = true }&#10;                                    launchSingleTop = true&#10;                                }&#10;                            }&#10;                            else -&gt; {&#10;                                navController.navigate(route) {&#10;                                    popUpTo(&quot;home&quot;) { saveState = true }&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;        }&#10;    ) { paddingValues -&gt;&#10;        NavHost(&#10;            navController = navController,&#10;            startDestination = startDestination,&#10;            modifier = Modifier.padding(paddingValues),&#10;            enterTransition = { slideInHorizontally(initialOffsetX = { it }, animationSpec = tween(300, easing = FastOutSlowInEasing)) + fadeIn(animationSpec = tween(300)) },&#10;            exitTransition = { slideOutHorizontally(targetOffsetX = { -it }, animationSpec = tween(300, easing = FastOutSlowInEasing)) + fadeOut(animationSpec = tween(300)) },&#10;            popEnterTransition = { slideInHorizontally(initialOffsetX = { -it }, animationSpec = tween(300, easing = FastOutSlowInEasing)) + fadeIn(animationSpec = tween(300)) },&#10;            popExitTransition = { slideOutHorizontally(targetOffsetX = { it }, animationSpec = tween(300, easing = FastOutSlowInEasing)) + fadeOut(animationSpec = tween(300)) }&#10;        ) {&#10;            composable(&#10;                &quot;login&quot;,&#10;                enterTransition = { fadeIn(animationSpec = tween(500)) },&#10;                exitTransition = { fadeOut(animationSpec = tween(300)) }&#10;            ) {&#10;                LoginScreen(&#10;                    sessionManager = sessionManager,&#10;                    onLoginSuccess = { loggedInUser -&gt;&#10;                        user = loggedInUser&#10;                        navController.navigate(&quot;home&quot;) {&#10;                            popUpTo(&quot;login&quot;) { inclusive = true }&#10;                        }&#10;                    },&#10;                    onSignUpClick = {&#10;                        navController.navigate(&quot;sign_up&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&#10;                &quot;sign_up&quot;&#10;            ){&#10;                SignUpScreen(&#10;                    onNavigateToLogin ={&#10;                        navController.navigate(&quot;login&quot;){&#10;                            popUpTo(0)&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;home&quot;) {&#10;                HomeScreen(&#10;                    user = user,&#10;                    sessionManager = sessionManager,&#10;                    navController = navController,&#10;                    onLogout = {&#10;                        user = null // Clear user on logout&#10;                        navController.navigate(&quot;login&quot;) {&#10;                            popUpTo(0)&#10;                        }&#10;                    },&#10;                    onDateClick = {&#10;                        navController.navigate(&quot;history&quot;)&#10;                    },&#10;                    onRequestPermission = {&#10;                        navController.navigate(&quot;request_permission&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;attendance&quot;) {&#10;                AttendanceScreen(&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onTakePhoto = {&#10;                        navController.navigate(&quot;camera&quot;)&#10;                    },&#10;                    onAskPermission = {&#10;                        navController.navigate(&quot;request_permission&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;camera&quot;) {&#10;                CameraScreen(&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onPhotoTaken = { bitmap -&gt;&#10;                        capturedPhoto = bitmap&#10;                        isLateAttendance = false&#10;                        navController.navigate(&quot;submit_attendance&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;submit_attendance&quot;) {&#10;                SubmitAttendanceScreen(&#10;                    capturedPhoto = capturedPhoto,&#10;                    isLateAttendance = isLateAttendance,&#10;                    onBackClick = {&#10;                        navController.navigate(&quot;home&quot;) {&#10;                            popUpTo(&quot;home&quot;) { inclusive = true }&#10;                            launchSingleTop = true&#10;                        }&#10;                    },&#10;                    onTakePhotoClick = {&#10;                        navController.navigate(&quot;camera&quot;)&#10;                    },&#10;                    onSubmitSuccess = {&#10;                        capturedPhoto = null&#10;                        isLateAttendance = false&#10;                        navController.navigate(&quot;submission_complete&quot;) {&#10;                            popUpTo(&quot;home&quot;) { inclusive = false }&#10;                            launchSingleTop = true&#10;                        }&#10;                    },&#10;                    onNavigateHome = {&#10;                        navController.navigate(&quot;home&quot;) {&#10;                            popUpTo(&quot;home&quot;) { inclusive = true }&#10;                            launchSingleTop = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;history&quot;) {&#10;                HistoryScreen(&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onNavigateToDetail = { className, status, courseCode, lecturerId, room, day, startTime, endTime, attendanceDate, recordedAt -&gt;&#10;                        selectedClassName = className&#10;                        selectedStatus = status&#10;                        selectedCourseCode = courseCode&#10;                        selectedLecturerId = lecturerId&#10;                        selectedRoom = room&#10;                        selectedDay = day&#10;                        selectedStartTime = startTime&#10;                        selectedEndTime = endTime&#10;                        selectedAttendanceDate = attendanceDate&#10;                        selectedRecordedAt = recordedAt&#10;                        navController.navigate(&quot;attendance_detail&quot;)&#10;                    },&#10;                    onNavigateToSchedule = {&#10;                        navController.navigate(&quot;schedule&quot;) {&#10;                            popUpTo(&quot;home&quot;) { saveState = true }&#10;                            launchSingleTop = true&#10;                            restoreState = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;attendance_detail&quot;) {&#10;                AttendanceDetailScreen(&#10;                    className = selectedClassName,&#10;                    status = selectedStatus,&#10;                    courseCode = selectedCourseCode,&#10;                    lecturerId = selectedLecturerId,&#10;                    room = selectedRoom,&#10;                    day = selectedDay,&#10;                    startTime = selectedStartTime,&#10;                    endTime = selectedEndTime,&#10;                    attendanceDate = selectedAttendanceDate,&#10;                    recordedAt = selectedRecordedAt,&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    }&#10;                )&#10;            }&#10;&#10;            // List screen for center navigation&#10;            composable(&quot;list&quot;) {&#10;                ListScreen(&#10;                    onNavigateBack = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onNavigate = { route -&gt;&#10;                        when (route) {&#10;                            &quot;home&quot; -&gt; {&#10;                                navController.navigate(&quot;home&quot;) {&#10;                                    popUpTo(&quot;home&quot;) { inclusive = true }&#10;                                    launchSingleTop = true&#10;                                }&#10;                            }&#10;                            else -&gt; {&#10;                                navController.navigate(route) {&#10;                                    popUpTo(&quot;home&quot;) { saveState = true }&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            }&#10;                        }&#10;                    },&#10;                    onCardClick = { className, status -&gt;&#10;                        selectedClassName = className&#10;                        selectedStatus = status&#10;                        navController.navigate(&quot;attendance_detail&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;schedule&quot;) {&#10;                ScheduleScreen(&#10;                    user = user,&#10;                    onNavigateBack = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onNavigate = { route -&gt;&#10;                        when (route) {&#10;                            &quot;home&quot; -&gt; {&#10;                                navController.navigate(&quot;home&quot;) {&#10;                                    popUpTo(&quot;home&quot;) { inclusive = true }&#10;                                    launchSingleTop = true&#10;                                }&#10;                            }&#10;                            else -&gt; {&#10;                                navController.navigate(route) {&#10;                                    popUpTo(&quot;home&quot;) { saveState = true }&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            }&#10;                        }&#10;                    },&#10;                    onScheduleItemClick = { scheduleId, courseId -&gt;&#10;                        navController.navigate(&quot;schedule_detail/$scheduleId/$courseId&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&#10;                &quot;schedule_detail/{scheduleId}/{courseId}&quot;,&#10;                arguments = listOf(&#10;                    navArgument(&quot;scheduleId&quot;) { type = NavType.IntType },&#10;                    navArgument(&quot;courseId&quot;) { type = NavType.IntType }&#10;                )&#10;            ) { backStackEntry -&gt;&#10;                val scheduleId = backStackEntry.arguments?.getInt(&quot;scheduleId&quot;) ?: 0&#10;                val courseId = backStackEntry.arguments?.getInt(&quot;courseId&quot;) ?: 0&#10;                ScheduleDetailScreen(&#10;                    scheduleId = scheduleId,&#10;                    courseId = courseId,&#10;                    userId = user?.user_id ?: &quot;&quot;,&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;submission_complete&quot;) {&#10;                SubmissionCompleteScreen(&#10;                    status = selectedStatus, // pass the selected status&#10;                    courseName = selectedClassName, // pass the selected class name&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onNavigateHome = {&#10;                        navController.navigate(&quot;home&quot;) {&#10;                            popUpTo(&quot;home&quot;) { inclusive = true }&#10;                            launchSingleTop = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;request_permission&quot;) {&#10;                RequestPermissionScreen(&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onCreateRequest = {&#10;                        // TODO: Navigate to create permission request screen&#10;                        navController.navigate(&quot;create_permission_form&quot;)&#10;                    },&#10;                    onNavigate = { route -&gt;&#10;                        when (route) {&#10;                            &quot;home&quot; -&gt; {&#10;                                navController.navigate(&quot;home&quot;) {&#10;                                    popUpTo(&quot;home&quot;) { inclusive = true }&#10;                                    launchSingleTop = true&#10;                                }&#10;                            }&#10;                            else -&gt; {&#10;                                navController.navigate(route) {&#10;                                    popUpTo(&quot;home&quot;) { saveState = true }&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;create_permission_form&quot;) {&#10;                CreatePermissionFormScreen(&#10;                    user = user,&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onSubmit = {&#10;                        navController.popBackStack()&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&#10;                &quot;submission_screen/{scheduleId}/{courseId}&quot;,&#10;                arguments = listOf(&#10;                    navArgument(&quot;scheduleId&quot;) { type = androidx.navigation.NavType.IntType },&#10;                    navArgument(&quot;courseId&quot;) { type = androidx.navigation.NavType.IntType }&#10;                )&#10;            ) { backStackEntry -&gt;&#10;                val scheduleId = backStackEntry.arguments?.getInt(&quot;scheduleId&quot;)&#10;                val courseId = backStackEntry.arguments?.getInt(&quot;courseId&quot;)&#10;                SubmissionScreen(&#10;                    user = user,&#10;                    navController = navController,&#10;                    scheduleId = scheduleId,&#10;                    courseId = courseId&#10;                )&#10;            }&#10;&#10;            composable(&#10;                &quot;submission_complete_screen/{status}/{courseName}/{courseId}/{scheduleId}&quot;,&#10;                arguments = listOf(&#10;                    navArgument(&quot;status&quot;) { type = NavType.StringType },&#10;                    navArgument(&quot;courseName&quot;) { type = NavType.StringType },&#10;                    navArgument(&quot;courseId&quot;) { type = NavType.IntType },&#10;                    navArgument(&quot;scheduleId&quot;) { type = NavType.IntType }&#10;                )&#10;            ) { backStackEntry -&gt;&#10;                val status = backStackEntry.arguments?.getString(&quot;status&quot;) ?: &quot;&quot;&#10;                val courseName = backStackEntry.arguments?.getString(&quot;courseName&quot;) ?: &quot;&quot;&#10;                val courseId = backStackEntry.arguments?.getInt(&quot;courseId&quot;) ?: 0&#10;                val scheduleId = backStackEntry.arguments?.getInt(&quot;scheduleId&quot;) ?: 0&#10;                SubmitionComplete(&#10;                    status = status,&#10;                    courseName = courseName,&#10;                    courseId = courseId,&#10;                    scheduleId = scheduleId,&#10;                    onBackClick = { navController.navigate(&quot;home&quot;) },&#10;                    onNavigateHome = { navController.navigate(&quot;home&quot;) }&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.smartattendance&#10;&#10;import android.app.Activity&#10;import android.graphics.Bitmap&#10;import android.os.Bundle&#10;import androidx.activity.ComponentActivity&#10;import androidx.activity.compose.setContent&#10;import androidx.activity.enableEdgeToEdge&#10;import androidx.compose.animation.AnimatedVisibility&#10;import androidx.compose.animation.ExperimentalAnimationApi&#10;import androidx.compose.animation.core.FastOutSlowInEasing&#10;import androidx.compose.animation.core.tween&#10;import androidx.compose.animation.fadeIn&#10;import androidx.compose.animation.fadeOut&#10;import androidx.compose.animation.slideInHorizontally&#10;import androidx.compose.animation.slideInVertically&#10;import androidx.compose.animation.slideOutHorizontally&#10;import androidx.compose.animation.slideOutVertically&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.material3.ExperimentalMaterial3Api&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.Surface&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.SideEffect&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.platform.LocalView&#10;import androidx.core.view.WindowCompat&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.ui.components.AppBottomNavigation&#10;import com.example.smartattendance.ui.screens.AttendanceDetailScreen&#10;import com.example.smartattendance.ui.screens.AttendanceScreen&#10;import com.example.smartattendance.ui.screens.CameraScreen&#10;import com.example.smartattendance.ui.screens.HistoryScreen&#10;import com.example.smartattendance.ui.screens.HomeScreen&#10;import com.example.smartattendance.ui.screens.ListScreen&#10;import com.example.smartattendance.ui.screens.LoginScreen&#10;import com.example.smartattendance.ui.screens.RequestPermissionScreen&#10;import com.example.smartattendance.ui.screens.ScheduleScreen&#10;import com.example.smartattendance.ui.screens.ScheduleDetailScreen&#10;import com.example.smartattendance.ui.screens.SignUpScreen&#10;import com.example.smartattendance.ui.screens.SubmissionCompleteScreen&#10;import com.example.smartattendance.ui.screens.SubmitAttendanceScreen&#10;import com.example.smartattendance.ui.screens.CreatePermissionFormScreen&#10;import com.example.smartattendance.ui.theme.SmartAttendanceTheme&#10;import com.example.smartattendance.utils.SessionManager&#10;import androidx.navigation.NavType&#10;import androidx.navigation.navArgument&#10;import com.example.smartattendance.ui.screens.SubmissionScreen&#10;import com.example.smartattendance.ui.screens.SubmitionComplete&#10;import com.example.smartattendance.ui.screens.MfaSettingsScreen&#10;import com.example.smartattendance.ui.screens.MfaSetupScreen&#10;import com.example.smartattendance.ui.screens.MfaVerifyScreen&#10;&#10;class MainActivity : ComponentActivity() {&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        // This enables edge-to-edge display and makes the status bar transparent.&#10;        enableEdgeToEdge()&#10;&#10;        setContent {&#10;            SmartAttendanceTheme {&#10;                Surface(&#10;                    modifier = Modifier.fillMaxSize(),&#10;                    color = Color.White&#10;                ) {&#10;                    AppNavigation()&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@OptIn(ExperimentalMaterial3Api::class, ExperimentalAnimationApi::class)&#10;@Composable&#10;fun AppNavigation() {&#10;    val navController = rememberNavController()&#10;    val navBackStackEntry by navController.currentBackStackEntryAsState()&#10;    val currentRoute = navBackStackEntry?.destination?.route ?: &quot;login&quot;&#10;    // Initialize SessionManager&#10;    val context = LocalView.current.context&#10;    val sessionManager = remember { SessionManager(context) }&#10;&#10;    // State for captured photo and attendance detail parameters&#10;    var capturedPhoto by remember { mutableStateOf&lt;Bitmap?&gt;(null) }&#10;    var isLateAttendance by remember { mutableStateOf(false) }&#10;    var selectedClassName by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedStatus by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedCourseCode by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedLecturerId by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedRoom by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedDay by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedStartTime by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedEndTime by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedAttendanceDate by remember { mutableStateOf(&quot;&quot;) }&#10;    var selectedRecordedAt by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    // State to hold the current user&#10;    var user by remember { mutableStateOf&lt;AuthApi.User?&gt;(null) }&#10;&#10;    // Check session on app start&#10;    var startDestination by remember { mutableStateOf(&quot;login&quot;) }&#10;    LaunchedEffect(Unit) {&#10;        sessionManager.userFlow.collect { savedUser -&gt;&#10;            if (savedUser != null) {&#10;                user = savedUser&#10;                startDestination = &quot;home&quot;&#10;            } else {&#10;                startDestination = &quot;login&quot;&#10;            }&#10;        }&#10;    }&#10;&#10;&#10;    // --- Dynamic Status Bar Color ---&#10;    val view = LocalView.current&#10;    // This effect runs whenever the currentRoute changes.&#10;    // It adjusts the status bar icon color based on the screen's background.&#10;    if (!view.isInEditMode) {&#10;        SideEffect {&#10;            val window = (view.context as Activity).window&#10;            // When on 'home' screen (dark header), icons are light (false).&#10;            // On other screens (light background), icons are dark (true).&#10;            WindowCompat.getInsetsController(window, view).isAppearanceLightStatusBars = currentRoute != &quot;home&quot;&#10;        }&#10;    }&#10;    // --- End of Status Bar Logic ---&#10;&#10;    // Routes where bottom navigation should be shown&#10;    val routesWithBottomNav = setOf(&quot;home&quot;, &quot;attendance&quot;, &quot;history&quot;, &quot;schedule&quot;, &quot;request_permission&quot;, &quot;create_permission_request&quot;, &quot;submission_complete&quot;, &quot;pending_request&quot;)&#10;&#10;    Scaffold(&#10;        bottomBar = {&#10;            AnimatedVisibility(&#10;                visible = currentRoute in routesWithBottomNav,&#10;                enter = slideInVertically(&#10;                    initialOffsetY = { it },&#10;                    animationSpec = tween(300, easing = FastOutSlowInEasing)&#10;                ) + fadeIn(animationSpec = tween(300)),&#10;                exit = slideOutVertically(&#10;                    targetOffsetY = { it },&#10;                    animationSpec = tween(300, easing = FastOutSlowInEasing)&#10;                ) + fadeOut(animationSpec = tween(300))&#10;            ) {&#10;                AppBottomNavigation(&#10;                    currentRoute = currentRoute,&#10;                    onNavigate = { route -&gt;&#10;                        when (route) {&#10;                            &quot;home&quot; -&gt; {&#10;                                navController.navigate(&quot;home&quot;) {&#10;                                    popUpTo(&quot;home&quot;) { inclusive = true }&#10;                                    launchSingleTop = true&#10;                                }&#10;                            }&#10;                            else -&gt; {&#10;                                navController.navigate(route) {&#10;                                    popUpTo(&quot;home&quot;) { saveState = true }&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;        }&#10;    ) { paddingValues -&gt;&#10;        NavHost(&#10;            navController = navController,&#10;            startDestination = startDestination,&#10;            modifier = Modifier.padding(paddingValues),&#10;            enterTransition = { slideInHorizontally(initialOffsetX = { it }, animationSpec = tween(300, easing = FastOutSlowInEasing)) + fadeIn(animationSpec = tween(300)) },&#10;            exitTransition = { slideOutHorizontally(targetOffsetX = { -it }, animationSpec = tween(300, easing = FastOutSlowInEasing)) + fadeOut(animationSpec = tween(300)) },&#10;            popEnterTransition = { slideInHorizontally(initialOffsetX = { -it }, animationSpec = tween(300, easing = FastOutSlowInEasing)) + fadeIn(animationSpec = tween(300)) },&#10;            popExitTransition = { slideOutHorizontally(targetOffsetX = { it }, animationSpec = tween(300, easing = FastOutSlowInEasing)) + fadeOut(animationSpec = tween(300)) }&#10;        ) {&#10;            composable(&#10;                &quot;login&quot;,&#10;                enterTransition = { fadeIn(animationSpec = tween(500)) },&#10;                exitTransition = { fadeOut(animationSpec = tween(300)) }&#10;            ) {&#10;                LoginScreen(&#10;                    sessionManager = sessionManager,&#10;                    onLoginSuccess = { loggedInUser -&gt;&#10;                        user = loggedInUser&#10;                        navController.navigate(&quot;home&quot;) {&#10;                            popUpTo(&quot;login&quot;) { inclusive = true }&#10;                        }&#10;                    },&#10;                    onMfaRequired = { loggedInUser -&gt;&#10;                        user = loggedInUser&#10;                        navController.navigate(&quot;mfa_verify&quot;)&#10;                    },&#10;                    onSignUpClick = {&#10;                        navController.navigate(&quot;sign_up&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&#10;                &quot;sign_up&quot;&#10;            ){&#10;                SignUpScreen(&#10;                    onNavigateToLogin ={&#10;                        navController.navigate(&quot;login&quot;){&#10;                            popUpTo(0)&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            // MFA Verify Screen&#10;            composable(&quot;mfa_verify&quot;) {&#10;                user?.let { currentUser -&gt;&#10;                    MfaVerifyScreen(&#10;                        user = currentUser,&#10;                        onVerificationSuccess = {&#10;                            navController.navigate(&quot;home&quot;) {&#10;                                popUpTo(&quot;login&quot;) { inclusive = true }&#10;                            }&#10;                        },&#10;                        onBackClick = {&#10;                            navController.navigate(&quot;login&quot;) {&#10;                                popUpTo(&quot;login&quot;) { inclusive = true }&#10;                            }&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;&#10;            // MFA Setup Screen&#10;            composable(&quot;mfa_setup&quot;) {&#10;                user?.let { currentUser -&gt;&#10;                    MfaSetupScreen(&#10;                        user = currentUser,&#10;                        onBackClick = {&#10;                            navController.popBackStack()&#10;                        },&#10;                        onSetupComplete = {&#10;                            navController.popBackStack()&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;&#10;            // MFA Settings Screen&#10;            composable(&quot;mfa_settings&quot;) {&#10;                user?.let { currentUser -&gt;&#10;                    MfaSettingsScreen(&#10;                        user = currentUser,&#10;                        onBackClick = {&#10;                            navController.popBackStack()&#10;                        },&#10;                        onSetupMfa = {&#10;                            navController.navigate(&quot;mfa_setup&quot;)&#10;                        }&#10;                    )&#10;                }&#10;            }&#10;&#10;            composable(&quot;home&quot;) {&#10;                HomeScreen(&#10;                    user = user,&#10;                    sessionManager = sessionManager,&#10;                    navController = navController,&#10;                    onLogout = {&#10;                        user = null // Clear user on logout&#10;                        navController.navigate(&quot;login&quot;) {&#10;                            popUpTo(0)&#10;                        }&#10;                    },&#10;                    onDateClick = {&#10;                        navController.navigate(&quot;history&quot;)&#10;                    },&#10;                    onRequestPermission = {&#10;                        navController.navigate(&quot;request_permission&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;attendance&quot;) {&#10;                AttendanceScreen(&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onTakePhoto = {&#10;                        navController.navigate(&quot;camera&quot;)&#10;                    },&#10;                    onAskPermission = {&#10;                        navController.navigate(&quot;request_permission&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;camera&quot;) {&#10;                CameraScreen(&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onPhotoTaken = { bitmap -&gt;&#10;                        capturedPhoto = bitmap&#10;                        isLateAttendance = false&#10;                        navController.navigate(&quot;submit_attendance&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;submit_attendance&quot;) {&#10;                SubmitAttendanceScreen(&#10;                    capturedPhoto = capturedPhoto,&#10;                    isLateAttendance = isLateAttendance,&#10;                    onBackClick = {&#10;                        navController.navigate(&quot;home&quot;) {&#10;                            popUpTo(&quot;home&quot;) { inclusive = true }&#10;                            launchSingleTop = true&#10;                        }&#10;                    },&#10;                    onTakePhotoClick = {&#10;                        navController.navigate(&quot;camera&quot;)&#10;                    },&#10;                    onSubmitSuccess = {&#10;                        capturedPhoto = null&#10;                        isLateAttendance = false&#10;                        navController.navigate(&quot;submission_complete&quot;) {&#10;                            popUpTo(&quot;home&quot;) { inclusive = false }&#10;                            launchSingleTop = true&#10;                        }&#10;                    },&#10;                    onNavigateHome = {&#10;                        navController.navigate(&quot;home&quot;) {&#10;                            popUpTo(&quot;home&quot;) { inclusive = true }&#10;                            launchSingleTop = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;history&quot;) {&#10;                HistoryScreen(&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onNavigateToDetail = { className, status, courseCode, lecturerId, room, day, startTime, endTime, attendanceDate, recordedAt -&gt;&#10;                        selectedClassName = className&#10;                        selectedStatus = status&#10;                        selectedCourseCode = courseCode&#10;                        selectedLecturerId = lecturerId&#10;                        selectedRoom = room&#10;                        selectedDay = day&#10;                        selectedStartTime = startTime&#10;                        selectedEndTime = endTime&#10;                        selectedAttendanceDate = attendanceDate&#10;                        selectedRecordedAt = recordedAt&#10;                        navController.navigate(&quot;attendance_detail&quot;)&#10;                    },&#10;                    onNavigateToSchedule = {&#10;                        navController.navigate(&quot;schedule&quot;) {&#10;                            popUpTo(&quot;home&quot;) { saveState = true }&#10;                            launchSingleTop = true&#10;                            restoreState = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;attendance_detail&quot;) {&#10;                AttendanceDetailScreen(&#10;                    className = selectedClassName,&#10;                    status = selectedStatus,&#10;                    courseCode = selectedCourseCode,&#10;                    lecturerId = selectedLecturerId,&#10;                    room = selectedRoom,&#10;                    day = selectedDay,&#10;                    startTime = selectedStartTime,&#10;                    endTime = selectedEndTime,&#10;                    attendanceDate = selectedAttendanceDate,&#10;                    recordedAt = selectedRecordedAt,&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    }&#10;                )&#10;            }&#10;&#10;            // List screen for center navigation&#10;            composable(&quot;list&quot;) {&#10;                ListScreen(&#10;                    onNavigateBack = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onNavigate = { route -&gt;&#10;                        when (route) {&#10;                            &quot;home&quot; -&gt; {&#10;                                navController.navigate(&quot;home&quot;) {&#10;                                    popUpTo(&quot;home&quot;) { inclusive = true }&#10;                                    launchSingleTop = true&#10;                                }&#10;                            }&#10;                            else -&gt; {&#10;                                navController.navigate(route) {&#10;                                    popUpTo(&quot;home&quot;) { saveState = true }&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            }&#10;                        }&#10;                    },&#10;                    onCardClick = { className, status -&gt;&#10;                        selectedClassName = className&#10;                        selectedStatus = status&#10;                        navController.navigate(&quot;attendance_detail&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;schedule&quot;) {&#10;                ScheduleScreen(&#10;                    user = user,&#10;                    onNavigateBack = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onNavigate = { route -&gt;&#10;                        when (route) {&#10;                            &quot;home&quot; -&gt; {&#10;                                navController.navigate(&quot;home&quot;) {&#10;                                    popUpTo(&quot;home&quot;) { inclusive = true }&#10;                                    launchSingleTop = true&#10;                                }&#10;                            }&#10;                            else -&gt; {&#10;                                navController.navigate(route) {&#10;                                    popUpTo(&quot;home&quot;) { saveState = true }&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            }&#10;                        }&#10;                    },&#10;                    onScheduleItemClick = { scheduleId, courseId -&gt;&#10;                        navController.navigate(&quot;schedule_detail/$scheduleId/$courseId&quot;)&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&#10;                &quot;schedule_detail/{scheduleId}/{courseId}&quot;,&#10;                arguments = listOf(&#10;                    navArgument(&quot;scheduleId&quot;) { type = NavType.IntType },&#10;                    navArgument(&quot;courseId&quot;) { type = NavType.IntType }&#10;                )&#10;            ) { backStackEntry -&gt;&#10;                val scheduleId = backStackEntry.arguments?.getInt(&quot;scheduleId&quot;) ?: 0&#10;                val courseId = backStackEntry.arguments?.getInt(&quot;courseId&quot;) ?: 0&#10;                ScheduleDetailScreen(&#10;                    scheduleId = scheduleId,&#10;                    courseId = courseId,&#10;                    userId = user?.user_id ?: &quot;&quot;,&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;submission_complete&quot;) {&#10;                SubmissionCompleteScreen(&#10;                    status = selectedStatus, // pass the selected status&#10;                    courseName = selectedClassName, // pass the selected class name&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onNavigateHome = {&#10;                        navController.navigate(&quot;home&quot;) {&#10;                            popUpTo(&quot;home&quot;) { inclusive = true }&#10;                            launchSingleTop = true&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;request_permission&quot;) {&#10;                RequestPermissionScreen(&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onCreateRequest = {&#10;                        // TODO: Navigate to create permission request screen&#10;                        navController.navigate(&quot;create_permission_form&quot;)&#10;                    },&#10;                    onNavigate = { route -&gt;&#10;                        when (route) {&#10;                            &quot;home&quot; -&gt; {&#10;                                navController.navigate(&quot;home&quot;) {&#10;                                    popUpTo(&quot;home&quot;) { inclusive = true }&#10;                                    launchSingleTop = true&#10;                                }&#10;                            }&#10;                            else -&gt; {&#10;                                navController.navigate(route) {&#10;                                    popUpTo(&quot;home&quot;) { saveState = true }&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&quot;create_permission_form&quot;) {&#10;                CreatePermissionFormScreen(&#10;                    user = user,&#10;                    onBackClick = {&#10;                        navController.popBackStack()&#10;                    },&#10;                    onSubmit = {&#10;                        navController.popBackStack()&#10;                    }&#10;                )&#10;            }&#10;&#10;            composable(&#10;                &quot;submission_screen/{scheduleId}/{courseId}&quot;,&#10;                arguments = listOf(&#10;                    navArgument(&quot;scheduleId&quot;) { type = androidx.navigation.NavType.IntType },&#10;                    navArgument(&quot;courseId&quot;) { type = androidx.navigation.NavType.IntType }&#10;                )&#10;            ) { backStackEntry -&gt;&#10;                val scheduleId = backStackEntry.arguments?.getInt(&quot;scheduleId&quot;)&#10;                val courseId = backStackEntry.arguments?.getInt(&quot;courseId&quot;)&#10;                SubmissionScreen(&#10;                    user = user,&#10;                    navController = navController,&#10;                    scheduleId = scheduleId,&#10;                    courseId = courseId&#10;                )&#10;            }&#10;&#10;            composable(&#10;                &quot;submission_complete_screen/{status}/{courseName}/{courseId}/{scheduleId}&quot;,&#10;                arguments = listOf(&#10;                    navArgument(&quot;status&quot;) { type = NavType.StringType },&#10;                    navArgument(&quot;courseName&quot;) { type = NavType.StringType },&#10;                    navArgument(&quot;courseId&quot;) { type = NavType.IntType },&#10;                    navArgument(&quot;scheduleId&quot;) { type = NavType.IntType }&#10;                )&#10;            ) { backStackEntry -&gt;&#10;                val status = backStackEntry.arguments?.getString(&quot;status&quot;) ?: &quot;&quot;&#10;                val courseName = backStackEntry.arguments?.getString(&quot;courseName&quot;) ?: &quot;&quot;&#10;                val courseId = backStackEntry.arguments?.getInt(&quot;courseId&quot;) ?: 0&#10;                val scheduleId = backStackEntry.arguments?.getInt(&quot;scheduleId&quot;) ?: 0&#10;                SubmitionComplete(&#10;                    status = status,&#10;                    courseName = courseName,&#10;                    courseId = courseId,&#10;                    scheduleId = scheduleId,&#10;                    onBackClick = { navController.navigate(&quot;home&quot;) },&#10;                    onNavigateHome = { navController.navigate(&quot;home&quot;) }&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/api/MfaApi.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/api/MfaApi.kt" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package com.example.smartattendance.api&#10;&#10;import kotlinx.serialization.Serializable&#10;import java.security.SecureRandom&#10;import javax.crypto.Mac&#10;import javax.crypto.spec.SecretKeySpec&#10;import io.github.jan.supabase.postgrest.from&#10;import io.github.jan.supabase.postgrest.query.Columns&#10;&#10;object MfaApi {&#10;&#10;    @Serializable&#10;    data class MfaSettings(&#10;        val mfa_id: Int? = null,&#10;        val user_id: String,&#10;        val mfa_enabled: Boolean = false,&#10;        val mfa_secret: String? = null,&#10;        val backup_codes: List&lt;String&gt;? = null,&#10;        val created_at: String? = null,&#10;        val updated_at: String? = null&#10;    )&#10;&#10;    // Generate a random secret key for TOTP (Base32 encoded)&#10;    fun generateSecret(): String {&#10;        val random = SecureRandom()&#10;        val bytes = ByteArray(20)&#10;        random.nextBytes(bytes)&#10;        return encodeBase32(bytes)&#10;    }&#10;&#10;    // Generate backup codes (8 codes, 8 characters each)&#10;    fun generateBackupCodes(): List&lt;String&gt; {&#10;        val codes = mutableListOf&lt;String&gt;()&#10;        val chars = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;&#10;        val random = SecureRandom()&#10;&#10;        repeat(8) {&#10;            val code = (1..8)&#10;                .map { chars[random.nextInt(chars.length)] }&#10;                .joinToString(&quot;&quot;)&#10;                .chunked(4)&#10;                .joinToString(&quot;-&quot;)&#10;            codes.add(code)&#10;        }&#10;        return codes&#10;    }&#10;&#10;    // Verify TOTP code&#10;    fun verifyTOTP(secret: String, code: String, timeWindow: Int = 1): Boolean {&#10;        val currentTime = System.currentTimeMillis() / 1000 / 30&#10;&#10;        // Check current time window and adjacent windows&#10;        for (i in -timeWindow..timeWindow) {&#10;            val timeSlice = currentTime + i&#10;            val generatedCode = generateTOTP(secret, timeSlice)&#10;            if (generatedCode == code) {&#10;                return true&#10;            }&#10;        }&#10;        return false&#10;    }&#10;&#10;    // Generate TOTP code for a given time slice&#10;    private fun generateTOTP(secret: String, timeSlice: Long): String {&#10;        val decodedSecret = decodeBase32(secret)&#10;        val data = ByteArray(8)&#10;        var value = timeSlice&#10;        for (i in 7 downTo 0) {&#10;            data[i] = value.toByte()&#10;            value = value shr 8&#10;        }&#10;&#10;        val signKey = SecretKeySpec(decodedSecret, &quot;HmacSHA1&quot;)&#10;        val mac = Mac.getInstance(&quot;HmacSHA1&quot;)&#10;        mac.init(signKey)&#10;        val hash = mac.doFinal(data)&#10;&#10;        val offset = hash[hash.size - 1].toInt() and 0xf&#10;        val binary = ((hash[offset].toInt() and 0x7f) shl 24) or&#10;                ((hash[offset + 1].toInt() and 0xff) shl 16) or&#10;                ((hash[offset + 2].toInt() and 0xff) shl 8) or&#10;                (hash[offset + 3].toInt() and 0xff)&#10;&#10;        val otp = binary % 1000000&#10;        return String.format(&quot;%06d&quot;, otp)&#10;    }&#10;&#10;    // Get TOTP provisioning URI for QR code&#10;    fun getTOTPUri(secret: String, email: String, issuer: String = &quot;SmartAttendance&quot;): String {&#10;        return &quot;otpauth://totp/$issuer:$email?secret=$secret&amp;issuer=$issuer&quot;&#10;    }&#10;&#10;    // Base32 encoding&#10;    private fun encodeBase32(data: ByteArray): String {&#10;        val base32Chars = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&quot;&#10;        var result = &quot;&quot;&#10;        var bits = 0&#10;        var value = 0&#10;&#10;        for (b in data) {&#10;            value = (value shl 8) or (b.toInt() and 0xFF)&#10;            bits += 8&#10;            while (bits &gt;= 5) {&#10;                result += base32Chars[(value shr (bits - 5)) and 0x1F]&#10;                bits -= 5&#10;            }&#10;        }&#10;&#10;        if (bits &gt; 0) {&#10;            result += base32Chars[(value shl (5 - bits)) and 0x1F]&#10;        }&#10;&#10;        return result&#10;    }&#10;&#10;    // Base32 decoding&#10;    private fun decodeBase32(encoded: String): ByteArray {&#10;        val base32Chars = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&quot;&#10;        val result = mutableListOf&lt;Byte&gt;()&#10;        var bits = 0&#10;        var value = 0&#10;&#10;        for (c in encoded.uppercase()) {&#10;            if (c == '=') break&#10;            val index = base32Chars.indexOf(c)&#10;            if (index == -1) continue&#10;&#10;            value = (value shl 5) or index&#10;            bits += 5&#10;&#10;            if (bits &gt;= 8) {&#10;                result.add(((value shr (bits - 8)) and 0xFF).toByte())&#10;                bits -= 8&#10;            }&#10;        }&#10;&#10;        return result.toByteArray()&#10;    }&#10;&#10;    // Save MFA settings to database&#10;    suspend fun enableMfa(userId: String, secret: String, backupCodes: List&lt;String&gt;): Result&lt;Unit&gt; {&#10;        return try {&#10;            // Check if settings already exist&#10;            val existing = AuthApi.supabase.from(&quot;user_mfa_settings&quot;)&#10;                .select {&#10;                    filter {&#10;                        eq(&quot;user_id&quot;, userId)&#10;                    }&#10;                }.decodeSingleOrNull&lt;MfaSettings&gt;()&#10;            &#10;            if (existing != null) {&#10;                // Update existing settings&#10;                AuthApi.supabase.from(&quot;user_mfa_settings&quot;)&#10;                    .update({&#10;                        MfaSettings::mfa_enabled setTo true&#10;                        MfaSettings::mfa_secret setTo secret&#10;                        MfaSettings::backup_codes setTo backupCodes&#10;                    }) {&#10;                        filter {&#10;                            eq(&quot;user_id&quot;, userId)&#10;                        }&#10;                    }&#10;            } else {&#10;                // Insert new settings&#10;                val settings = MfaSettings(&#10;                    user_id = userId,&#10;                    mfa_enabled = true,&#10;                    mfa_secret = secret,&#10;                    backup_codes = backupCodes&#10;                )&#10;                AuthApi.supabase.from(&quot;user_mfa_settings&quot;).insert(settings)&#10;            }&#10;            Result.success(Unit)&#10;        } catch (e: Exception) {&#10;            Result.failure(Exception(&quot;Failed to enable MFA: ${e.message}&quot;))&#10;        }&#10;    }&#10;&#10;    // Disable MFA&#10;    suspend fun disableMfa(userId: String): Result&lt;Unit&gt; {&#10;        return try {&#10;            AuthApi.supabase.from(&quot;user_mfa_settings&quot;)&#10;                .update({&#10;                    MfaSettings::mfa_enabled setTo false&#10;                    MfaSettings::mfa_secret setTo null&#10;                    MfaSettings::backup_codes setTo null&#10;                }) {&#10;                    filter {&#10;                        eq(&quot;user_id&quot;, userId)&#10;                    }&#10;                }&#10;            Result.success(Unit)&#10;        } catch (e: Exception) {&#10;            Result.failure(Exception(&quot;Failed to disable MFA: ${e.message}&quot;))&#10;        }&#10;    }&#10;&#10;    // Get MFA settings for a user&#10;    suspend fun getMfaSettings(userId: String): Result&lt;MfaSettings?&gt; {&#10;        return try {&#10;            val settings = AuthApi.supabase.from(&quot;user_mfa_settings&quot;)&#10;                .select {&#10;                    filter {&#10;                        eq(&quot;user_id&quot;, userId)&#10;                    }&#10;                }.decodeSingleOrNull&lt;MfaSettings&gt;()&#10;            Result.success(settings)&#10;        } catch (e: Exception) {&#10;            Result.failure(Exception(&quot;Failed to get MFA settings: ${e.message}&quot;))&#10;        }&#10;    }&#10;    &#10;    // Verify MFA code (TOTP or backup code)&#10;    suspend fun verifyMfaCode(userId: String, code: String): Result&lt;Boolean&gt; {&#10;        return try {&#10;            val settings = getMfaSettings(userId).getOrNull()&#10;            &#10;            if (settings == null || !settings.mfa_enabled) {&#10;                return Result.success(false)&#10;            }&#10;            &#10;            // Try TOTP verification first&#10;            if (settings.mfa_secret != null &amp;&amp; verifyTOTP(settings.mfa_secret, code)) {&#10;                return Result.success(true)&#10;            }&#10;            &#10;            // Try backup codes&#10;            if (settings.backup_codes != null &amp;&amp; code.replace(&quot;-&quot;, &quot;&quot;) in settings.backup_codes.map { it.replace(&quot;-&quot;, &quot;&quot;) }) {&#10;                // Remove used backup code&#10;                val updatedCodes = settings.backup_codes.filter { it.replace(&quot;-&quot;, &quot;&quot;) != code.replace(&quot;-&quot;, &quot;&quot;) }&#10;                AuthApi.supabase.from(&quot;user_mfa_settings&quot;)&#10;                    .update({&#10;                        MfaSettings::backup_codes setTo updatedCodes&#10;                    }) {&#10;                        filter {&#10;                            eq(&quot;user_id&quot;, userId)&#10;                        }&#10;                    }&#10;                return Result.success(true)&#10;            }&#10;            &#10;            Result.success(false)&#10;        } catch (e: Exception) {&#10;            Result.failure(Exception(&quot;Failed to verify MFA code: ${e.message}&quot;))&#10;        }&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/HomeScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/HomeScreen.kt" />
              <option name="originalContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.Canvas&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.border&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyRow&#10;import androidx.compose.foundation.lazy.itemsIndexed&#10;import androidx.compose.foundation.lazy.rememberLazyListState&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.rounded.ExitToApp&#10;import androidx.compose.material.icons.outlined.CalendarToday&#10;import androidx.compose.material.icons.outlined.Description&#10;import androidx.compose.material3.*&#10;import androidx.compose.material3.pulltorefresh.PullToRefreshBox&#10;import androidx.compose.material3.pulltorefresh.rememberPullToRefreshState&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.StrokeCap&#10;import androidx.compose.ui.graphics.drawscope.Stroke&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.StatisticsApi&#10;import com.example.smartattendance.api.ScheduleApi&#10;import com.example.smartattendance.api.AttendanceApi&#10;import com.example.smartattendance.data.AttendanceStatistics&#10;import java.time.LocalTime&#10;import com.example.smartattendance.ui.theme.SmartAttendanceTheme&#10;import com.example.smartattendance.utils.SessionManager&#10;import java.time.LocalDate&#10;import java.time.format.DateTimeFormatter&#10;import java.util.Locale&#10;import kotlin.math.abs&#10;import kotlinx.coroutines.launch&#10;import androidx.compose.ui.platform.LocalContext&#10;import android.util.Log&#10;import androidx.core.view.WindowCompat&#10;import androidx.core.view.WindowInsetsControllerCompat&#10;import androidx.compose.ui.platform.LocalView&#10;import android.app.Activity&#10;import androidx.navigation.NavController&#10;import androidx.navigation.compose.rememberNavController&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HomeScreen(&#10;    user: AuthApi.User?,&#10;    sessionManager: SessionManager,&#10;    navController: NavController,&#10;    onLogout: () -&gt; Unit = {},&#10;    onDateClick: () -&gt; Unit = {},&#10;    onRequestPermission: () -&gt; Unit = {},&#10;    onBackClick: () -&gt; Unit = {}&#10;) {&#10;    val darkGray = Color(0xFF2C2D32)&#10;    val redColor = Color(0xFFE0697E)&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    // Set status bar color to match header&#10;    val view = LocalView.current&#10;    val window = (view.context as? Activity)?.window&#10;    window?.let {&#10;        WindowCompat.setDecorFitsSystemWindows(it, false)&#10;        val controller = WindowInsetsControllerCompat(it, view)&#10;        controller.isAppearanceLightStatusBars = true // Light icons on dark background&#10;        it.statusBarColor = 0xFF2C2D32.toInt()&#10;    }&#10;&#10;    // State untuk statistik presensi&#10;    var attendanceStatistics by remember { mutableStateOf(AttendanceStatistics.empty()) }&#10;    var isLoadingStatistics by remember { mutableStateOf(false) }&#10;    var statisticsError by remember { mutableStateOf&lt;String?&gt;(null) }&#10;&#10;    // State untuk weekly status&#10;    var weeklyStatus by remember { mutableStateOf&lt;Map&lt;String, String?&gt;&gt;(emptyMap()) }&#10;    var isLoadingWeekly by remember { mutableStateOf(false) }&#10;&#10;    // State untuk current schedule&#10;    var currentSchedule by remember { mutableStateOf&lt;CurrentScheduleInfo?&gt;(null) }&#10;    var isLoadingSchedule by remember { mutableStateOf(false) }&#10;&#10;    // State untuk tracking jika attendance sudah verified&#10;    var isAttendanceVerified by remember { mutableStateOf(false) }&#10;&#10;    // State untuk pull-to-refresh&#10;    var isRefreshing by remember { mutableStateOf(false) }&#10;&#10;    // Initialize StatisticsApi and ScheduleApi&#10;    val statisticsApi = remember { StatisticsApi(AuthApi.supabase) }&#10;    val scheduleApi = remember { ScheduleApi(AuthApi.supabase) }&#10;    val attendanceApi = remember { AttendanceApi(AuthApi.supabase) }&#10;&#10;    // Function to load all data&#10;    suspend fun loadData() {&#10;        user?.user_id?.let { userId -&gt;&#10;            try {&#10;                // Fetch overall statistics&#10;                val statsResult = statisticsApi.getUserStatistics(userId)&#10;                statsResult.fold(&#10;                    onSuccess = { statistics -&gt;&#10;                        attendanceStatistics = AttendanceStatistics.fromOverallStatistic(statistics)&#10;                        Log.d(&quot;HomeScreen&quot;, &quot;Statistics loaded: $attendanceStatistics&quot;)&#10;                    },&#10;                    onFailure = { error -&gt;&#10;                        statisticsError = error.message ?: &quot;Failed to load statistics&quot;&#10;                        Log.e(&quot;HomeScreen&quot;, &quot;Error loading statistics&quot;, error)&#10;                    }&#10;                )&#10;&#10;                // Fetch weekly status&#10;                val weeklyResult = statisticsApi.getWeeklyStatus(userId)&#10;                weeklyResult.fold(&#10;                    onSuccess = { weekly -&gt;&#10;                        weeklyStatus = weekly&#10;                        Log.d(&quot;HomeScreen&quot;, &quot;Weekly status loaded: $weeklyStatus&quot;)&#10;                    },&#10;                    onFailure = { error -&gt;&#10;                        Log.e(&quot;HomeScreen&quot;, &quot;Error loading weekly status&quot;, error)&#10;                    }&#10;                )&#10;&#10;                // Fetch today's schedules&#10;                val todayResult = scheduleApi.getTodaySchedules(userId)&#10;                todayResult.fold(&#10;                    onSuccess = { schedules -&gt;&#10;                        Log.d(&quot;HomeScreen&quot;, &quot;Today schedules loaded: ${schedules.size} items&quot;)&#10;                        currentSchedule = determineCurrentSchedule(schedules)&#10;                        Log.d(&quot;HomeScreen&quot;, &quot;Current schedule: $currentSchedule&quot;)&#10;&#10;                        // Check if attendance is already verified for current schedule&#10;                        currentSchedule?.let { schedule -&gt;&#10;                            val attendanceResult = attendanceApi.getTodayAttendance(&#10;                                userId,&#10;                                schedule.scheduleId,&#10;                                schedule.courseId&#10;                            )&#10;                            attendanceResult.fold(&#10;                                onSuccess = { attendance -&gt;&#10;                                    isAttendanceVerified = attendance?.is_verified == true&#10;                                    Log.d(&quot;HomeScreen&quot;, &quot;Attendance verified status: $isAttendanceVerified&quot;)&#10;                                },&#10;                                onFailure = {&#10;                                    isAttendanceVerified = false&#10;                                }&#10;                            )&#10;                        } ?: run {&#10;                            isAttendanceVerified = false&#10;                        }&#10;                    },&#10;                    onFailure = { error -&gt;&#10;                        Log.e(&quot;HomeScreen&quot;, &quot;Error loading today schedules&quot;, error)&#10;                    }&#10;                )&#10;            } catch (e: Exception) {&#10;                statisticsError = e.message ?: &quot;Unknown error occurred&quot;&#10;                Log.e(&quot;HomeScreen&quot;, &quot;Exception loading statistics&quot;, e)&#10;            }&#10;        }&#10;    }&#10;&#10;    // Fetch statistics saat pertama kali load&#10;    LaunchedEffect(user?.user_id) {&#10;        isLoadingStatistics = true&#10;        isLoadingWeekly = true&#10;        isLoadingSchedule = true&#10;        statisticsError = null&#10;&#10;        loadData()&#10;&#10;        isLoadingStatistics = false&#10;        isLoadingWeekly = false&#10;        isLoadingSchedule = false&#10;    }&#10;&#10;    // Get current date&#10;    val currentDate = remember { LocalDate.now() }&#10;    val dayOfMonth = currentDate.dayOfMonth&#10;    val dayOfWeek = currentDate.dayOfWeek&#10;    val month = currentDate.format(DateTimeFormatter.ofPattern(&quot;MMMM&quot;, Locale.ENGLISH))&#10;    val year = currentDate.year&#10;    val dayName = dayOfWeek.getDisplayName(java.time.format.TextStyle.FULL, Locale.ENGLISH)&#10;&#10;    PullToRefreshBox(&#10;        isRefreshing = isRefreshing,&#10;        onRefresh = {&#10;            coroutineScope.launch {&#10;                isRefreshing = true&#10;                loadData()&#10;                isRefreshing = false&#10;            }&#10;        },&#10;        modifier = Modifier.fillMaxSize()&#10;    ) {&#10;        Box(&#10;            modifier = Modifier.fillMaxSize()&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.fillMaxSize()&#10;            ) {&#10;                // Background split - dark gray top, white bottom&#10;                Box(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .weight(0.4f)&#10;                        .background(color = darkGray)&#10;                )&#10;                Box(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .weight(0.6f)&#10;                        .background(color = Color.White)&#10;                )&#10;            }&#10;&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .verticalScroll(rememberScrollState())&#10;            ) {&#10;                // Header section&#10;                Row(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(horizontal = 25.dp, vertical = 20.dp),&#10;                    horizontalArrangement = Arrangement.SpaceBetween,&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    Column {&#10;                        Text(&#10;                            text = &quot;Hello, ${user?.full_name?.split(&quot; &quot;)?.firstOrNull() ?: &quot;User&quot;}!&quot;,&#10;                            fontSize = 28.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = Color.White&#10;                        )&#10;                        Text(&#10;                            text = &quot;${user?.nim ?: &quot;Unknown&quot;}/Semester Ganjil&quot;,&#10;                            fontSize = 14.sp,&#10;                            color = Color.White.copy(alpha = 0.8f)&#10;                        )&#10;                    }&#10;&#10;                    IconButton(onClick = {&#10;                        coroutineScope.launch {&#10;                            sessionManager.clearSession()&#10;                            onLogout()&#10;                        }&#10;                    }) {&#10;                        Icon(&#10;                            imageVector = Icons.AutoMirrored.Rounded.ExitToApp,&#10;                            contentDescription = &quot;Logout&quot;,&#10;                            tint = Color.White,&#10;                            modifier = Modifier.size(40.dp)&#10;                        )&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                // Cards section with proper padding&#10;                Column(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(horizontal = 25.dp)&#10;                ) {&#10;                // Take attendance card - dynamic based on schedule&#10;                if (isLoadingSchedule) {&#10;                    // Loading state&#10;                    Card(&#10;                        modifier = Modifier.fillMaxWidth(),&#10;                        shape = RoundedCornerShape(10.dp),&#10;                        colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                        elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                    ) {&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .fillMaxWidth()&#10;                                .padding(16.dp),&#10;                            contentAlignment = Alignment.Center&#10;                        ) {&#10;                            CircularProgressIndicator(&#10;                                color = darkGray,&#10;                                modifier = Modifier.size(24.dp)&#10;                            )&#10;                        }&#10;                    }&#10;                } else {&#10;                    // Show current or upcoming schedule&#10;                    currentSchedule?.let { schedule -&gt;&#10;                        Card(&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            shape = RoundedCornerShape(10.dp),&#10;                            colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                            elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                        ) {&#10;                            Row(&#10;                                verticalAlignment = Alignment.CenterVertically,&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .padding(horizontal = 12.dp, vertical = 8.dp)&#10;                            ) {&#10;                                Icon(&#10;                                    imageVector = Icons.Outlined.CalendarToday,&#10;                                    contentDescription = &quot;Calendar&quot;,&#10;                                    tint = Color.Black,&#10;                                    modifier = Modifier.size(20.dp)&#10;                                )&#10;                                Spacer(modifier = Modifier.width(8.dp))&#10;                                Column(&#10;                                    modifier = Modifier.weight(1f)&#10;                                ) {&#10;                                    Text(&#10;                                        text = schedule.courseName.uppercase(),&#10;                                        fontSize = 14.sp,&#10;                                        color = Color.Black,&#10;                                        fontWeight = FontWeight.Medium,&#10;                                        maxLines = 2&#10;                                    )&#10;                                    Text(&#10;                                        text = schedule.time,&#10;                                        fontSize = 12.sp,&#10;                                        color = Color.Gray,&#10;                                        modifier = Modifier.padding(top = 2.dp)&#10;                                    )&#10;                                }&#10;                                Spacer(modifier = Modifier.width(8.dp))&#10;                                if (schedule.isActive &amp;&amp; !isAttendanceVerified) {&#10;                                    // Show Submit button only if class is active AND attendance not yet verified&#10;                                    Button(&#10;                                        onClick = {&#10;                                            // Navigasi ke SubmissionScreen dengan parameter jadwal aktif&#10;                                            navController.navigate(&quot;submission_screen/${schedule.scheduleId}/${schedule.courseId}&quot;)&#10;                                        },&#10;                                        colors = ButtonDefaults.buttonColors(containerColor = redColor),&#10;                                        shape = RoundedCornerShape(8.dp),&#10;                                        modifier = Modifier.height(32.dp)&#10;                                    ) {&#10;                                        Text(&quot;Submit&quot;, fontSize = 14.sp, color = Color.White)&#10;                                    }&#10;                                } else if (schedule.isActive &amp;&amp; isAttendanceVerified) {&#10;                                    // Show &quot;Verified&quot; indicator if attendance is already verified&#10;                                    Surface(&#10;                                        color = Color(0xFF4CAF50),&#10;                                        shape = RoundedCornerShape(8.dp),&#10;                                        modifier = Modifier.height(32.dp)&#10;                                    ) {&#10;                                        Box(&#10;                                            modifier = Modifier.padding(horizontal = 12.dp),&#10;                                            contentAlignment = Alignment.Center&#10;                                        ) {&#10;                                            Text(&#10;                                                text = &quot;Verified&quot;,&#10;                                                fontSize = 14.sp,&#10;                                                color = Color.White,&#10;                                                fontWeight = FontWeight.Medium&#10;                                            )&#10;                                        }&#10;                                    }&#10;                                } else {&#10;                                    // Show &quot;Not Yet&quot; indicator for upcoming class&#10;                                    Surface(&#10;                                        color = Color(0xFFE0E0E0),&#10;                                        shape = RoundedCornerShape(8.dp),&#10;                                        modifier = Modifier.height(32.dp)&#10;                                    ) {&#10;                                        Box(&#10;                                            modifier = Modifier.padding(horizontal = 12.dp),&#10;                                            contentAlignment = Alignment.Center&#10;                                        ) {&#10;                                            Text(&#10;                                                text = &quot;Not Yet&quot;,&#10;                                                fontSize = 14.sp,&#10;                                                color = Color.Gray,&#10;                                                fontWeight = FontWeight.Medium&#10;                                            )&#10;                                        }&#10;                                    }&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Date card&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .clickable { onDateClick() },&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier.padding(20.dp)&#10;                    ) {&#10;                        Row(&#10;                            verticalAlignment = Alignment.CenterVertically&#10;                        ) {&#10;                            Text(&#10;                                text = dayOfMonth.toString(),&#10;                                fontSize = 70.sp,&#10;                                fontWeight = FontWeight.Bold,&#10;                                color = Color.Black&#10;                            )&#10;                            Spacer(modifier = Modifier.width(16.dp))&#10;                            Column {&#10;                                Text(&#10;                                    text = dayName,&#10;                                    fontSize = 20.sp,&#10;                                    fontWeight = FontWeight.Medium,&#10;                                    color = Color.Black&#10;                                )&#10;                                Text(&#10;                                    text = &quot;$month $year&quot;,&#10;                                    fontSize = 14.sp,&#10;                                    color = Color.Gray&#10;                                )&#10;                            }&#10;                        }&#10;&#10;                        Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                        Text(&#10;                            text = &quot;This week status&quot;,&#10;                            fontSize = 14.sp,&#10;                            color = Color.Gray,&#10;                            modifier = Modifier.padding(bottom = 12.dp)&#10;                        )&#10;&#10;                        if (isLoadingWeekly) {&#10;                            // Loading state for weekly status&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .height(50.dp),&#10;                                contentAlignment = Alignment.Center&#10;                            ) {&#10;                                CircularProgressIndicator(&#10;                                    color = darkGray,&#10;                                    modifier = Modifier.size(24.dp)&#10;                                )&#10;                            }&#10;                        } else {&#10;                            // Display weekly status from database&#10;                            Row(&#10;                                modifier = Modifier.fillMaxWidth(),&#10;                                horizontalArrangement = Arrangement.SpaceEvenly&#10;                            ) {&#10;                                WeekDayIndicator(&#10;                                    day = &quot;M&quot;,&#10;                                    status = weeklyStatus[&quot;monday&quot;],&#10;                                    darkGray = darkGray,&#10;                                    redColor = redColor&#10;                                )&#10;                                WeekDayIndicator(&#10;                                    day = &quot;T&quot;,&#10;                                    status = weeklyStatus[&quot;tuesday&quot;],&#10;                                    darkGray = darkGray,&#10;                                    redColor = redColor&#10;                                )&#10;                                WeekDayIndicator(&#10;                                    day = &quot;W&quot;,&#10;                                    status = weeklyStatus[&quot;wednesday&quot;],&#10;                                    darkGray = darkGray,&#10;                                    redColor = redColor&#10;                                )&#10;                                WeekDayIndicator(&#10;                                    day = &quot;Th&quot;,&#10;                                    status = weeklyStatus[&quot;thursday&quot;],&#10;                                    darkGray = darkGray,&#10;                                    redColor = redColor&#10;                                )&#10;                                WeekDayIndicator(&#10;                                    day = &quot;F&quot;,&#10;                                    status = weeklyStatus[&quot;friday&quot;],&#10;                                    darkGray = darkGray,&#10;                                    redColor = redColor&#10;                                )&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Statistics Card&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(20.dp)&#10;                    ) {&#10;                        Text(&#10;                            text = &quot;This Semester&quot;,&#10;                            fontSize = 16.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = Color.Black,&#10;                            modifier = Modifier.padding(bottom = 16.dp)&#10;                        )&#10;&#10;                        if (isLoadingStatistics) {&#10;                            // Loading state&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .height(100.dp),&#10;                                contentAlignment = Alignment.Center&#10;                            ) {&#10;                                CircularProgressIndicator(&#10;                                    color = darkGray,&#10;                                    modifier = Modifier.size(40.dp)&#10;                                )&#10;                            }&#10;                        } else if (statisticsError != null) {&#10;                            // Error state&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .height(100.dp),&#10;                                contentAlignment = Alignment.Center&#10;                            ) {&#10;                                Text(&#10;                                    text = &quot;Failed to load statistics&quot;,&#10;                                    color = Color.Red,&#10;                                    fontSize = 14.sp&#10;                                )&#10;                            }&#10;                        } else {&#10;                            // Donut charts - Scrollable horizontal dengan 5 charts&#10;                            LazyRow(&#10;                                modifier = Modifier.fillMaxWidth(),&#10;                                horizontalArrangement = Arrangement.spacedBy(20.dp),&#10;                                contentPadding = PaddingValues(horizontal = 8.dp)&#10;                            ) {&#10;                                item {&#10;                                    IndividualDonutChart(&#10;                                        value = attendanceStatistics.present,&#10;                                        percentage = attendanceStatistics.presentPercentage,&#10;                                        label = &quot;Present&quot;,&#10;                                        color = Color(0xFF4CAF50)&#10;                                    )&#10;                                }&#10;                                item {&#10;                                    IndividualDonutChart(&#10;                                        value = attendanceStatistics.late,&#10;                                        percentage = attendanceStatistics.latePercentage,&#10;                                        label = &quot;Late&quot;,&#10;                                        color = Color(0xFFFF9800)&#10;                                    )&#10;                                }&#10;                                item {&#10;                                    IndividualDonutChart(&#10;                                        value = attendanceStatistics.excused,&#10;                                        percentage = attendanceStatistics.excusedPercentage,&#10;                                        label = &quot;Excused&quot;,&#10;                                        color = Color(0xFF2196F3)&#10;                                    )&#10;                                }&#10;                                item {&#10;                                    IndividualDonutChart(&#10;                                        value = attendanceStatistics.sick,&#10;                                        percentage = attendanceStatistics.sickPercentage,&#10;                                        label = &quot;Sick&quot;,&#10;                                        color = Color(0xFFFFC107)&#10;                                    )&#10;                                }&#10;                                item {&#10;                                    IndividualDonutChart(&#10;                                        value = attendanceStatistics.absent,&#10;                                        percentage = attendanceStatistics.absentPercentage,&#10;                                        label = &quot;Absent&quot;,&#10;                                        color = Color(0xFF9E9E9E)&#10;                                    )&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Request Permission card&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .clickable { onRequestPermission() },&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(24.dp),&#10;                        horizontalAlignment = Alignment.CenterHorizontally&#10;                    ) {&#10;                        Icon(&#10;                            imageVector = Icons.Outlined.Description,&#10;                            contentDescription = &quot;Request Permission&quot;,&#10;                            tint = Color.Black,&#10;                            modifier = Modifier.size(36.dp)&#10;                        )&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                        Text(&#10;                            text = &quot;Ask Permission&quot;,&#10;                            fontSize = 14.sp,&#10;                            color = Color.Black&#10;                        )&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;            }&#10;        }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun WeekDayIndicator(&#10;    day: String,&#10;    status: String?,&#10;    darkGray: Color,&#10;    redColor: Color&#10;) {&#10;    // Determine color based on attendance status&#10;    val color = when (status) {&#10;        &quot;present&quot; -&gt; Color(0xFF4CAF50)  // Green for present&#10;        &quot;late&quot; -&gt; Color(0xFFFF9800)      // Orange for late&#10;        &quot;absent&quot; -&gt; redColor              // Red for absent&#10;        &quot;excused&quot; -&gt; Color(0xFF2196F3)   // Blue for excused&#10;        &quot;sick&quot; -&gt; Color(0xFFFFC107)      // Yellow for sick&#10;        null -&gt; Color.LightGray           // Light gray for no data&#10;        else -&gt; Color.LightGray&#10;    }&#10;&#10;    val attended = status != null&#10;&#10;    Box(&#10;        modifier = Modifier&#10;            .size(40.dp)&#10;            .clip(CircleShape)&#10;            .background(if (attended) color else Color.White)&#10;            .border(2.dp, color, CircleShape),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Text(&#10;            text = day,&#10;            color = if (attended) Color.White else color,&#10;            fontWeight = FontWeight.Bold,&#10;            fontSize = 12.sp&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun IndividualDonutChart(&#10;    value: Int,&#10;    percentage: Float,&#10;    label: String,&#10;    color: Color&#10;) {&#10;    Column(&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Box(&#10;            modifier = Modifier.size(60.dp),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Canvas(modifier = Modifier.fillMaxSize()) {&#10;                val strokeWidth = 8.dp.toPx()&#10;                // Background circle&#10;                drawCircle(&#10;                    color = Color.LightGray.copy(alpha = 0.3f),&#10;                    style = Stroke(width = strokeWidth)&#10;                )&#10;                // Foreground arc&#10;                drawArc(&#10;                    color = color,&#10;                    startAngle = -90f,&#10;                    sweepAngle = percentage * 360 / 100, // Convert percentage to angle&#10;                    useCenter = false,&#10;                    style = Stroke(width = strokeWidth, cap = StrokeCap.Round)&#10;                )&#10;            }&#10;            Text(&#10;                text = value.toString(),&#10;                fontSize = 16.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.Black&#10;            )&#10;        }&#10;        Spacer(modifier = Modifier.height(4.dp))&#10;        Text(&#10;            text = label,&#10;            fontSize = 12.sp,&#10;            color = Color.Gray&#10;        )&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun HomeScreenPreview() {&#10;    SmartAttendanceTheme {&#10;        HomeScreen(user = AuthApi.User(full_name = &quot;Teo&quot;, email = &quot;&quot;, password_hash = &quot;&quot;), sessionManager = SessionManager(LocalContext.current), navController = rememberNavController())&#10;    }&#10;}&#10;&#10;// Data class for current schedule info&#10;data class CurrentScheduleInfo(&#10;    val courseName: String,&#10;    val time: String,&#10;    val isActive: Boolean,  // true if class is currently in session (within 15 min window)&#10;    val scheduleId: Int,    // id jadwal&#10;    val courseId: Int       // id course&#10;)&#10;&#10;// Local data class to match ScheduleApi.ScheduleItem structure&#10;private data class ScheduleItemData(&#10;    val title: String,&#10;    val time: String&#10;)&#10;&#10;// Helper function to determine current or next schedule&#10;private fun determineCurrentSchedule(schedules: List&lt;Any&gt;): CurrentScheduleInfo? {&#10;    if (schedules.isEmpty()) return null&#10;&#10;    val now = LocalTime.now()&#10;    val formatter = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;)&#10;&#10;    // Find if there's a class currently active (within 15 minutes of start time)&#10;    for (schedule in schedules) {&#10;        try {&#10;            // Access properties using reflection&#10;            val titleField = schedule::class.java.getDeclaredField(&quot;title&quot;)&#10;            val timeField = schedule::class.java.getDeclaredField(&quot;time&quot;)&#10;            val scheduleIdField = schedule::class.java.getDeclaredField(&quot;scheduleId&quot;)&#10;            val courseIdField = schedule::class.java.getDeclaredField(&quot;courseId&quot;)&#10;            titleField.isAccessible = true&#10;            timeField.isAccessible = true&#10;            scheduleIdField.isAccessible = true&#10;            courseIdField.isAccessible = true&#10;&#10;            val title = titleField.get(schedule) as String&#10;            val time = timeField.get(schedule) as String&#10;            val scheduleId = (scheduleIdField.get(schedule) as Number).toInt()&#10;            val courseId = (courseIdField.get(schedule) as Number).toInt()&#10;&#10;            // Extract course name from title (format: &quot;Course Name - CODE - ROOM&quot;)&#10;            val courseName = title.split(&quot; - &quot;).getOrNull(0) ?: title&#10;            val timeRange = time.split(&quot; - &quot;)&#10;            if (timeRange.size != 2) continue&#10;&#10;            val startTimeStr = convertTo24Hour(timeRange[0].trim())&#10;            val endTimeStr = convertTo24Hour(timeRange[1].trim())&#10;&#10;            val startTime = LocalTime.parse(startTimeStr, formatter)&#10;            val endTime = LocalTime.parse(endTimeStr, formatter)&#10;&#10;            // Check if class is in progress or within 15 minutes before start&#10;            val fifteenMinutesBefore = startTime.minusMinutes(15)&#10;&#10;            if (now.isAfter(fifteenMinutesBefore) &amp;&amp; now.isBefore(endTime)) {&#10;                // Class is active or about to start&#10;                return CurrentScheduleInfo(&#10;                    courseName = courseName,&#10;                    time = time,&#10;                    isActive = true,&#10;                    scheduleId = scheduleId,&#10;                    courseId = courseId&#10;                )&#10;            }&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;HomeScreen&quot;, &quot;Error parsing schedule&quot;, e)&#10;        }&#10;    }&#10;&#10;    // No active class, find the next upcoming class&#10;    for (schedule in schedules) {&#10;        try {&#10;            val titleField = schedule::class.java.getDeclaredField(&quot;title&quot;)&#10;            val timeField = schedule::class.java.getDeclaredField(&quot;time&quot;)&#10;            val scheduleIdField = schedule::class.java.getDeclaredField(&quot;scheduleId&quot;)&#10;            val courseIdField = schedule::class.java.getDeclaredField(&quot;courseId&quot;)&#10;            titleField.isAccessible = true&#10;            timeField.isAccessible = true&#10;            scheduleIdField.isAccessible = true&#10;            courseIdField.isAccessible = true&#10;&#10;            val title = titleField.get(schedule) as String&#10;            val time = timeField.get(schedule) as String&#10;            val scheduleId = (scheduleIdField.get(schedule) as Number).toInt()&#10;            val courseId = (courseIdField.get(schedule) as Number).toInt()&#10;&#10;            val courseName = title.split(&quot; - &quot;).getOrNull(0) ?: title&#10;            val timeRange = time.split(&quot; - &quot;)&#10;            if (timeRange.size != 2) continue&#10;&#10;            val startTimeStr = convertTo24Hour(timeRange[0].trim())&#10;            val startTime = LocalTime.parse(startTimeStr, formatter)&#10;&#10;            if (now.isBefore(startTime)) {&#10;                // This is the next class&#10;                return CurrentScheduleInfo(&#10;                    courseName = courseName,&#10;                    time = time,&#10;                    isActive = false,&#10;                    scheduleId = scheduleId,&#10;                    courseId = courseId&#10;                )&#10;            }&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;HomeScreen&quot;, &quot;Error parsing schedule&quot;, e)&#10;        }&#10;    }&#10;&#10;    // All classes have passed for today&#10;    return null&#10;}&#10;&#10;// Helper function to convert 12-hour format to 24-hour format&#10;private fun convertTo24Hour(time12h: String): String {&#10;    return try {&#10;        val parts = time12h.split(&quot; &quot;)&#10;        if (parts.size != 2) return &quot;00:00:00&quot;&#10;&#10;        val timePart = parts[0]&#10;        val period = parts[1].uppercase()&#10;&#10;        val timeParts = timePart.split(&quot;:&quot;)&#10;        if (timeParts.size != 2) return &quot;00:00:00&quot;&#10;&#10;        var hour = timeParts[0].toInt()&#10;        val minute = timeParts[1]&#10;&#10;        // Convert to 24-hour format&#10;        if (period == &quot;PM&quot; &amp;&amp; hour != 12) {&#10;            hour += 12&#10;        } else if (period == &quot;AM&quot; &amp;&amp; hour == 12) {&#10;            hour = 0&#10;        }&#10;&#10;        String.format(&quot;%02d:%s:00&quot;, hour, minute)&#10;    } catch (e: Exception) {&#10;        Log.e(&quot;HomeScreen&quot;, &quot;Error converting time: $time12h&quot;, e)&#10;        &quot;00:00:00&quot;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.Canvas&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.border&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyRow&#10;import androidx.compose.foundation.lazy.itemsIndexed&#10;import androidx.compose.foundation.lazy.rememberLazyListState&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.rounded.ExitToApp&#10;import androidx.compose.material.icons.filled.Security&#10;import androidx.compose.material.icons.outlined.CalendarToday&#10;import androidx.compose.material.icons.outlined.Description&#10;import androidx.compose.material3.*&#10;import androidx.compose.material3.pulltorefresh.PullToRefreshBox&#10;import androidx.compose.material3.pulltorefresh.rememberPullToRefreshState&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.StrokeCap&#10;import androidx.compose.ui.graphics.drawscope.Stroke&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.StatisticsApi&#10;import com.example.smartattendance.api.ScheduleApi&#10;import com.example.smartattendance.api.AttendanceApi&#10;import com.example.smartattendance.data.AttendanceStatistics&#10;import java.time.LocalTime&#10;import com.example.smartattendance.ui.theme.SmartAttendanceTheme&#10;import com.example.smartattendance.utils.SessionManager&#10;import java.time.LocalDate&#10;import java.time.format.DateTimeFormatter&#10;import java.util.Locale&#10;import kotlin.math.abs&#10;import kotlinx.coroutines.launch&#10;import androidx.compose.ui.platform.LocalContext&#10;import android.util.Log&#10;import androidx.core.view.WindowCompat&#10;import androidx.core.view.WindowInsetsControllerCompat&#10;import androidx.compose.ui.platform.LocalView&#10;import android.app.Activity&#10;import androidx.navigation.NavController&#10;import androidx.navigation.compose.rememberNavController&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HomeScreen(&#10;    user: AuthApi.User?,&#10;    sessionManager: SessionManager,&#10;    navController: NavController,&#10;    onLogout: () -&gt; Unit = {},&#10;    onDateClick: () -&gt; Unit = {},&#10;    onRequestPermission: () -&gt; Unit = {},&#10;    onBackClick: () -&gt; Unit = {}&#10;) {&#10;    val darkGray = Color(0xFF2C2D32)&#10;    val redColor = Color(0xFFE0697E)&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    // Set status bar color to match header&#10;    val view = LocalView.current&#10;    val window = (view.context as? Activity)?.window&#10;    window?.let {&#10;        WindowCompat.setDecorFitsSystemWindows(it, false)&#10;        val controller = WindowInsetsControllerCompat(it, view)&#10;        controller.isAppearanceLightStatusBars = true // Light icons on dark background&#10;        it.statusBarColor = 0xFF2C2D32.toInt()&#10;    }&#10;&#10;    // State untuk statistik presensi&#10;    var attendanceStatistics by remember { mutableStateOf(AttendanceStatistics.empty()) }&#10;    var isLoadingStatistics by remember { mutableStateOf(false) }&#10;    var statisticsError by remember { mutableStateOf&lt;String?&gt;(null) }&#10;&#10;    // State untuk weekly status&#10;    var weeklyStatus by remember { mutableStateOf&lt;Map&lt;String, String?&gt;&gt;(emptyMap()) }&#10;    var isLoadingWeekly by remember { mutableStateOf(false) }&#10;&#10;    // State untuk current schedule&#10;    var currentSchedule by remember { mutableStateOf&lt;CurrentScheduleInfo?&gt;(null) }&#10;    var isLoadingSchedule by remember { mutableStateOf(false) }&#10;&#10;    // State untuk tracking jika attendance sudah verified&#10;    var isAttendanceVerified by remember { mutableStateOf(false) }&#10;&#10;    // State untuk pull-to-refresh&#10;    var isRefreshing by remember { mutableStateOf(false) }&#10;&#10;    // Initialize StatisticsApi and ScheduleApi&#10;    val statisticsApi = remember { StatisticsApi(AuthApi.supabase) }&#10;    val scheduleApi = remember { ScheduleApi(AuthApi.supabase) }&#10;    val attendanceApi = remember { AttendanceApi(AuthApi.supabase) }&#10;&#10;    // Function to load all data&#10;    suspend fun loadData() {&#10;        user?.user_id?.let { userId -&gt;&#10;            try {&#10;                // Fetch overall statistics&#10;                val statsResult = statisticsApi.getUserStatistics(userId)&#10;                statsResult.fold(&#10;                    onSuccess = { statistics -&gt;&#10;                        attendanceStatistics = AttendanceStatistics.fromOverallStatistic(statistics)&#10;                        Log.d(&quot;HomeScreen&quot;, &quot;Statistics loaded: $attendanceStatistics&quot;)&#10;                    },&#10;                    onFailure = { error -&gt;&#10;                        statisticsError = error.message ?: &quot;Failed to load statistics&quot;&#10;                        Log.e(&quot;HomeScreen&quot;, &quot;Error loading statistics&quot;, error)&#10;                    }&#10;                )&#10;&#10;                // Fetch weekly status&#10;                val weeklyResult = statisticsApi.getWeeklyStatus(userId)&#10;                weeklyResult.fold(&#10;                    onSuccess = { weekly -&gt;&#10;                        weeklyStatus = weekly&#10;                        Log.d(&quot;HomeScreen&quot;, &quot;Weekly status loaded: $weeklyStatus&quot;)&#10;                    },&#10;                    onFailure = { error -&gt;&#10;                        Log.e(&quot;HomeScreen&quot;, &quot;Error loading weekly status&quot;, error)&#10;                    }&#10;                )&#10;&#10;                // Fetch today's schedules&#10;                val todayResult = scheduleApi.getTodaySchedules(userId)&#10;                todayResult.fold(&#10;                    onSuccess = { schedules -&gt;&#10;                        Log.d(&quot;HomeScreen&quot;, &quot;Today schedules loaded: ${schedules.size} items&quot;)&#10;                        currentSchedule = determineCurrentSchedule(schedules)&#10;                        Log.d(&quot;HomeScreen&quot;, &quot;Current schedule: $currentSchedule&quot;)&#10;&#10;                        // Check if attendance is already verified for current schedule&#10;                        currentSchedule?.let { schedule -&gt;&#10;                            val attendanceResult = attendanceApi.getTodayAttendance(&#10;                                userId,&#10;                                schedule.scheduleId,&#10;                                schedule.courseId&#10;                            )&#10;                            attendanceResult.fold(&#10;                                onSuccess = { attendance -&gt;&#10;                                    isAttendanceVerified = attendance?.is_verified == true&#10;                                    Log.d(&quot;HomeScreen&quot;, &quot;Attendance verified status: $isAttendanceVerified&quot;)&#10;                                },&#10;                                onFailure = {&#10;                                    isAttendanceVerified = false&#10;                                }&#10;                            )&#10;                        } ?: run {&#10;                            isAttendanceVerified = false&#10;                        }&#10;                    },&#10;                    onFailure = { error -&gt;&#10;                        Log.e(&quot;HomeScreen&quot;, &quot;Error loading today schedules&quot;, error)&#10;                    }&#10;                )&#10;            } catch (e: Exception) {&#10;                statisticsError = e.message ?: &quot;Unknown error occurred&quot;&#10;                Log.e(&quot;HomeScreen&quot;, &quot;Exception loading statistics&quot;, e)&#10;            }&#10;        }&#10;    }&#10;&#10;    // Fetch statistics saat pertama kali load&#10;    LaunchedEffect(user?.user_id) {&#10;        isLoadingStatistics = true&#10;        isLoadingWeekly = true&#10;        isLoadingSchedule = true&#10;        statisticsError = null&#10;&#10;        loadData()&#10;&#10;        isLoadingStatistics = false&#10;        isLoadingWeekly = false&#10;        isLoadingSchedule = false&#10;    }&#10;&#10;    // Get current date&#10;    val currentDate = remember { LocalDate.now() }&#10;    val dayOfMonth = currentDate.dayOfMonth&#10;    val dayOfWeek = currentDate.dayOfWeek&#10;    val month = currentDate.format(DateTimeFormatter.ofPattern(&quot;MMMM&quot;, Locale.ENGLISH))&#10;    val year = currentDate.year&#10;    val dayName = dayOfWeek.getDisplayName(java.time.format.TextStyle.FULL, Locale.ENGLISH)&#10;&#10;    PullToRefreshBox(&#10;        isRefreshing = isRefreshing,&#10;        onRefresh = {&#10;            coroutineScope.launch {&#10;                isRefreshing = true&#10;                loadData()&#10;                isRefreshing = false&#10;            }&#10;        },&#10;        modifier = Modifier.fillMaxSize()&#10;    ) {&#10;        Box(&#10;            modifier = Modifier.fillMaxSize()&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.fillMaxSize()&#10;            ) {&#10;                // Background split - dark gray top, white bottom&#10;                Box(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .weight(0.4f)&#10;                        .background(color = darkGray)&#10;                )&#10;                Box(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .weight(0.6f)&#10;                        .background(color = Color.White)&#10;                )&#10;            }&#10;&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .verticalScroll(rememberScrollState())&#10;            ) {&#10;                // Header section&#10;                Row(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(horizontal = 25.dp, vertical = 20.dp),&#10;                    horizontalArrangement = Arrangement.SpaceBetween,&#10;                    verticalAlignment = Alignment.CenterVertically&#10;                ) {&#10;                    Column {&#10;                        Text(&#10;                            text = &quot;Hello, ${user?.full_name?.split(&quot; &quot;)?.firstOrNull() ?: &quot;User&quot;}!&quot;,&#10;                            fontSize = 28.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = Color.White&#10;                        )&#10;                        Text(&#10;                            text = &quot;${user?.nim ?: &quot;Unknown&quot;}/Semester Ganjil&quot;,&#10;                            fontSize = 14.sp,&#10;                            color = Color.White.copy(alpha = 0.8f)&#10;                        )&#10;                    }&#10;&#10;                    Row(&#10;                        horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;                    ) {&#10;                        IconButton(onClick = {&#10;                            navController.navigate(&quot;mfa_settings&quot;)&#10;                        }) {&#10;                            Icon(&#10;                                imageVector = Icons.Default.Security,&#10;                                contentDescription = &quot;MFA Settings&quot;,&#10;                                tint = Color.White,&#10;                                modifier = Modifier.size(28.dp)&#10;                            )&#10;                        }&#10;                        &#10;                        IconButton(onClick = {&#10;                            coroutineScope.launch {&#10;                                sessionManager.clearSession()&#10;                                onLogout()&#10;                            }&#10;                        }) {&#10;                            Icon(&#10;                                imageVector = Icons.AutoMirrored.Rounded.ExitToApp,&#10;                                contentDescription = &quot;Logout&quot;,&#10;                                tint = Color.White,&#10;                                modifier = Modifier.size(40.dp)&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(16.dp))&#10;&#10;                // Cards section with proper padding&#10;                Column(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(horizontal = 25.dp)&#10;                ) {&#10;                // Take attendance card - dynamic based on schedule&#10;                if (isLoadingSchedule) {&#10;                    // Loading state&#10;                    Card(&#10;                        modifier = Modifier.fillMaxWidth(),&#10;                        shape = RoundedCornerShape(10.dp),&#10;                        colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                        elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                    ) {&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .fillMaxWidth()&#10;                                .padding(16.dp),&#10;                            contentAlignment = Alignment.Center&#10;                        ) {&#10;                            CircularProgressIndicator(&#10;                                color = darkGray,&#10;                                modifier = Modifier.size(24.dp)&#10;                            )&#10;                        }&#10;                    }&#10;                } else {&#10;                    // Show current or upcoming schedule&#10;                    currentSchedule?.let { schedule -&gt;&#10;                        Card(&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            shape = RoundedCornerShape(10.dp),&#10;                            colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                            elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                        ) {&#10;                            Row(&#10;                                verticalAlignment = Alignment.CenterVertically,&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .padding(horizontal = 12.dp, vertical = 8.dp)&#10;                            ) {&#10;                                Icon(&#10;                                    imageVector = Icons.Outlined.CalendarToday,&#10;                                    contentDescription = &quot;Calendar&quot;,&#10;                                    tint = Color.Black,&#10;                                    modifier = Modifier.size(20.dp)&#10;                                )&#10;                                Spacer(modifier = Modifier.width(8.dp))&#10;                                Column(&#10;                                    modifier = Modifier.weight(1f)&#10;                                ) {&#10;                                    Text(&#10;                                        text = schedule.courseName.uppercase(),&#10;                                        fontSize = 14.sp,&#10;                                        color = Color.Black,&#10;                                        fontWeight = FontWeight.Medium,&#10;                                        maxLines = 2&#10;                                    )&#10;                                    Text(&#10;                                        text = schedule.time,&#10;                                        fontSize = 12.sp,&#10;                                        color = Color.Gray,&#10;                                        modifier = Modifier.padding(top = 2.dp)&#10;                                    )&#10;                                }&#10;                                Spacer(modifier = Modifier.width(8.dp))&#10;                                if (schedule.isActive &amp;&amp; !isAttendanceVerified) {&#10;                                    // Show Submit button only if class is active AND attendance not yet verified&#10;                                    Button(&#10;                                        onClick = {&#10;                                            // Navigasi ke SubmissionScreen dengan parameter jadwal aktif&#10;                                            navController.navigate(&quot;submission_screen/${schedule.scheduleId}/${schedule.courseId}&quot;)&#10;                                        },&#10;                                        colors = ButtonDefaults.buttonColors(containerColor = redColor),&#10;                                        shape = RoundedCornerShape(8.dp),&#10;                                        modifier = Modifier.height(32.dp)&#10;                                    ) {&#10;                                        Text(&quot;Submit&quot;, fontSize = 14.sp, color = Color.White)&#10;                                    }&#10;                                } else if (schedule.isActive &amp;&amp; isAttendanceVerified) {&#10;                                    // Show &quot;Verified&quot; indicator if attendance is already verified&#10;                                    Surface(&#10;                                        color = Color(0xFF4CAF50),&#10;                                        shape = RoundedCornerShape(8.dp),&#10;                                        modifier = Modifier.height(32.dp)&#10;                                    ) {&#10;                                        Box(&#10;                                            modifier = Modifier.padding(horizontal = 12.dp),&#10;                                            contentAlignment = Alignment.Center&#10;                                        ) {&#10;                                            Text(&#10;                                                text = &quot;Verified&quot;,&#10;                                                fontSize = 14.sp,&#10;                                                color = Color.White,&#10;                                                fontWeight = FontWeight.Medium&#10;                                            )&#10;                                        }&#10;                                    }&#10;                                } else {&#10;                                    // Show &quot;Not Yet&quot; indicator for upcoming class&#10;                                    Surface(&#10;                                        color = Color(0xFFE0E0E0),&#10;                                        shape = RoundedCornerShape(8.dp),&#10;                                        modifier = Modifier.height(32.dp)&#10;                                    ) {&#10;                                        Box(&#10;                                            modifier = Modifier.padding(horizontal = 12.dp),&#10;                                            contentAlignment = Alignment.Center&#10;                                        ) {&#10;                                            Text(&#10;                                                text = &quot;Not Yet&quot;,&#10;                                                fontSize = 14.sp,&#10;                                                color = Color.Gray,&#10;                                                fontWeight = FontWeight.Medium&#10;                                            )&#10;                                        }&#10;                                    }&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Date card&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .clickable { onDateClick() },&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier.padding(20.dp)&#10;                    ) {&#10;                        Row(&#10;                            verticalAlignment = Alignment.CenterVertically&#10;                        ) {&#10;                            Text(&#10;                                text = dayOfMonth.toString(),&#10;                                fontSize = 70.sp,&#10;                                fontWeight = FontWeight.Bold,&#10;                                color = Color.Black&#10;                            )&#10;                            Spacer(modifier = Modifier.width(16.dp))&#10;                            Column {&#10;                                Text(&#10;                                    text = dayName,&#10;                                    fontSize = 20.sp,&#10;                                    fontWeight = FontWeight.Medium,&#10;                                    color = Color.Black&#10;                                )&#10;                                Text(&#10;                                    text = &quot;$month $year&quot;,&#10;                                    fontSize = 14.sp,&#10;                                    color = Color.Gray&#10;                                )&#10;                            }&#10;                        }&#10;&#10;                        Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                        Text(&#10;                            text = &quot;This week status&quot;,&#10;                            fontSize = 14.sp,&#10;                            color = Color.Gray,&#10;                            modifier = Modifier.padding(bottom = 12.dp)&#10;                        )&#10;&#10;                        if (isLoadingWeekly) {&#10;                            // Loading state for weekly status&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .height(50.dp),&#10;                                contentAlignment = Alignment.Center&#10;                            ) {&#10;                                CircularProgressIndicator(&#10;                                    color = darkGray,&#10;                                    modifier = Modifier.size(24.dp)&#10;                                )&#10;                            }&#10;                        } else {&#10;                            // Display weekly status from database&#10;                            Row(&#10;                                modifier = Modifier.fillMaxWidth(),&#10;                                horizontalArrangement = Arrangement.SpaceEvenly&#10;                            ) {&#10;                                WeekDayIndicator(&#10;                                    day = &quot;M&quot;,&#10;                                    status = weeklyStatus[&quot;monday&quot;],&#10;                                    darkGray = darkGray,&#10;                                    redColor = redColor&#10;                                )&#10;                                WeekDayIndicator(&#10;                                    day = &quot;T&quot;,&#10;                                    status = weeklyStatus[&quot;tuesday&quot;],&#10;                                    darkGray = darkGray,&#10;                                    redColor = redColor&#10;                                )&#10;                                WeekDayIndicator(&#10;                                    day = &quot;W&quot;,&#10;                                    status = weeklyStatus[&quot;wednesday&quot;],&#10;                                    darkGray = darkGray,&#10;                                    redColor = redColor&#10;                                )&#10;                                WeekDayIndicator(&#10;                                    day = &quot;Th&quot;,&#10;                                    status = weeklyStatus[&quot;thursday&quot;],&#10;                                    darkGray = darkGray,&#10;                                    redColor = redColor&#10;                                )&#10;                                WeekDayIndicator(&#10;                                    day = &quot;F&quot;,&#10;                                    status = weeklyStatus[&quot;friday&quot;],&#10;                                    darkGray = darkGray,&#10;                                    redColor = redColor&#10;                                )&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Statistics Card&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(20.dp)&#10;                    ) {&#10;                        Text(&#10;                            text = &quot;This Semester&quot;,&#10;                            fontSize = 16.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = Color.Black,&#10;                            modifier = Modifier.padding(bottom = 16.dp)&#10;                        )&#10;&#10;                        if (isLoadingStatistics) {&#10;                            // Loading state&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .height(100.dp),&#10;                                contentAlignment = Alignment.Center&#10;                            ) {&#10;                                CircularProgressIndicator(&#10;                                    color = darkGray,&#10;                                    modifier = Modifier.size(40.dp)&#10;                                )&#10;                            }&#10;                        } else if (statisticsError != null) {&#10;                            // Error state&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .height(100.dp),&#10;                                contentAlignment = Alignment.Center&#10;                            ) {&#10;                                Text(&#10;                                    text = &quot;Failed to load statistics&quot;,&#10;                                    color = Color.Red,&#10;                                    fontSize = 14.sp&#10;                                )&#10;                            }&#10;                        } else {&#10;                            // Donut charts - Scrollable horizontal dengan 5 charts&#10;                            LazyRow(&#10;                                modifier = Modifier.fillMaxWidth(),&#10;                                horizontalArrangement = Arrangement.spacedBy(20.dp),&#10;                                contentPadding = PaddingValues(horizontal = 8.dp)&#10;                            ) {&#10;                                item {&#10;                                    IndividualDonutChart(&#10;                                        value = attendanceStatistics.present,&#10;                                        percentage = attendanceStatistics.presentPercentage,&#10;                                        label = &quot;Present&quot;,&#10;                                        color = Color(0xFF4CAF50)&#10;                                    )&#10;                                }&#10;                                item {&#10;                                    IndividualDonutChart(&#10;                                        value = attendanceStatistics.late,&#10;                                        percentage = attendanceStatistics.latePercentage,&#10;                                        label = &quot;Late&quot;,&#10;                                        color = Color(0xFFFF9800)&#10;                                    )&#10;                                }&#10;                                item {&#10;                                    IndividualDonutChart(&#10;                                        value = attendanceStatistics.excused,&#10;                                        percentage = attendanceStatistics.excusedPercentage,&#10;                                        label = &quot;Excused&quot;,&#10;                                        color = Color(0xFF2196F3)&#10;                                    )&#10;                                }&#10;                                item {&#10;                                    IndividualDonutChart(&#10;                                        value = attendanceStatistics.sick,&#10;                                        percentage = attendanceStatistics.sickPercentage,&#10;                                        label = &quot;Sick&quot;,&#10;                                        color = Color(0xFFFFC107)&#10;                                    )&#10;                                }&#10;                                item {&#10;                                    IndividualDonutChart(&#10;                                        value = attendanceStatistics.absent,&#10;                                        percentage = attendanceStatistics.absentPercentage,&#10;                                        label = &quot;Absent&quot;,&#10;                                        color = Color(0xFF9E9E9E)&#10;                                    )&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Request Permission card&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .clickable { onRequestPermission() },&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(24.dp),&#10;                        horizontalAlignment = Alignment.CenterHorizontally&#10;                    ) {&#10;                        Icon(&#10;                            imageVector = Icons.Outlined.Description,&#10;                            contentDescription = &quot;Request Permission&quot;,&#10;                            tint = Color.Black,&#10;                            modifier = Modifier.size(36.dp)&#10;                        )&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                        Text(&#10;                            text = &quot;Ask Permission&quot;,&#10;                            fontSize = 14.sp,&#10;                            color = Color.Black&#10;                        )&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;            }&#10;        }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun WeekDayIndicator(&#10;    day: String,&#10;    status: String?,&#10;    darkGray: Color,&#10;    redColor: Color&#10;) {&#10;    // Determine color based on attendance status&#10;    val color = when (status) {&#10;        &quot;present&quot; -&gt; Color(0xFF4CAF50)  // Green for present&#10;        &quot;late&quot; -&gt; Color(0xFFFF9800)      // Orange for late&#10;        &quot;absent&quot; -&gt; redColor              // Red for absent&#10;        &quot;excused&quot; -&gt; Color(0xFF2196F3)   // Blue for excused&#10;        &quot;sick&quot; -&gt; Color(0xFFFFC107)      // Yellow for sick&#10;        null -&gt; Color.LightGray           // Light gray for no data&#10;        else -&gt; Color.LightGray&#10;    }&#10;&#10;    val attended = status != null&#10;&#10;    Box(&#10;        modifier = Modifier&#10;            .size(40.dp)&#10;            .clip(CircleShape)&#10;            .background(if (attended) color else Color.White)&#10;            .border(2.dp, color, CircleShape),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Text(&#10;            text = day,&#10;            color = if (attended) Color.White else color,&#10;            fontWeight = FontWeight.Bold,&#10;            fontSize = 12.sp&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun IndividualDonutChart(&#10;    value: Int,&#10;    percentage: Float,&#10;    label: String,&#10;    color: Color&#10;) {&#10;    Column(&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Box(&#10;            modifier = Modifier.size(60.dp),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Canvas(modifier = Modifier.fillMaxSize()) {&#10;                val strokeWidth = 8.dp.toPx()&#10;                // Background circle&#10;                drawCircle(&#10;                    color = Color.LightGray.copy(alpha = 0.3f),&#10;                    style = Stroke(width = strokeWidth)&#10;                )&#10;                // Foreground arc&#10;                drawArc(&#10;                    color = color,&#10;                    startAngle = -90f,&#10;                    sweepAngle = percentage * 360 / 100, // Convert percentage to angle&#10;                    useCenter = false,&#10;                    style = Stroke(width = strokeWidth, cap = StrokeCap.Round)&#10;                )&#10;            }&#10;            Text(&#10;                text = value.toString(),&#10;                fontSize = 16.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.Black&#10;            )&#10;        }&#10;        Spacer(modifier = Modifier.height(4.dp))&#10;        Text(&#10;            text = label,&#10;            fontSize = 12.sp,&#10;            color = Color.Gray&#10;        )&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun HomeScreenPreview() {&#10;    SmartAttendanceTheme {&#10;        HomeScreen(user = AuthApi.User(full_name = &quot;Teo&quot;, email = &quot;&quot;, password_hash = &quot;&quot;), sessionManager = SessionManager(LocalContext.current), navController = rememberNavController())&#10;    }&#10;}&#10;&#10;// Data class for current schedule info&#10;data class CurrentScheduleInfo(&#10;    val courseName: String,&#10;    val time: String,&#10;    val isActive: Boolean,  // true if class is currently in session (within 15 min window)&#10;    val scheduleId: Int,    // id jadwal&#10;    val courseId: Int       // id course&#10;)&#10;&#10;// Local data class to match ScheduleApi.ScheduleItem structure&#10;private data class ScheduleItemData(&#10;    val title: String,&#10;    val time: String&#10;)&#10;&#10;// Helper function to determine current or next schedule&#10;private fun determineCurrentSchedule(schedules: List&lt;Any&gt;): CurrentScheduleInfo? {&#10;    if (schedules.isEmpty()) return null&#10;&#10;    val now = LocalTime.now()&#10;    val formatter = DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;)&#10;&#10;    // Find if there's a class currently active (within 15 minutes of start time)&#10;    for (schedule in schedules) {&#10;        try {&#10;            // Access properties using reflection&#10;            val titleField = schedule::class.java.getDeclaredField(&quot;title&quot;)&#10;            val timeField = schedule::class.java.getDeclaredField(&quot;time&quot;)&#10;            val scheduleIdField = schedule::class.java.getDeclaredField(&quot;scheduleId&quot;)&#10;            val courseIdField = schedule::class.java.getDeclaredField(&quot;courseId&quot;)&#10;            titleField.isAccessible = true&#10;            timeField.isAccessible = true&#10;            scheduleIdField.isAccessible = true&#10;            courseIdField.isAccessible = true&#10;&#10;            val title = titleField.get(schedule) as String&#10;            val time = timeField.get(schedule) as String&#10;            val scheduleId = (scheduleIdField.get(schedule) as Number).toInt()&#10;            val courseId = (courseIdField.get(schedule) as Number).toInt()&#10;&#10;            // Extract course name from title (format: &quot;Course Name - CODE - ROOM&quot;)&#10;            val courseName = title.split(&quot; - &quot;).getOrNull(0) ?: title&#10;            val timeRange = time.split(&quot; - &quot;)&#10;            if (timeRange.size != 2) continue&#10;&#10;            val startTimeStr = convertTo24Hour(timeRange[0].trim())&#10;            val endTimeStr = convertTo24Hour(timeRange[1].trim())&#10;&#10;            val startTime = LocalTime.parse(startTimeStr, formatter)&#10;            val endTime = LocalTime.parse(endTimeStr, formatter)&#10;&#10;            // Check if class is in progress or within 15 minutes before start&#10;            val fifteenMinutesBefore = startTime.minusMinutes(15)&#10;&#10;            if (now.isAfter(fifteenMinutesBefore) &amp;&amp; now.isBefore(endTime)) {&#10;                // Class is active or about to start&#10;                return CurrentScheduleInfo(&#10;                    courseName = courseName,&#10;                    time = time,&#10;                    isActive = true,&#10;                    scheduleId = scheduleId,&#10;                    courseId = courseId&#10;                )&#10;            }&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;HomeScreen&quot;, &quot;Error parsing schedule&quot;, e)&#10;        }&#10;    }&#10;&#10;    // No active class, find the next upcoming class&#10;    for (schedule in schedules) {&#10;        try {&#10;            val titleField = schedule::class.java.getDeclaredField(&quot;title&quot;)&#10;            val timeField = schedule::class.java.getDeclaredField(&quot;time&quot;)&#10;            val scheduleIdField = schedule::class.java.getDeclaredField(&quot;scheduleId&quot;)&#10;            val courseIdField = schedule::class.java.getDeclaredField(&quot;courseId&quot;)&#10;            titleField.isAccessible = true&#10;            timeField.isAccessible = true&#10;            scheduleIdField.isAccessible = true&#10;            courseIdField.isAccessible = true&#10;&#10;            val title = titleField.get(schedule) as String&#10;            val time = timeField.get(schedule) as String&#10;            val scheduleId = (scheduleIdField.get(schedule) as Number).toInt()&#10;            val courseId = (courseIdField.get(schedule) as Number).toInt()&#10;&#10;            val courseName = title.split(&quot; - &quot;).getOrNull(0) ?: title&#10;            val timeRange = time.split(&quot; - &quot;)&#10;            if (timeRange.size != 2) continue&#10;&#10;            val startTimeStr = convertTo24Hour(timeRange[0].trim())&#10;            val startTime = LocalTime.parse(startTimeStr, formatter)&#10;&#10;            if (now.isBefore(startTime)) {&#10;                // This is the next class&#10;                return CurrentScheduleInfo(&#10;                    courseName = courseName,&#10;                    time = time,&#10;                    isActive = false,&#10;                    scheduleId = scheduleId,&#10;                    courseId = courseId&#10;                )&#10;            }&#10;        } catch (e: Exception) {&#10;            Log.e(&quot;HomeScreen&quot;, &quot;Error parsing schedule&quot;, e)&#10;        }&#10;    }&#10;&#10;    // All classes have passed for today&#10;    return null&#10;}&#10;&#10;// Helper function to convert 12-hour format to 24-hour format&#10;private fun convertTo24Hour(time12h: String): String {&#10;    return try {&#10;        val parts = time12h.split(&quot; &quot;)&#10;        if (parts.size != 2) return &quot;00:00:00&quot;&#10;&#10;        val timePart = parts[0]&#10;        val period = parts[1].uppercase()&#10;&#10;        val timeParts = timePart.split(&quot;:&quot;)&#10;        if (timeParts.size != 2) return &quot;00:00:00&quot;&#10;&#10;        var hour = timeParts[0].toInt()&#10;        val minute = timeParts[1]&#10;&#10;        // Convert to 24-hour format&#10;        if (period == &quot;PM&quot; &amp;&amp; hour != 12) {&#10;            hour += 12&#10;        } else if (period == &quot;AM&quot; &amp;&amp; hour == 12) {&#10;            hour = 0&#10;        }&#10;&#10;        String.format(&quot;%02d:%s:00&quot;, hour, minute)&#10;    } catch (e: Exception) {&#10;        Log.e(&quot;HomeScreen&quot;, &quot;Error converting time: $time12h&quot;, e)&#10;        &quot;00:00:00&quot;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/LoginScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/LoginScreen.kt" />
              <option name="originalContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Row&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.size&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.outlined.RemoveRedEye&#10;import androidx.compose.material.icons.outlined.VisibilityOff&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.ButtonDefaults&#10;import androidx.compose.material3.Card&#10;import androidx.compose.material3.CardDefaults&#10;import androidx.compose.material3.CircularProgressIndicator&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.OutlinedTextFieldDefaults&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.material3.TextField&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.res.painterResource&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.text.input.VisualTransformation&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.R&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.ui.theme.AppFontFamily&#10;import com.example.smartattendance.ui.theme.SmartAttendanceTheme&#10;import com.example.smartattendance.utils.SessionManager&#10;import kotlinx.coroutines.launch&#10;&#10;@Composable&#10;fun LoginScreen(&#10;    sessionManager: SessionManager,&#10;    onLoginSuccess: (AuthApi.User) -&gt; Unit = {},&#10;    onSignUpClick: () -&gt; Unit = {}&#10;) {&#10;    var username by remember { mutableStateOf(&quot;&quot;) }&#10;    var password by remember { mutableStateOf(&quot;&quot;) }&#10;    var passwordVisible by remember { mutableStateOf(false) }&#10;    var loginError by remember { mutableStateOf(&quot;&quot;) }&#10;    var isLoading by remember { mutableStateOf(false) }&#10;&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    fun handleLogin() {&#10;        when {&#10;            username.isEmpty() -&gt; {&#10;                loginError = &quot;Username tidak boleh kosong&quot;&#10;            }&#10;            password.isEmpty() -&gt; {&#10;                loginError = &quot;Password tidak boleh kosong&quot;&#10;            }&#10;            else -&gt; {&#10;                isLoading = true&#10;                coroutineScope.launch {&#10;                    val result = AuthApi.login(username, password, sessionManager)&#10;                    isLoading = false&#10;                    result.onSuccess { user -&gt;&#10;                        onLoginSuccess(user)&#10;                    }.onFailure {&#10;                        loginError = it.message ?: &quot;Login failed&quot;&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    fun signUpPage() {&#10;        onSignUpClick()&#10;    }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(24.dp)&#10;            .verticalScroll(rememberScrollState()),&#10;        verticalArrangement = Arrangement.Center,&#10;        horizontalAlignment = Alignment.CenterHorizontally&#10;    ) {&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Image(&#10;                painter = painterResource(id = R.drawable.logo),&#10;                contentDescription = &quot;App Logo&quot;&#10;            )&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(40.dp))&#10;&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;        ) {&#10;            Text(&#10;                text = &quot;Log in&quot;,&#10;                fontFamily = AppFontFamily,&#10;                fontSize = 32.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.Black.copy(alpha = 0.8f)&#10;            )&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(32.dp))&#10;&#10;        if (loginError.isNotEmpty()) {&#10;            Card(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(bottom = 16.dp),&#10;                colors = CardDefaults.cardColors(&#10;                    containerColor = Color(0xFFFFEBEE)&#10;                ),&#10;                shape = RoundedCornerShape(8.dp)&#10;            ) {&#10;                Text(&#10;                    text = loginError,&#10;                    fontSize = 14.sp,&#10;                    color = Color(0xFFD32F2F),&#10;                    modifier = Modifier.padding(12.dp)&#10;                )&#10;            }&#10;        }&#10;&#10;        TextField(&#10;            value = username,&#10;            onValueChange = {&#10;                username = it&#10;                loginError = &quot;&quot;&#10;            },&#10;            placeholder = {&#10;                Text(&#10;                    text = &quot;Username&quot;,&#10;                    color = Color.Gray,&#10;                    fontFamily = AppFontFamily&#10;                )&#10;            },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(56.dp)&#10;                .background(color = Color.Gray.copy(alpha = 0.1f), shape = RoundedCornerShape(8.dp)),&#10;            shape = RoundedCornerShape(8.dp),&#10;            colors = OutlinedTextFieldDefaults.colors(&#10;                unfocusedBorderColor = Color.Transparent,&#10;                focusedBorderColor = Color.Transparent,&#10;                focusedTextColor = Color.Black,&#10;                unfocusedTextColor = Color.Black&#10;            ),&#10;            singleLine = true,&#10;            enabled = !isLoading,&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        TextField(&#10;            value = password,&#10;            onValueChange = {&#10;                password = it&#10;                loginError = &quot;&quot;&#10;            },&#10;            placeholder = {&#10;                Text(&#10;                    text = &quot;&quot;,&#10;                    color = Color.Gray&#10;                )&#10;            },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(56.dp)&#10;                .background(&#10;                    color = Color.Gray.copy(alpha = 0.1f),&#10;                    shape = RoundedCornerShape(8.dp)&#10;                ),&#10;            shape = RoundedCornerShape(8.dp),&#10;            colors = OutlinedTextFieldDefaults.colors(&#10;                unfocusedBorderColor = Color.Transparent,&#10;                focusedBorderColor = Color.Transparent,&#10;                focusedTextColor = Color.Black,&#10;                unfocusedTextColor = Color.Black&#10;            ),&#10;            singleLine = true,&#10;            visualTransformation = if (passwordVisible) VisualTransformation.None else PasswordVisualTransformation(),&#10;            enabled = !isLoading,&#10;            trailingIcon = {&#10;                TextButton(&#10;                    onClick = { passwordVisible = !passwordVisible },&#10;                    enabled = !isLoading&#10;                ) {&#10;                    if (!passwordVisible) {&#10;                        Icon(&#10;                            imageVector = Icons.Outlined.RemoveRedEye,&#10;                            contentDescription = &quot;Hide Password&quot;,&#10;                            tint = Color.Gray&#10;                        )&#10;                    } else {&#10;                        Icon(&#10;                            imageVector = Icons.Outlined.VisibilityOff,&#10;                            contentDescription = &quot;Show Password&quot;,&#10;                            tint = Color.Gray&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;&#10;//        Row(&#10;//            modifier = Modifier.fillMaxWidth(),&#10;//            horizontalArrangement = Arrangement.End&#10;//        ) {&#10;//            TextButton(&#10;//                onClick = { /* Handle forgot password */ },&#10;//                enabled = !isLoading&#10;//            ) {&#10;//                Text(&#10;//                    text = &quot;Forgot Password?&quot;,&#10;//                    color = Color.Gray,&#10;//                    fontSize = 14.sp,&#10;//                    fontFamily = AppFontFamily&#10;//                )&#10;//            }&#10;//        }&#10;//&#10;//        Spacer(modifier = Modifier.height(32.dp))&#10;&#10;        Button(&#10;            onClick = { handleLogin() },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(48.dp),&#10;            shape = RoundedCornerShape(24.dp),&#10;            colors = ButtonDefaults.buttonColors(&#10;                containerColor = Color(0xFF424242)&#10;            ),&#10;            enabled = !isLoading&#10;        ) {&#10;            if (isLoading) {&#10;                CircularProgressIndicator(&#10;                    modifier = Modifier.size(20.dp),&#10;                    color = Color.White,&#10;                    strokeWidth = 2.dp&#10;                )&#10;            } else {&#10;                Text(&#10;                    text = &quot;Log in&quot;,&#10;                    color = Color.White,&#10;                    fontSize = 16.sp,&#10;                    fontFamily = AppFontFamily&#10;                )&#10;            }&#10;        }&#10;&#10;        TextButton(&#10;            onClick = { signUpPage() },&#10;        ) {&#10;            Text(&#10;                text = &quot;Dont have an account? Sign Up&quot;,&#10;                color = Color.Gray,&#10;                fontFamily = AppFontFamily&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun LoginScreenPreview() {&#10;    SmartAttendanceTheme {&#10;        LoginScreen(&#10;            sessionManager = SessionManager(LocalContext.current),&#10;            onLoginSuccess = {},&#10;            onSignUpClick = {}&#10;        )&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.Arrangement&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.Column&#10;import androidx.compose.foundation.layout.Row&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.fillMaxWidth&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.size&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.outlined.RemoveRedEye&#10;import androidx.compose.material.icons.outlined.VisibilityOff&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.ButtonDefaults&#10;import androidx.compose.material3.Card&#10;import androidx.compose.material3.CardDefaults&#10;import androidx.compose.material3.CircularProgressIndicator&#10;import androidx.compose.material3.Icon&#10;import androidx.compose.material3.OutlinedTextFieldDefaults&#10;import androidx.compose.material3.Text&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.material3.TextField&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.mutableStateOf&#10;import androidx.compose.runtime.remember&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.res.painterResource&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.input.PasswordVisualTransformation&#10;import androidx.compose.ui.text.input.VisualTransformation&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.R&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.ui.theme.AppFontFamily&#10;import com.example.smartattendance.ui.theme.SmartAttendanceTheme&#10;import com.example.smartattendance.utils.SessionManager&#10;import kotlinx.coroutines.launch&#10;&#10;@Composable&#10;fun LoginScreen(&#10;    sessionManager: SessionManager,&#10;    onLoginSuccess: (AuthApi.User) -&gt; Unit = {},&#10;    onMfaRequired: (AuthApi.User) -&gt; Unit = {},&#10;    onSignUpClick: () -&gt; Unit = {}&#10;) {&#10;    var username by remember { mutableStateOf(&quot;&quot;) }&#10;    var password by remember { mutableStateOf(&quot;&quot;) }&#10;    var passwordVisible by remember { mutableStateOf(false) }&#10;    var loginError by remember { mutableStateOf(&quot;&quot;) }&#10;    var isLoading by remember { mutableStateOf(false) }&#10;&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    fun handleLogin() {&#10;        when {&#10;            username.isEmpty() -&gt; {&#10;                loginError = &quot;Username tidak boleh kosong&quot;&#10;            }&#10;            password.isEmpty() -&gt; {&#10;                loginError = &quot;Password tidak boleh kosong&quot;&#10;            }&#10;            else -&gt; {&#10;                isLoading = true&#10;                coroutineScope.launch {&#10;                    val result = AuthApi.login(username, password, sessionManager)&#10;                    isLoading = false&#10;                    result.onSuccess { user -&gt;&#10;                        // Check if MFA is enabled for this user&#10;                        val mfaResult = com.example.smartattendance.api.MfaApi.getMfaSettings(user.user_id ?: &quot;&quot;)&#10;                        mfaResult.onSuccess { settings -&gt;&#10;                            if (settings?.mfa_enabled == true) {&#10;                                // MFA is enabled, navigate to MFA verification&#10;                                onMfaRequired(user)&#10;                            } else {&#10;                                // No MFA, proceed with login&#10;                                onLoginSuccess(user)&#10;                            }&#10;                        }.onFailure {&#10;                            // If failed to check MFA, proceed with normal login&#10;                            onLoginSuccess(user)&#10;                        }&#10;                    }.onFailure {&#10;                        loginError = it.message ?: &quot;Login failed&quot;&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    fun signUpPage() {&#10;        onSignUpClick()&#10;    }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(24.dp)&#10;            .verticalScroll(rememberScrollState()),&#10;        verticalArrangement = Arrangement.Center,&#10;        horizontalAlignment = Alignment.CenterHorizontally&#10;    ) {&#10;        Box(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Image(&#10;                painter = painterResource(id = R.drawable.logo),&#10;                contentDescription = &quot;App Logo&quot;&#10;            )&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(40.dp))&#10;&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;        ) {&#10;            Text(&#10;                text = &quot;Log in&quot;,&#10;                fontFamily = AppFontFamily,&#10;                fontSize = 32.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.Black.copy(alpha = 0.8f)&#10;            )&#10;        }&#10;&#10;        Spacer(modifier = Modifier.height(32.dp))&#10;&#10;        if (loginError.isNotEmpty()) {&#10;            Card(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(bottom = 16.dp),&#10;                colors = CardDefaults.cardColors(&#10;                    containerColor = Color(0xFFFFEBEE)&#10;                ),&#10;                shape = RoundedCornerShape(8.dp)&#10;            ) {&#10;                Text(&#10;                    text = loginError,&#10;                    fontSize = 14.sp,&#10;                    color = Color(0xFFD32F2F),&#10;                    modifier = Modifier.padding(12.dp)&#10;                )&#10;            }&#10;        }&#10;&#10;        TextField(&#10;            value = username,&#10;            onValueChange = {&#10;                username = it&#10;                loginError = &quot;&quot;&#10;            },&#10;            placeholder = {&#10;                Text(&#10;                    text = &quot;Username&quot;,&#10;                    color = Color.Gray,&#10;                    fontFamily = AppFontFamily&#10;                )&#10;            },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(56.dp)&#10;                .background(color = Color.Gray.copy(alpha = 0.1f), shape = RoundedCornerShape(8.dp)),&#10;            shape = RoundedCornerShape(8.dp),&#10;            colors = OutlinedTextFieldDefaults.colors(&#10;                unfocusedBorderColor = Color.Transparent,&#10;                focusedBorderColor = Color.Transparent,&#10;                focusedTextColor = Color.Black,&#10;                unfocusedTextColor = Color.Black&#10;            ),&#10;            singleLine = true,&#10;            enabled = !isLoading,&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(24.dp))&#10;&#10;        TextField(&#10;            value = password,&#10;            onValueChange = {&#10;                password = it&#10;                loginError = &quot;&quot;&#10;            },&#10;            placeholder = {&#10;                Text(&#10;                    text = &quot;&quot;,&#10;                    color = Color.Gray&#10;                )&#10;            },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(56.dp)&#10;                .background(&#10;                    color = Color.Gray.copy(alpha = 0.1f),&#10;                    shape = RoundedCornerShape(8.dp)&#10;                ),&#10;            shape = RoundedCornerShape(8.dp),&#10;            colors = OutlinedTextFieldDefaults.colors(&#10;                unfocusedBorderColor = Color.Transparent,&#10;                focusedBorderColor = Color.Transparent,&#10;                focusedTextColor = Color.Black,&#10;                unfocusedTextColor = Color.Black&#10;            ),&#10;            singleLine = true,&#10;            visualTransformation = if (passwordVisible) VisualTransformation.None else PasswordVisualTransformation(),&#10;            enabled = !isLoading,&#10;            trailingIcon = {&#10;                TextButton(&#10;                    onClick = { passwordVisible = !passwordVisible },&#10;                    enabled = !isLoading&#10;                ) {&#10;                    if (!passwordVisible) {&#10;                        Icon(&#10;                            imageVector = Icons.Outlined.RemoveRedEye,&#10;                            contentDescription = &quot;Hide Password&quot;,&#10;                            tint = Color.Gray&#10;                        )&#10;                    } else {&#10;                        Icon(&#10;                            imageVector = Icons.Outlined.VisibilityOff,&#10;                            contentDescription = &quot;Show Password&quot;,&#10;                            tint = Color.Gray&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        )&#10;&#10;        Spacer(modifier = Modifier.height(16.dp))&#10;&#10;//        Row(&#10;//            modifier = Modifier.fillMaxWidth(),&#10;//            horizontalArrangement = Arrangement.End&#10;//        ) {&#10;//            TextButton(&#10;//                onClick = { /* Handle forgot password */ },&#10;//                enabled = !isLoading&#10;//            ) {&#10;//                Text(&#10;//                    text = &quot;Forgot Password?&quot;,&#10;//                    color = Color.Gray,&#10;//                    fontSize = 14.sp,&#10;//                    fontFamily = AppFontFamily&#10;//                )&#10;//            }&#10;//        }&#10;//&#10;//        Spacer(modifier = Modifier.height(32.dp))&#10;&#10;        Button(&#10;            onClick = { handleLogin() },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .height(48.dp),&#10;            shape = RoundedCornerShape(24.dp),&#10;            colors = ButtonDefaults.buttonColors(&#10;                containerColor = Color(0xFF424242)&#10;            ),&#10;            enabled = !isLoading&#10;        ) {&#10;            if (isLoading) {&#10;                CircularProgressIndicator(&#10;                    modifier = Modifier.size(20.dp),&#10;                    color = Color.White,&#10;                    strokeWidth = 2.dp&#10;                )&#10;            } else {&#10;                Text(&#10;                    text = &quot;Log in&quot;,&#10;                    color = Color.White,&#10;                    fontSize = 16.sp,&#10;                    fontFamily = AppFontFamily&#10;                )&#10;            }&#10;        }&#10;&#10;        TextButton(&#10;            onClick = { signUpPage() },&#10;        ) {&#10;            Text(&#10;                text = &quot;Dont have an account? Sign Up&quot;,&#10;                color = Color.Gray,&#10;                fontFamily = AppFontFamily&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun LoginScreenPreview() {&#10;    SmartAttendanceTheme {&#10;        LoginScreen(&#10;            sessionManager = SessionManager(LocalContext.current),&#10;            onLoginSuccess = {},&#10;            onSignUpClick = {}&#10;        )&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaSettingsScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaSettingsScreen.kt" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ArrowBack&#10;import androidx.compose.material.icons.filled.Security&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.MfaApi&#10;import com.example.smartattendance.ui.theme.AppFontFamily&#10;import kotlinx.coroutines.launch&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MfaSettingsScreen(&#10;    user: AuthApi.User,&#10;    onBackClick: () -&gt; Unit = {},&#10;    onSetupMfa: () -&gt; Unit = {}&#10;) {&#10;    val coroutineScope = rememberCoroutineScope()&#10;    &#10;    var mfaSettings by remember { mutableStateOf&lt;MfaApi.MfaSettings?&gt;(null) }&#10;    var isLoading by remember { mutableStateOf(true) }&#10;    var showDisableDialog by remember { mutableStateOf(false) }&#10;    var isDisabling by remember { mutableStateOf(false) }&#10;    var errorMessage by remember { mutableStateOf(&quot;&quot;) }&#10;    &#10;    // Load MFA settings&#10;    LaunchedEffect(Unit) {&#10;        val result = MfaApi.getMfaSettings(user.user_id ?: &quot;&quot;)&#10;        isLoading = false&#10;        result.onSuccess { settings -&gt;&#10;            mfaSettings = settings&#10;        }.onFailure {&#10;            errorMessage = it.message ?: &quot;Failed to load MFA settings&quot;&#10;        }&#10;    }&#10;    &#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = {&#10;                    Text(&#10;                        text = &quot;Two-Factor Authentication&quot;,&#10;                        fontFamily = AppFontFamily,&#10;                        fontSize = 18.sp&#10;                    )&#10;                },&#10;                navigationIcon = {&#10;                    IconButton(onClick = onBackClick) {&#10;                        Icon(Icons.AutoMirrored.Filled.ArrowBack, &quot;Back&quot;)&#10;                    }&#10;                },&#10;                colors = TopAppBarDefaults.topAppBarColors(&#10;                    containerColor = Color.White,&#10;                    titleContentColor = Color.Black&#10;                )&#10;            )&#10;        }&#10;    ) { paddingValues -&gt;&#10;        if (isLoading) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(paddingValues),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                CircularProgressIndicator(color = Color(0xFFE91E63))&#10;            }&#10;        } else {&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(paddingValues)&#10;                    .padding(24.dp)&#10;                    .verticalScroll(rememberScrollState())&#10;            ) {&#10;                // Status Card&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = CardDefaults.cardColors(&#10;                        containerColor = if (mfaSettings?.mfa_enabled == true)&#10;                            Color(0xFFE8F5E9)&#10;                        else&#10;                            Color(0xFFFFF3E0)&#10;                    )&#10;                ) {&#10;                    Row(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(16.dp),&#10;                        verticalAlignment = Alignment.CenterVertically&#10;                    ) {&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .size(48.dp)&#10;                                .background(&#10;                                    color = if (mfaSettings?.mfa_enabled == true)&#10;                                        Color(0xFF4CAF50).copy(alpha = 0.2f)&#10;                                    else&#10;                                        Color(0xFFFF9800).copy(alpha = 0.2f),&#10;                                    shape = RoundedCornerShape(24.dp)&#10;                                ),&#10;                            contentAlignment = Alignment.Center&#10;                        ) {&#10;                            Icon(&#10;                                imageVector = Icons.Default.Security,&#10;                                contentDescription = &quot;Security&quot;,&#10;                                tint = if (mfaSettings?.mfa_enabled == true)&#10;                                    Color(0xFF4CAF50)&#10;                                else&#10;                                    Color(0xFFFF9800),&#10;                                modifier = Modifier.size(24.dp)&#10;                            )&#10;                        }&#10;&#10;                        Spacer(modifier = Modifier.width(16.dp))&#10;&#10;                        Column(modifier = Modifier.weight(1f)) {&#10;                            Text(&#10;                                text = if (mfaSettings?.mfa_enabled == true)&#10;                                    &quot;MFA Enabled&quot;&#10;                                else&#10;                                    &quot;MFA Disabled&quot;,&#10;                                fontSize = 18.sp,&#10;                                fontWeight = FontWeight.Bold,&#10;                                fontFamily = AppFontFamily,&#10;                                color = Color.Black&#10;                            )&#10;                            Text(&#10;                                text = if (mfaSettings?.mfa_enabled == true)&#10;                                    &quot;Your account is protected&quot;&#10;                                else&#10;                                    &quot;Enable for extra security&quot;,&#10;                                fontSize = 14.sp,&#10;                                fontFamily = AppFontFamily,&#10;                                color = Color.Gray&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;&#10;                // Information&#10;                Text(&#10;                    text = &quot;About Two-Factor Authentication&quot;,&#10;                    fontSize = 16.sp,&#10;                    fontWeight = FontWeight.Bold,&#10;                    fontFamily = AppFontFamily,&#10;                    color = Color.Black&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(12.dp))&#10;&#10;                Text(&#10;                    text = &quot;Two-factor authentication (2FA) adds an extra layer of security to your account. &quot; +&#10;                            &quot;In addition to your password, you'll need to enter a code from your authenticator app when logging in.&quot;,&#10;                    fontSize = 14.sp,&#10;                    fontFamily = AppFontFamily,&#10;                    color = Color.Gray,&#10;                    lineHeight = 20.sp&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;&#10;                // Benefits&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = CardDefaults.cardColors(containerColor = Color(0xFFF5F5F5))&#10;                ) {&#10;                    Column(modifier = Modifier.padding(16.dp)) {&#10;                        Text(&#10;                            text = &quot;Benefits:&quot;,&#10;                            fontSize = 14.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            fontFamily = AppFontFamily,&#10;                            color = Color.Black&#10;                        )&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                        BenefitItem(&quot; Enhanced account security&quot;)&#10;                        BenefitItem(&quot; Protection against unauthorized access&quot;)&#10;                        BenefitItem(&quot; Works with Google Authenticator, Authy, etc.&quot;)&#10;                        BenefitItem(&quot; Backup codes for emergency access&quot;)&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(32.dp))&#10;&#10;                if (errorMessage.isNotEmpty()) {&#10;                    Card(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(bottom = 16.dp),&#10;                        colors = CardDefaults.cardColors(containerColor = Color(0xFFFFEBEE))&#10;                    ) {&#10;                        Text(&#10;                            text = errorMessage,&#10;                            fontSize = 14.sp,&#10;                            color = Color(0xFFD32F2F),&#10;                            modifier = Modifier.padding(12.dp),&#10;                            fontFamily = AppFontFamily&#10;                        )&#10;                    }&#10;                }&#10;&#10;                // Action Button&#10;                if (mfaSettings?.mfa_enabled == true) {&#10;                    OutlinedButton(&#10;                        onClick = { showDisableDialog = true },&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .height(48.dp),&#10;                        shape = RoundedCornerShape(24.dp),&#10;                        colors = ButtonDefaults.outlinedButtonColors(&#10;                            contentColor = Color(0xFFD32F2F)&#10;                        ),&#10;                        enabled = !isDisabling&#10;                    ) {&#10;                        if (isDisabling) {&#10;                            CircularProgressIndicator(&#10;                                modifier = Modifier.size(20.dp),&#10;                                color = Color(0xFFD32F2F),&#10;                                strokeWidth = 2.dp&#10;                            )&#10;                        } else {&#10;                            Text(&#10;                                text = &quot;Disable Two-Factor Authentication&quot;,&#10;                                fontSize = 16.sp,&#10;                                fontFamily = AppFontFamily&#10;                            )&#10;                        }&#10;                    }&#10;&#10;                    // Show remaining backup codes count&#10;                    mfaSettings?.backup_codes?.let { codes -&gt;&#10;                        if (codes.isNotEmpty()) {&#10;                            Spacer(modifier = Modifier.height(16.dp))&#10;                            Text(&#10;                                text = &quot;You have ${codes.size} backup code${if (codes.size != 1) &quot;s&quot; else &quot;&quot;} remaining&quot;,&#10;                                fontSize = 14.sp,&#10;                                fontFamily = AppFontFamily,&#10;                                color = Color.Gray,&#10;                                modifier = Modifier.fillMaxWidth()&#10;                            )&#10;                        }&#10;                    }&#10;                } else {&#10;                    Button(&#10;                        onClick = onSetupMfa,&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .height(48.dp),&#10;                        shape = RoundedCornerShape(24.dp),&#10;                        colors = ButtonDefaults.buttonColors(containerColor = Color(0xFFE91E63))&#10;                    ) {&#10;                        Text(&#10;                            text = &quot;Enable Two-Factor Authentication&quot;,&#10;                            fontSize = 16.sp,&#10;                            fontFamily = AppFontFamily&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        // Disable MFA Confirmation Dialog&#10;        if (showDisableDialog) {&#10;            AlertDialog(&#10;                onDismissRequest = { if (!isDisabling) showDisableDialog = false },&#10;                title = {&#10;                    Text(&#10;                        text = &quot;Disable Two-Factor Authentication?&quot;,&#10;                        fontFamily = AppFontFamily,&#10;                        fontWeight = FontWeight.Bold&#10;                    )&#10;                },&#10;                text = {&#10;                    Text(&#10;                        text = &quot;Your account will be less secure without two-factor authentication. Are you sure you want to disable it?&quot;,&#10;                        fontFamily = AppFontFamily&#10;                    )&#10;                },&#10;                confirmButton = {&#10;                    TextButton(&#10;                        onClick = {&#10;                            isDisabling = true&#10;                            coroutineScope.launch {&#10;                                val result = MfaApi.disableMfa(user.user_id ?: &quot;&quot;)&#10;                                isDisabling = false&#10;                                showDisableDialog = false&#10;&#10;                                result.onSuccess {&#10;                                    mfaSettings = mfaSettings?.copy(mfa_enabled = false)&#10;                                }.onFailure {&#10;                                    errorMessage = it.message ?: &quot;Failed to disable MFA&quot;&#10;                                }&#10;                            }&#10;                        },&#10;                        enabled = !isDisabling&#10;                    ) {&#10;                        if (isDisabling) {&#10;                            CircularProgressIndicator(&#10;                                modifier = Modifier.size(16.dp),&#10;                                strokeWidth = 2.dp&#10;                            )&#10;                        } else {&#10;                            Text(&quot;Disable&quot;, fontFamily = AppFontFamily, color = Color(0xFFD32F2F))&#10;                        }&#10;                    }&#10;                },&#10;                dismissButton = {&#10;                    TextButton(&#10;                        onClick = { showDisableDialog = false },&#10;                        enabled = !isDisabling&#10;                    ) {&#10;                        Text(&quot;Cancel&quot;, fontFamily = AppFontFamily)&#10;                    }&#10;                }&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun BenefitItem(text: String) {&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(vertical = 4.dp),&#10;        verticalAlignment = Alignment.Top&#10;    ) {&#10;        Text(&#10;            text = text,&#10;            fontSize = 14.sp,&#10;            fontFamily = AppFontFamily,&#10;            color = Color.Black.copy(alpha = 0.8f)&#10;        )&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaSetupScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaSetupScreen.kt" />
              <option name="updatedContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import android.graphics.Bitmap&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ArrowBack&#10;import androidx.compose.material.icons.filled.ContentCopy&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.asImageBitmap&#10;import androidx.compose.ui.platform.LocalClipboardManager&#10;import androidx.compose.ui.text.AnnotatedString&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.MfaApi&#10;import com.example.smartattendance.ui.theme.AppFontFamily&#10;import com.example.smartattendance.utils.QRCodeGenerator&#10;import kotlinx.coroutines.launch&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MfaSetupScreen(&#10;    user: AuthApi.User,&#10;    onBackClick: () -&gt; Unit = {},&#10;    onSetupComplete: () -&gt; Unit = {}&#10;) {&#10;    val coroutineScope = rememberCoroutineScope()&#10;    val clipboardManager = LocalClipboardManager.current&#10;    &#10;    var secret by remember { mutableStateOf(MfaApi.generateSecret()) }&#10;    var backupCodes by remember { mutableStateOf(MfaApi.generateBackupCodes()) }&#10;    var qrCodeBitmap by remember { mutableStateOf&lt;Bitmap?&gt;(null) }&#10;    var verificationCode by remember { mutableStateOf(&quot;&quot;) }&#10;    var isVerifying by remember { mutableStateOf(false) }&#10;    var errorMessage by remember { mutableStateOf(&quot;&quot;) }&#10;    var setupStep by remember { mutableStateOf(1) }&#10;    var showCopiedMessage by remember { mutableStateOf(false) }&#10;    &#10;    LaunchedEffect(secret) {&#10;        val uri = MfaApi.getTOTPUri(secret, user.email, &quot;SmartAttendance&quot;)&#10;        qrCodeBitmap = QRCodeGenerator.generateQRCode(uri)&#10;    }&#10;    &#10;    Scaffold(&#10;        topBar = {&#10;            TopAppBar(&#10;                title = { Text(&quot;Setup MFA&quot;, fontFamily = AppFontFamily, fontSize = 18.sp) },&#10;                navigationIcon = {&#10;                    IconButton(onClick = onBackClick) {&#10;                        Icon(Icons.AutoMirrored.Filled.ArrowBack, &quot;Back&quot;)&#10;                    }&#10;                },&#10;                colors = TopAppBarDefaults.topAppBarColors(&#10;                    containerColor = Color.White,&#10;                    titleContentColor = Color.Black&#10;                )&#10;            )&#10;        }&#10;    ) { paddingValues -&gt;&#10;        Column(&#10;            modifier = Modifier.fillMaxSize().padding(paddingValues).padding(24.dp).verticalScroll(rememberScrollState()),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            // Step indicator&#10;            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.Center) {&#10;                StepIndicator(1, setupStep, &quot;Scan&quot;)&#10;                Divider(modifier = Modifier.width(40.dp).padding(horizontal = 8.dp), &#10;                    color = if (setupStep &gt; 1) Color(0xFFE91E63) else Color.LightGray)&#10;                StepIndicator(2, setupStep, &quot;Verify&quot;)&#10;                Divider(modifier = Modifier.width(40.dp).padding(horizontal = 8.dp),&#10;                    color = if (setupStep &gt; 2) Color(0xFFE91E63) else Color.LightGray)&#10;                StepIndicator(3, setupStep, &quot;Backup&quot;)&#10;            }&#10;            &#10;            Spacer(modifier = Modifier.height(32.dp))&#10;            &#10;            when (setupStep) {&#10;                1 -&gt; Step1ScanQR(secret, qrCodeBitmap, showCopiedMessage, &#10;                    { clipboardManager.setText(AnnotatedString(secret)); showCopiedMessage = true },&#10;                    { setupStep = 2 })&#10;                2 -&gt; Step2Verify(verificationCode, errorMessage, isVerifying,&#10;                    { if (it.length &lt;= 6 &amp;&amp; it.all { c -&gt; c.isDigit() }) { verificationCode = it; errorMessage = &quot;&quot; } },&#10;                    { setupStep = 1 },&#10;                    {&#10;                        if (verificationCode.length != 6) { errorMessage = &quot;Please enter 6 digits&quot;; return@Step2Verify }&#10;                        isVerifying = true&#10;                        coroutineScope.launch {&#10;                            val valid = MfaApi.verifyTOTP(secret, verificationCode)&#10;                            isVerifying = false&#10;                            if (valid) { setupStep = 3; errorMessage = &quot;&quot; } &#10;                            else { errorMessage = &quot;Invalid code&quot;; verificationCode = &quot;&quot; }&#10;                        }&#10;                    })&#10;                3 -&gt; Step3BackupCodes(backupCodes, showCopiedMessage, errorMessage, isVerifying,&#10;                    { clipboardManager.setText(AnnotatedString(backupCodes.joinToString(&quot;\n&quot;))); showCopiedMessage = true },&#10;                    {&#10;                        isVerifying = true&#10;                        coroutineScope.launch {&#10;                            MfaApi.enableMfa(user.user_id ?: &quot;&quot;, secret, backupCodes).onSuccess {&#10;                                onSetupComplete()&#10;                            }.onFailure { errorMessage = it.message ?: &quot;Failed&quot; }&#10;                            isVerifying = false&#10;                        }&#10;                    })&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun StepIndicator(step: Int, current: Int, label: String) {&#10;    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;        Box(&#10;            Modifier.size(40.dp).background(&#10;                if (step &lt;= current) Color(0xFFE91E63) else Color.LightGray,&#10;                RoundedCornerShape(20.dp)&#10;            ),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Text(if (step &lt; current) &quot;&quot; else &quot;$step&quot;, color = Color.White, fontSize = 16.sp, &#10;                fontWeight = FontWeight.Bold, fontFamily = AppFontFamily)&#10;        }&#10;        Spacer(Modifier.height(4.dp))&#10;        Text(label, fontSize = 12.sp, fontFamily = AppFontFamily,&#10;            color = if (step &lt;= current) Color.Black else Color.Gray)&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun Step1ScanQR(secret: String, qr: Bitmap?, copied: Boolean, onCopy: () -&gt; Unit, onNext: () -&gt; Unit) {&#10;    Text(&quot;Scan QR Code&quot;, fontSize = 24.sp, fontWeight = FontWeight.Bold, fontFamily = AppFontFamily)&#10;    Spacer(Modifier.height(16.dp))&#10;    Text(&quot;Scan with Google Authenticator or Authy&quot;, fontSize = 14.sp, &#10;        fontFamily = AppFontFamily, color = Color.Gray, textAlign = TextAlign.Center)&#10;    Spacer(Modifier.height(24.dp))&#10;    qr?.let {&#10;        Card(Modifier.size(250.dp), elevation = CardDefaults.cardElevation(4.dp)) {&#10;            Box(Modifier.fillMaxSize(), Alignment.Center) {&#10;                Image(it.asImageBitmap(), &quot;QR Code&quot;, Modifier.fillMaxSize().padding(16.dp))&#10;            }&#10;        }&#10;    }&#10;    Spacer(Modifier.height(24.dp))&#10;    Text(&quot;Or enter manually:&quot;, fontSize = 14.sp, fontFamily = AppFontFamily, color = Color.Gray)&#10;    Spacer(Modifier.height(8.dp))&#10;    Card(Modifier.fillMaxWidth(), colors = CardDefaults.cardColors(Color(0xFFF5F5F5))) {&#10;        Row(Modifier.fillMaxWidth().padding(16.dp), Arrangement.SpaceBetween, Alignment.CenterVertically) {&#10;            Text(secret.chunked(4).joinToString(&quot; &quot;), fontSize = 16.sp, fontFamily = AppFontFamily, &#10;                fontWeight = FontWeight.Medium, modifier = Modifier.weight(1f))&#10;            IconButton(onCopy) { Icon(Icons.Default.ContentCopy, &quot;Copy&quot;, tint = Color(0xFFE91E63)) }&#10;        }&#10;    }&#10;    if (copied) { Spacer(Modifier.height(8.dp)); Text(&quot; Copied&quot;, fontSize = 12.sp, &#10;        color = Color(0xFF4CAF50), fontFamily = AppFontFamily) }&#10;    Spacer(Modifier.height(32.dp))&#10;    Button(onNext, Modifier.fillMaxWidth().height(48.dp), shape = RoundedCornerShape(24.dp),&#10;        colors = ButtonDefaults.buttonColors(Color(0xFFE91E63))) {&#10;        Text(&quot;Next&quot;, fontSize = 16.sp, fontFamily = AppFontFamily)&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun Step2Verify(code: String, error: String, loading: Boolean, onChange: (String) -&gt; Unit, &#10;    onBack: () -&gt; Unit, onVerify: () -&gt; Unit) {&#10;    Text(&quot;Verify Code&quot;, fontSize = 24.sp, fontWeight = FontWeight.Bold, fontFamily = AppFontFamily)&#10;    Spacer(Modifier.height(16.dp))&#10;    Text(&quot;Enter 6-digit code from authenticator&quot;, fontSize = 14.sp, &#10;        fontFamily = AppFontFamily, color = Color.Gray, textAlign = TextAlign.Center)&#10;    Spacer(Modifier.height(32.dp))&#10;    if (error.isNotEmpty()) {&#10;        Card(Modifier.fillMaxWidth().padding(bottom = 16.dp), &#10;            colors = CardDefaults.cardColors(Color(0xFFFFEBEE))) {&#10;            Text(error, fontSize = 14.sp, color = Color(0xFFD32F2F), &#10;                modifier = Modifier.padding(12.dp), fontFamily = AppFontFamily)&#10;        }&#10;    }&#10;    OutlinedTextField(code, onChange, Modifier.fillMaxWidth(), label = { Text(&quot;6-digit code&quot;, fontFamily = AppFontFamily) },&#10;        singleLine = true, enabled = !loading, colors = OutlinedTextFieldDefaults.colors(&#10;            focusedBorderColor = Color(0xFFE91E63), unfocusedBorderColor = Color.LightGray))&#10;    Spacer(Modifier.height(32.dp))&#10;    Row(Modifier.fillMaxWidth(), Arrangement.spacedBy(16.dp)) {&#10;        OutlinedButton(onBack, Modifier.weight(1f).height(48.dp), &#10;            shape = RoundedCornerShape(24.dp), enabled = !loading) { Text(&quot;Back&quot;, fontFamily = AppFontFamily) }&#10;        Button(onVerify, Modifier.weight(1f).height(48.dp), shape = RoundedCornerShape(24.dp),&#10;            colors = ButtonDefaults.buttonColors(Color(0xFFE91E63)), enabled = !loading &amp;&amp; code.length == 6) {&#10;            if (loading) CircularProgressIndicator(Modifier.size(20.dp), Color.White, 2.dp)&#10;            else Text(&quot;Verify&quot;, fontSize = 16.sp, fontFamily = AppFontFamily)&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun Step3BackupCodes(codes: List&lt;String&gt;, copied: Boolean, error: String, loading: Boolean,&#10;    onCopy: () -&gt; Unit, onComplete: () -&gt; Unit) {&#10;    Text(&quot;Save Backup Codes&quot;, fontSize = 24.sp, fontWeight = FontWeight.Bold, fontFamily = AppFontFamily)&#10;    Spacer(Modifier.height(16.dp))&#10;    Card(Modifier.fillMaxWidth(), colors = CardDefaults.cardColors(Color(0xFFFFF3E0))) {&#10;        Row(Modifier.padding(16.dp), verticalAlignment = Alignment.CenterVertically) {&#10;            Text(&quot;&quot;, fontSize = 24.sp, modifier = Modifier.padding(end = 12.dp))&#10;            Text(&quot;Save these codes!&quot;, fontSize = 14.sp, fontFamily = AppFontFamily, color = Color(0xFFE65100))&#10;        }&#10;    }&#10;    Spacer(Modifier.height(24.dp))&#10;    Card(Modifier.fillMaxWidth(), colors = CardDefaults.cardColors(Color(0xFFF5F5F5))) {&#10;        Column(Modifier.padding(16.dp)) {&#10;            codes.chunked(2).forEach { row -&gt;&#10;                Row(Modifier.fillMaxWidth(), Arrangement.SpaceEvenly) {&#10;                    row.forEach { Text(it, fontSize = 16.sp, fontFamily = AppFontFamily, &#10;                        fontWeight = FontWeight.Medium, modifier = Modifier.padding(vertical = 8.dp)) }&#10;                }&#10;            }&#10;        }&#10;    }&#10;    Spacer(Modifier.height(16.dp))&#10;    OutlinedButton(onCopy, Modifier.fillMaxWidth()) {&#10;        Icon(Icons.Default.ContentCopy, &quot;Copy&quot;, Modifier.size(20.dp))&#10;        Spacer(Modifier.width(8.dp))&#10;        Text(&quot;Copy All&quot;, fontFamily = AppFontFamily)&#10;    }&#10;    if (copied) { Spacer(Modifier.height(8.dp)); Text(&quot; Copied&quot;, fontSize = 12.sp, &#10;        color = Color(0xFF4CAF50), fontFamily = AppFontFamily, &#10;        modifier = Modifier.fillMaxWidth(), textAlign = TextAlign.Center) }&#10;    Spacer(Modifier.height(32.dp))&#10;    Button(onComplete, Modifier.fillMaxWidth().height(48.dp), shape = RoundedCornerShape(24.dp),&#10;        colors = ButtonDefaults.buttonColors(Color(0xFFE91E63)), enabled = !loading) {&#10;        if (loading) CircularProgressIndicator(Modifier.size(20.dp), Color.White, 2.dp)&#10;        else Text(&quot;Complete Setup&quot;, fontSize = 16.sp, fontFamily = AppFontFamily)&#10;    }&#10;    if (error.isNotEmpty()) {&#10;        Spacer(Modifier.height(16.dp))&#10;        Card(Modifier.fillMaxWidth(), colors = CardDefaults.cardColors(Color(0xFFFFEBEE))) {&#10;            Text(error, fontSize = 14.sp, color = Color(0xFFD32F2F), &#10;                modifier = Modifier.padding(12.dp), fontFamily = AppFontFamily)&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaSetupScreen2.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaSetupScreen2.kt" />
              <option name="updatedContent" value="// This file is a duplicate and should be deleted.&#10;// The actual MFA Setup Screen implementation is in MfaSetupScreen.kt&#10;// Please delete this file manually: Right-click  Delete in Android Studio&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaVerifyScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaVerifyScreen.kt" />
              <option name="updatedContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.MfaApi&#10;import com.example.smartattendance.ui.theme.AppFontFamily&#10;import kotlinx.coroutines.launch&#10;&#10;@Composable&#10;fun MfaVerifyScreen(&#10;    user: AuthApi.User,&#10;    onVerificationSuccess: () -&gt; Unit = {},&#10;    onBackClick: () -&gt; Unit = {}&#10;) {&#10;    val coroutineScope = rememberCoroutineScope()&#10;    &#10;    var verificationCode by remember { mutableStateOf(&quot;&quot;) }&#10;    var isVerifying by remember { mutableStateOf(false) }&#10;    var errorMessage by remember { mutableStateOf(&quot;&quot;) }&#10;    var useBackupCode by remember { mutableStateOf(false) }&#10;    &#10;    Column(&#10;        modifier = Modifier.fillMaxSize().padding(24.dp).verticalScroll(rememberScrollState()),&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Box(&#10;            modifier = Modifier.size(80.dp).background(&#10;                color = Color(0xFFE91E63).copy(alpha = 0.1f),&#10;                shape = RoundedCornerShape(40.dp)&#10;            ),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Text(text = &quot;&quot;, fontSize = 40.sp)&#10;        }&#10;        &#10;        Spacer(modifier = Modifier.height(32.dp))&#10;        &#10;        Text(&#10;            text = &quot;Two-Factor Authentication&quot;,&#10;            fontSize = 24.sp,&#10;            fontWeight = FontWeight.Bold,&#10;            fontFamily = AppFontFamily,&#10;            color = Color.Black&#10;        )&#10;        &#10;        Spacer(modifier = Modifier.height(8.dp))&#10;        &#10;        Text(&#10;            text = if (useBackupCode) &quot;Enter backup code&quot; else &quot;Enter 6-digit code from authenticator&quot;,&#10;            fontSize = 14.sp,&#10;            fontFamily = AppFontFamily,&#10;            color = Color.Gray,&#10;            textAlign = TextAlign.Center&#10;        )&#10;        &#10;        Spacer(modifier = Modifier.height(32.dp))&#10;        &#10;        if (errorMessage.isNotEmpty()) {&#10;            Card(&#10;                modifier = Modifier.fillMaxWidth().padding(bottom = 16.dp),&#10;                colors = CardDefaults.cardColors(containerColor = Color(0xFFFFEBEE))&#10;            ) {&#10;                Text(&#10;                    text = errorMessage,&#10;                    fontSize = 14.sp,&#10;                    color = Color(0xFFD32F2F),&#10;                    modifier = Modifier.padding(12.dp),&#10;                    fontFamily = AppFontFamily&#10;                )&#10;            }&#10;        }&#10;        &#10;        OutlinedTextField(&#10;            value = verificationCode,&#10;            onValueChange = {&#10;                if (useBackupCode) {&#10;                    if (it.length &lt;= 9) { verificationCode = it.uppercase(); errorMessage = &quot;&quot; }&#10;                } else {&#10;                    if (it.length &lt;= 6 &amp;&amp; it.all { char -&gt; char.isDigit() }) {&#10;                        verificationCode = it; errorMessage = &quot;&quot;&#10;                    }&#10;                }&#10;            },&#10;            modifier = Modifier.fillMaxWidth(),&#10;            label = { Text(if (useBackupCode) &quot;Backup code&quot; else &quot;6-digit code&quot;, fontFamily = AppFontFamily) },&#10;            placeholder = { Text(if (useBackupCode) &quot;XXXX-XXXX&quot; else &quot;000000&quot;, fontFamily = AppFontFamily) },&#10;            singleLine = true,&#10;            enabled = !isVerifying,&#10;            colors = OutlinedTextFieldDefaults.colors(&#10;                focusedBorderColor = Color(0xFFE91E63),&#10;                unfocusedBorderColor = Color.LightGray&#10;            )&#10;        )&#10;        &#10;        Spacer(modifier = Modifier.height(16.dp))&#10;        &#10;        TextButton(&#10;            onClick = { useBackupCode = !useBackupCode; verificationCode = &quot;&quot;; errorMessage = &quot;&quot; },&#10;            enabled = !isVerifying&#10;        ) {&#10;            Text(&#10;                text = if (useBackupCode) &quot;Use authenticator code&quot; else &quot;Use backup code&quot;,&#10;                fontFamily = AppFontFamily,&#10;                color = Color(0xFFE91E63)&#10;            )&#10;        }&#10;        &#10;        Spacer(modifier = Modifier.height(32.dp))&#10;        &#10;        Button(&#10;            onClick = {&#10;                if (verificationCode.isEmpty()) { errorMessage = &quot;Please enter a code&quot;; return@Button }&#10;                if (!useBackupCode &amp;&amp; verificationCode.length != 6) {&#10;                    errorMessage = &quot;Please enter a 6-digit code&quot;; return@Button&#10;                }&#10;                &#10;                isVerifying = true&#10;                coroutineScope.launch {&#10;                    val result = MfaApi.verifyMfaCode(user.user_id ?: &quot;&quot;, verificationCode)&#10;                    isVerifying = false&#10;                    &#10;                    result.onSuccess { isValid -&gt;&#10;                        if (isValid) onVerificationSuccess()&#10;                        else { errorMessage = &quot;Invalid code. Please try again.&quot;; verificationCode = &quot;&quot; }&#10;                    }.onFailure {&#10;                        errorMessage = it.message ?: &quot;Verification failed&quot;; verificationCode = &quot;&quot;&#10;                    }&#10;                }&#10;            },&#10;            modifier = Modifier.fillMaxWidth().height(48.dp),&#10;            shape = RoundedCornerShape(24.dp),&#10;            colors = ButtonDefaults.buttonColors(containerColor = Color(0xFFE91E63)),&#10;            enabled = !isVerifying &amp;&amp; verificationCode.isNotEmpty()&#10;        ) {&#10;            if (isVerifying) {&#10;                CircularProgressIndicator(modifier = Modifier.size(20.dp), color = Color.White, strokeWidth = 2.dp)&#10;            } else {&#10;                Text(text = &quot;Verify&quot;, fontSize = 16.sp, fontFamily = AppFontFamily)&#10;            }&#10;        }&#10;        &#10;        Spacer(modifier = Modifier.height(16.dp))&#10;        &#10;        TextButton(onClick = onBackClick, enabled = !isVerifying) {&#10;            Text(text = &quot;Cancel&quot;, fontFamily = AppFontFamily, color = Color.Gray)&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaVerifyScreen2.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaVerifyScreen2.kt" />
              <option name="updatedContent" value="// This file is a duplicate and should be deleted.&#10;// The actual MFA Verify Screen implementation is in MfaVerifyScreen.kt&#10;// Please delete this file manually: Right-click  Delete in Android Studio&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/utils/QRCodeGenerator.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/utils/QRCodeGenerator.kt" />
              <option name="updatedContent" value="package com.example.smartattendance.utils&#10;&#10;import android.graphics.Bitmap&#10;import android.graphics.Color&#10;import com.google.zxing.BarcodeFormat&#10;import com.google.zxing.qrcode.QRCodeWriter&#10;&#10;object QRCodeGenerator {&#10;    fun generateQRCode(content: String, width: Int = 512, height: Int = 512): Bitmap {&#10;        val writer = QRCodeWriter()&#10;        val bitMatrix = writer.encode(content, BarcodeFormat.QR_CODE, width, height)&#10;        val bitmap = Bitmap.createBitmap(width, height, Bitmap.Config.RGB_565)&#10;        &#10;        for (x in 0 until width) {&#10;            for (y in 0 until height) {&#10;                bitmap.setPixel(x, y, if (bitMatrix[x, y]) Color.BLACK else Color.WHITE)&#10;            }&#10;        }&#10;        &#10;        return bitmap&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/database_functions.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/database_functions.sql" />
              <option name="updatedContent" value="-- ==============================&#10;-- STORED PROCEDURES FOR STATISTICS&#10;-- ==============================&#10;&#10;-- Function untuk mendapatkan statistik keseluruhan user&#10;CREATE OR REPLACE FUNCTION get_user_statistics(p_user_id VARCHAR)&#10;RETURNS TABLE(&#10;    total_present BIGINT,&#10;    total_late BIGINT, &#10;    total_absent BIGINT,&#10;    total_meetings BIGINT,&#10;    attendance_percentage NUMERIC&#10;) AS $$&#10;BEGIN&#10;    RETURN QUERY&#10;    SELECT &#10;        COALESCE(SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END), 0) as total_present,&#10;        COALESCE(SUM(CASE WHEN a.status = 'late' THEN 1 ELSE 0 END), 0) as total_late,&#10;        COALESCE(SUM(CASE WHEN a.status = 'absent' THEN 1 ELSE 0 END), 0) as total_absent,&#10;        COALESCE(COUNT(a.attendance_id), 0) as total_meetings,&#10;        COALESCE(&#10;            ROUND(&#10;                SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END) * 100.0 / &#10;                NULLIF(COUNT(a.attendance_id), 0), &#10;                2&#10;            ), &#10;            0&#10;        ) as attendance_percentage&#10;    FROM enrollments e&#10;    LEFT JOIN attendances a ON e.enrollment_id = a.enrollment_id&#10;    WHERE e.user_id = p_user_id;&#10;END;&#10;$$ LANGUAGE plpgsql;&#10;&#10;-- Function untuk mendapatkan statistik per mata kuliah&#10;CREATE OR REPLACE FUNCTION get_course_statistics(p_user_id VARCHAR)&#10;RETURNS TABLE(&#10;    course_code VARCHAR,&#10;    course_name VARCHAR,&#10;    total_pertemuan BIGINT,&#10;    hadir BIGINT,&#10;    terlambat BIGINT,&#10;    tidak_hadir BIGINT,&#10;    persentase_kehadiran NUMERIC&#10;) AS $$&#10;BEGIN&#10;    RETURN QUERY&#10;    SELECT &#10;        c.course_code,&#10;        c.course_name,&#10;        COUNT(a.attendance_id) as total_pertemuan,&#10;        SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END) as hadir,&#10;        SUM(CASE WHEN a.status = 'late' THEN 1 ELSE 0 END) as terlambat,&#10;        SUM(CASE WHEN a.status = 'absent' THEN 1 ELSE 0 END) as tidak_hadir,&#10;        ROUND(&#10;            SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END) * 100.0 / &#10;            NULLIF(COUNT(a.attendance_id), 0), &#10;            2&#10;        ) as persentase_kehadiran&#10;    FROM enrollments e&#10;    JOIN courses c ON e.course_id = c.course_id&#10;    LEFT JOIN attendances a ON e.enrollment_id = a.enrollment_id&#10;    WHERE e.user_id = p_user_id&#10;    GROUP BY c.course_code, c.course_name, c.course_id&#10;    ORDER BY c.course_code;&#10;END;&#10;$$ LANGUAGE plpgsql;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/mfa_schema.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/mfa_schema.sql" />
              <option name="updatedContent" value="-- ===============================&#10;-- MFA TABLE FOR STORING USER MFA SETTINGS&#10;-- ===============================&#10;CREATE TABLE user_mfa_settings (&#10;    mfa_id SERIAL PRIMARY KEY,&#10;    user_id VARCHAR(50) NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,&#10;    mfa_enabled BOOLEAN DEFAULT FALSE,&#10;    mfa_secret VARCHAR(255), -- TOTP secret key&#10;    backup_codes TEXT[], -- Array of backup codes&#10;    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    UNIQUE (user_id)&#10;);&#10;&#10;-- Trigger auto-update timestamp&#10;CREATE TRIGGER trigger_update_user_mfa_settings&#10;BEFORE UPDATE ON user_mfa_settings&#10;FOR EACH ROW&#10;EXECUTE FUNCTION update_timestamp();&#10;&#10;-- Index for faster lookups&#10;CREATE INDEX idx_user_mfa_settings_user_id ON user_mfa_settings(user_id);&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>