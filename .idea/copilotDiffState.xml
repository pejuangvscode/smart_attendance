<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/HomeScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/HomeScreen.kt" />
              <option name="originalContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.Canvas&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.border&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyRow&#10;import androidx.compose.foundation.lazy.itemsIndexed&#10;import androidx.compose.foundation.lazy.rememberLazyListState&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.rounded.ExitToApp&#10;import androidx.compose.material.icons.outlined.CalendarToday&#10;import androidx.compose.material.icons.outlined.Description&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.StrokeCap&#10;import androidx.compose.ui.graphics.drawscope.Stroke&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.StatisticsApi&#10;import com.example.smartattendance.data.AttendanceStatistics&#10;import com.example.smartattendance.ui.theme.SmartAttendanceTheme&#10;import com.example.smartattendance.utils.SessionManager&#10;import com.example.smartattendance.utils.SupabaseClient&#10;import java.time.LocalDate&#10;import java.time.format.DateTimeFormatter&#10;import java.time.DayOfWeek&#10;import java.util.Locale&#10;import kotlin.math.abs&#10;import kotlinx.coroutines.launch&#10;import androidx.compose.ui.platform.LocalContext&#10;import android.util.Log&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HomeScreen(&#10;    user: AuthApi.User?,&#10;    sessionManager: SessionManager,&#10;    onLogout: () -&gt; Unit = {},&#10;    onSubmitAttendance: () -&gt; Unit = {},&#10;    onDateClick: () -&gt; Unit = {},&#10;    onRequestPermission: () -&gt; Unit = {},&#10;    onBackClick: () -&gt; Unit = {}&#10;) {&#10;    val darkGray = Color(0xFF2C2D32)&#10;    val redColor = Color(0xFFE0697E)&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    // State untuk statistik presensi&#10;    var attendanceStatistics by remember { mutableStateOf(AttendanceStatistics.empty()) }&#10;    var isLoadingStatistics by remember { mutableStateOf(false) }&#10;    var statisticsError by remember { mutableStateOf&lt;String?&gt;(null) }&#10;&#10;    // Initialize StatisticsApi&#10;    val statisticsApi = remember { StatisticsApi(SupabaseClient.client) }&#10;&#10;    // Fetch statistics saat pertama kali load&#10;    LaunchedEffect(user?.user_id) {&#10;        user?.user_id?.let { userId -&gt;&#10;            isLoadingStatistics = true&#10;            statisticsError = null&#10;&#10;            try {&#10;                val result = statisticsApi.getUserStatistics(userId)&#10;                result.fold(&#10;                    onSuccess = { statistics -&gt;&#10;                        attendanceStatistics = AttendanceStatistics.fromOverallStatistic(statistics)&#10;                        Log.d(&quot;HomeScreen&quot;, &quot;Statistics loaded: $attendanceStatistics&quot;)&#10;                    },&#10;                    onFailure = { error -&gt;&#10;                        statisticsError = error.message ?: &quot;Failed to load statistics&quot;&#10;                        Log.e(&quot;HomeScreen&quot;, &quot;Error loading statistics&quot;, error)&#10;                    }&#10;                )&#10;            } catch (e: Exception) {&#10;                statisticsError = e.message ?: &quot;Unknown error occurred&quot;&#10;                Log.e(&quot;HomeScreen&quot;, &quot;Exception loading statistics&quot;, e)&#10;            } finally {&#10;                isLoadingStatistics = false&#10;            }&#10;        }&#10;    }&#10;&#10;    // Get current date&#10;    val currentDate = remember { LocalDate.now() }&#10;    val dayOfMonth = currentDate.dayOfMonth&#10;    val dayOfWeek = currentDate.dayOfWeek&#10;    val month = currentDate.format(DateTimeFormatter.ofPattern(&quot;MMMM&quot;, Locale.ENGLISH))&#10;    val year = currentDate.year&#10;    val dayName = dayOfWeek.getDisplayName(java.time.format.TextStyle.FULL, Locale.ENGLISH)&#10;&#10;&#10;    Box(&#10;        modifier = Modifier.fillMaxSize()&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.fillMaxSize()&#10;        ) {&#10;            // Background split - dark gray top, white bottom&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .weight(0.4f)&#10;                    .background(color = darkGray)&#10;            )&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .weight(0.6f)&#10;                    .background(color = Color.White)&#10;            )&#10;        }&#10;&#10;        Column(&#10;            modifier = Modifier.fillMaxSize()&#10;        ) {&#10;            // Header section&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(horizontal = 25.dp, vertical = 20.dp),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Column {&#10;                    Text(&#10;                        text = &quot;Hello, ${user?.full_name ?: &quot;User&quot;}!&quot;,&#10;                        fontSize = 28.sp,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = Color.White&#10;                    )&#10;                    Text(&#10;                        text = &quot;${user?.nim ?: &quot;Unknown&quot;}/Semester Ganjil&quot;,&#10;                        fontSize = 14.sp,&#10;                        color = Color.White.copy(alpha = 0.8f)&#10;                    )&#10;                }&#10;&#10;                IconButton(onClick = {&#10;                    coroutineScope.launch {&#10;                        sessionManager.clearSession()&#10;                        onLogout()&#10;                    }&#10;                }) {&#10;                    Icon(&#10;                        imageVector = Icons.AutoMirrored.Rounded.ExitToApp,&#10;                        contentDescription = &quot;Logout&quot;,&#10;                        tint = Color.White,&#10;                        modifier = Modifier.size(40.dp)&#10;                    )&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            // Cards section with proper padding&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(horizontal = 25.dp)&#10;            ) {&#10;                // Take attendance card&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Row(&#10;                        verticalAlignment = Alignment.CenterVertically,&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(horizontal = 12.dp, vertical = 8.dp)&#10;                    ) {&#10;                        Icon(&#10;                            imageVector = Icons.Outlined.CalendarToday,&#10;                            contentDescription = &quot;Calendar&quot;,&#10;                            tint = Color.Black,&#10;                            modifier = Modifier.size(20.dp)&#10;                        )&#10;                        Spacer(modifier = Modifier.width(8.dp))&#10;                        Column(&#10;                            modifier = Modifier.weight(0.8f)&#10;                        ) {&#10;                            Text(&#10;                                text = &quot;KEAMANAN KOMPUTER &amp; JARINGAN&quot;,&#10;                                fontSize = 14.sp,&#10;                                color = Color.Black,&#10;                                fontWeight = FontWeight.Medium,&#10;                                maxLines = 2&#10;                            )&#10;                        }&#10;                        Spacer(modifier = Modifier.width(8.dp))&#10;                        Button(&#10;                            onClick = onSubmitAttendance,&#10;                            colors = ButtonDefaults.buttonColors(containerColor = redColor),&#10;                            shape = RoundedCornerShape(8.dp),&#10;                            modifier = Modifier.height(32.dp)&#10;                        ) {&#10;                            Text(&quot;Submit&quot;, fontSize = 14.sp, color = Color.White)&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Date card&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .clickable { onDateClick() },&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier.padding(20.dp)&#10;                    ) {&#10;                        Row(&#10;                            verticalAlignment = Alignment.CenterVertically&#10;                        ) {&#10;                            Text(&#10;                                text = dayOfMonth.toString(),&#10;                                fontSize = 70.sp,&#10;                                fontWeight = FontWeight.Bold,&#10;                                color = Color.Black&#10;                            )&#10;                            Spacer(modifier = Modifier.width(16.dp))&#10;                            Column {&#10;                                Text(&#10;                                    text = dayName,&#10;                                    fontSize = 20.sp,&#10;                                    fontWeight = FontWeight.Medium,&#10;                                    color = Color.Black&#10;                                )&#10;                                Text(&#10;                                    text = &quot;$month $year&quot;,&#10;                                    fontSize = 14.sp,&#10;                                    color = Color.Gray&#10;                                )&#10;                            }&#10;                        }&#10;&#10;                        Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                        Text(&#10;                            text = &quot;This week status&quot;,&#10;                            fontSize = 14.sp,&#10;                            color = Color.Gray,&#10;                            modifier = Modifier.padding(bottom = 12.dp)&#10;                        )&#10;&#10;                        Row(&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            horizontalArrangement = Arrangement.SpaceEvenly&#10;                        ) {&#10;                            WeekDayIndicator(&quot;M&quot;, true, Color(0xFFFF9D00))&#10;                            WeekDayIndicator(&quot;T&quot;, true, darkGray)&#10;                            WeekDayIndicator(&quot;W&quot;, true, redColor)&#10;                            WeekDayIndicator(&quot;Th&quot;, true, darkGray)&#10;                            WeekDayIndicator(&quot;F&quot;, false, Color.LightGray)&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Statistics Card&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(20.dp)&#10;                    ) {&#10;                        Text(&#10;                            text = &quot;This Semester&quot;,&#10;                            fontSize = 16.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = Color.Black,&#10;                            modifier = Modifier.padding(bottom = 16.dp)&#10;                        )&#10;&#10;                        if (isLoadingStatistics) {&#10;                            // Loading state&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .height(100.dp),&#10;                                contentAlignment = Alignment.Center&#10;                            ) {&#10;                                CircularProgressIndicator(&#10;                                    color = darkGray,&#10;                                    modifier = Modifier.size(40.dp)&#10;                                )&#10;                            }&#10;                        } else if (statisticsError != null) {&#10;                            // Error state&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .height(100.dp),&#10;                                contentAlignment = Alignment.Center&#10;                            ) {&#10;                                Text(&#10;                                    text = &quot;Failed to load statistics&quot;,&#10;                                    color = Color.Red,&#10;                                    fontSize = 14.sp&#10;                                )&#10;                            }&#10;                        } else {&#10;                            // Donut charts row with real data&#10;                            Row(&#10;                                modifier = Modifier.fillMaxWidth(),&#10;                                horizontalArrangement = Arrangement.SpaceEvenly&#10;                            ) {&#10;                                IndividualDonutChart(&#10;                                    value = attendanceStatistics.present,&#10;                                    percentage = attendanceStatistics.presentPercentage,&#10;                                    label = &quot;Present&quot;,&#10;                                    color = Color(0xFF4CAF50)&#10;                                )&#10;                                IndividualDonutChart(&#10;                                    value = attendanceStatistics.excused,&#10;                                    percentage = attendanceStatistics.excusedPercentage,&#10;                                    label = &quot;Excused&quot;,&#10;                                    color = Color(0xFF2196F3)&#10;                                )&#10;                                IndividualDonutChart(&#10;                                    value = attendanceStatistics.sick,&#10;                                    percentage = attendanceStatistics.sickPercentage,&#10;                                    label = &quot;Sick&quot;,&#10;                                    color = Color(0xFFFF9800)&#10;                                )&#10;                                IndividualDonutChart(&#10;                                    value = attendanceStatistics.absent,&#10;                                    percentage = attendanceStatistics.absentPercentage,&#10;                                    label = &quot;Absent&quot;,&#10;                                    color = Color(0xFF9E9E9E)&#10;                                )&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Request Permission card&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .clickable { onRequestPermission() },&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(24.dp),&#10;                        horizontalAlignment = Alignment.CenterHorizontally&#10;                    ) {&#10;                        Icon(&#10;                            imageVector = Icons.Outlined.Description,&#10;                            contentDescription = &quot;Request Permission&quot;,&#10;                            tint = Color.Black,&#10;                            modifier = Modifier.size(36.dp)&#10;                        )&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                        Text(&#10;                            text = &quot;Ask Permission&quot;,&#10;                            fontSize = 14.sp,&#10;                            color = Color.Black&#10;                        )&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun WeekDayIndicator(day: String, attended: Boolean, color: Color) {&#10;    Box(&#10;        modifier = Modifier&#10;            .size(40.dp)&#10;            .clip(CircleShape)&#10;            .background(if (attended) color else Color.White)&#10;            .border(2.dp, color, CircleShape),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Text(&#10;            text = day,&#10;            color = if (attended) Color.White else color,&#10;            fontWeight = FontWeight.Bold&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun IndividualDonutChart(&#10;    value: Int,&#10;    percentage: Float,&#10;    label: String,&#10;    color: Color&#10;) {&#10;    Column(&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Box(&#10;            modifier = Modifier.size(60.dp),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Canvas(modifier = Modifier.fillMaxSize()) {&#10;                val strokeWidth = 8.dp.toPx()&#10;                // Background circle&#10;                drawCircle(&#10;                    color = Color.LightGray.copy(alpha = 0.3f),&#10;                    style = Stroke(width = strokeWidth)&#10;                )&#10;                // Foreground arc&#10;                drawArc(&#10;                    color = color,&#10;                    startAngle = -90f,&#10;                    sweepAngle = percentage * 360 / 100, // Convert percentage to angle&#10;                    useCenter = false,&#10;                    style = Stroke(width = strokeWidth, cap = StrokeCap.Round)&#10;                )&#10;            }&#10;            Text(&#10;                text = value.toString(),&#10;                fontSize = 16.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.Black&#10;            )&#10;        }&#10;        Spacer(modifier = Modifier.height(4.dp))&#10;        Text(&#10;            text = label,&#10;            fontSize = 12.sp,&#10;            color = Color.Gray&#10;        )&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun HomeScreenPreview() {&#10;    SmartAttendanceTheme {&#10;        HomeScreen(user = AuthApi.User(full_name = &quot;Teo&quot;, email = &quot;&quot;, password_hash = &quot;&quot;), sessionManager = SessionManager(LocalContext.current))&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.Canvas&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.border&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyRow&#10;import androidx.compose.foundation.lazy.itemsIndexed&#10;import androidx.compose.foundation.lazy.rememberLazyListState&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.rounded.ExitToApp&#10;import androidx.compose.material.icons.outlined.CalendarToday&#10;import androidx.compose.material.icons.outlined.Description&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.StrokeCap&#10;import androidx.compose.ui.graphics.drawscope.Stroke&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.tooling.preview.Preview&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.StatisticsApi&#10;import com.example.smartattendance.data.AttendanceStatistics&#10;import com.example.smartattendance.ui.theme.SmartAttendanceTheme&#10;import com.example.smartattendance.utils.SessionManager&#10;import java.time.LocalDate&#10;import java.time.format.DateTimeFormatter&#10;import java.time.DayOfWeek&#10;import java.util.Locale&#10;import kotlin.math.abs&#10;import kotlinx.coroutines.launch&#10;import androidx.compose.ui.platform.LocalContext&#10;import android.util.Log&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun HomeScreen(&#10;    user: AuthApi.User?,&#10;    sessionManager: SessionManager,&#10;    onLogout: () -&gt; Unit = {},&#10;    onSubmitAttendance: () -&gt; Unit = {},&#10;    onDateClick: () -&gt; Unit = {},&#10;    onRequestPermission: () -&gt; Unit = {},&#10;    onBackClick: () -&gt; Unit = {}&#10;) {&#10;    val darkGray = Color(0xFF2C2D32)&#10;    val redColor = Color(0xFFE0697E)&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    // State untuk statistik presensi&#10;    var attendanceStatistics by remember { mutableStateOf(AttendanceStatistics.empty()) }&#10;    var isLoadingStatistics by remember { mutableStateOf(false) }&#10;    var statisticsError by remember { mutableStateOf&lt;String?&gt;(null) }&#10;&#10;    // Initialize StatisticsApi&#10;    val statisticsApi = remember { StatisticsApi(AuthApi.supabase) }&#10;&#10;    // Fetch statistics saat pertama kali load&#10;    LaunchedEffect(user?.user_id) {&#10;        user?.user_id?.let { userId -&gt;&#10;            isLoadingStatistics = true&#10;            statisticsError = null&#10;&#10;            try {&#10;                val result = statisticsApi.getUserStatistics(userId)&#10;                result.fold(&#10;                    onSuccess = { statistics -&gt;&#10;                        attendanceStatistics = AttendanceStatistics.fromOverallStatistic(statistics)&#10;                        Log.d(&quot;HomeScreen&quot;, &quot;Statistics loaded: $attendanceStatistics&quot;)&#10;                    },&#10;                    onFailure = { error -&gt;&#10;                        statisticsError = error.message ?: &quot;Failed to load statistics&quot;&#10;                        Log.e(&quot;HomeScreen&quot;, &quot;Error loading statistics&quot;, error)&#10;                    }&#10;                )&#10;            } catch (e: Exception) {&#10;                statisticsError = e.message ?: &quot;Unknown error occurred&quot;&#10;                Log.e(&quot;HomeScreen&quot;, &quot;Exception loading statistics&quot;, e)&#10;            } finally {&#10;                isLoadingStatistics = false&#10;            }&#10;        }&#10;    }&#10;&#10;    // Get current date&#10;    val currentDate = remember { LocalDate.now() }&#10;    val dayOfMonth = currentDate.dayOfMonth&#10;    val dayOfWeek = currentDate.dayOfWeek&#10;    val month = currentDate.format(DateTimeFormatter.ofPattern(&quot;MMMM&quot;, Locale.ENGLISH))&#10;    val year = currentDate.year&#10;    val dayName = dayOfWeek.getDisplayName(java.time.format.TextStyle.FULL, Locale.ENGLISH)&#10;&#10;&#10;    Box(&#10;        modifier = Modifier.fillMaxSize()&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.fillMaxSize()&#10;        ) {&#10;            // Background split - dark gray top, white bottom&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .weight(0.4f)&#10;                    .background(color = darkGray)&#10;            )&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .weight(0.6f)&#10;                    .background(color = Color.White)&#10;            )&#10;        }&#10;&#10;        Column(&#10;            modifier = Modifier.fillMaxSize()&#10;        ) {&#10;            // Header section&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(horizontal = 25.dp, vertical = 20.dp),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Column {&#10;                    Text(&#10;                        text = &quot;Hello, ${user?.full_name ?: &quot;User&quot;}!&quot;,&#10;                        fontSize = 28.sp,&#10;                        fontWeight = FontWeight.Bold,&#10;                        color = Color.White&#10;                    )&#10;                    Text(&#10;                        text = &quot;${user?.nim ?: &quot;Unknown&quot;}/Semester Ganjil&quot;,&#10;                        fontSize = 14.sp,&#10;                        color = Color.White.copy(alpha = 0.8f)&#10;                    )&#10;                }&#10;&#10;                IconButton(onClick = {&#10;                    coroutineScope.launch {&#10;                        sessionManager.clearSession()&#10;                        onLogout()&#10;                    }&#10;                }) {&#10;                    Icon(&#10;                        imageVector = Icons.AutoMirrored.Rounded.ExitToApp,&#10;                        contentDescription = &quot;Logout&quot;,&#10;                        tint = Color.White,&#10;                        modifier = Modifier.size(40.dp)&#10;                    )&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(16.dp))&#10;&#10;            // Cards section with proper padding&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(horizontal = 25.dp)&#10;            ) {&#10;                // Take attendance card&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Row(&#10;                        verticalAlignment = Alignment.CenterVertically,&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(horizontal = 12.dp, vertical = 8.dp)&#10;                    ) {&#10;                        Icon(&#10;                            imageVector = Icons.Outlined.CalendarToday,&#10;                            contentDescription = &quot;Calendar&quot;,&#10;                            tint = Color.Black,&#10;                            modifier = Modifier.size(20.dp)&#10;                        )&#10;                        Spacer(modifier = Modifier.width(8.dp))&#10;                        Column(&#10;                            modifier = Modifier.weight(0.8f)&#10;                        ) {&#10;                            Text(&#10;                                text = &quot;KEAMANAN KOMPUTER &amp; JARINGAN&quot;,&#10;                                fontSize = 14.sp,&#10;                                color = Color.Black,&#10;                                fontWeight = FontWeight.Medium,&#10;                                maxLines = 2&#10;                            )&#10;                        }&#10;                        Spacer(modifier = Modifier.width(8.dp))&#10;                        Button(&#10;                            onClick = onSubmitAttendance,&#10;                            colors = ButtonDefaults.buttonColors(containerColor = redColor),&#10;                            shape = RoundedCornerShape(8.dp),&#10;                            modifier = Modifier.height(32.dp)&#10;                        ) {&#10;                            Text(&quot;Submit&quot;, fontSize = 14.sp, color = Color.White)&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Date card&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .clickable { onDateClick() },&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier.padding(20.dp)&#10;                    ) {&#10;                        Row(&#10;                            verticalAlignment = Alignment.CenterVertically&#10;                        ) {&#10;                            Text(&#10;                                text = dayOfMonth.toString(),&#10;                                fontSize = 70.sp,&#10;                                fontWeight = FontWeight.Bold,&#10;                                color = Color.Black&#10;                            )&#10;                            Spacer(modifier = Modifier.width(16.dp))&#10;                            Column {&#10;                                Text(&#10;                                    text = dayName,&#10;                                    fontSize = 20.sp,&#10;                                    fontWeight = FontWeight.Medium,&#10;                                    color = Color.Black&#10;                                )&#10;                                Text(&#10;                                    text = &quot;$month $year&quot;,&#10;                                    fontSize = 14.sp,&#10;                                    color = Color.Gray&#10;                                )&#10;                            }&#10;                        }&#10;&#10;                        Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                        Text(&#10;                            text = &quot;This week status&quot;,&#10;                            fontSize = 14.sp,&#10;                            color = Color.Gray,&#10;                            modifier = Modifier.padding(bottom = 12.dp)&#10;                        )&#10;&#10;                        Row(&#10;                            modifier = Modifier.fillMaxWidth(),&#10;                            horizontalArrangement = Arrangement.SpaceEvenly&#10;                        ) {&#10;                            WeekDayIndicator(&quot;M&quot;, true, Color(0xFFFF9D00))&#10;                            WeekDayIndicator(&quot;T&quot;, true, darkGray)&#10;                            WeekDayIndicator(&quot;W&quot;, true, redColor)&#10;                            WeekDayIndicator(&quot;Th&quot;, true, darkGray)&#10;                            WeekDayIndicator(&quot;F&quot;, false, Color.LightGray)&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Statistics Card&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(20.dp)&#10;                    ) {&#10;                        Text(&#10;                            text = &quot;This Semester&quot;,&#10;                            fontSize = 16.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            color = Color.Black,&#10;                            modifier = Modifier.padding(bottom = 16.dp)&#10;                        )&#10;&#10;                        if (isLoadingStatistics) {&#10;                            // Loading state&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .height(100.dp),&#10;                                contentAlignment = Alignment.Center&#10;                            ) {&#10;                                CircularProgressIndicator(&#10;                                    color = darkGray,&#10;                                    modifier = Modifier.size(40.dp)&#10;                                )&#10;                            }&#10;                        } else if (statisticsError != null) {&#10;                            // Error state&#10;                            Box(&#10;                                modifier = Modifier&#10;                                    .fillMaxWidth()&#10;                                    .height(100.dp),&#10;                                contentAlignment = Alignment.Center&#10;                            ) {&#10;                                Text(&#10;                                    text = &quot;Failed to load statistics&quot;,&#10;                                    color = Color.Red,&#10;                                    fontSize = 14.sp&#10;                                )&#10;                            }&#10;                        } else {&#10;                            // Donut charts row with real data&#10;                            Row(&#10;                                modifier = Modifier.fillMaxWidth(),&#10;                                horizontalArrangement = Arrangement.SpaceEvenly&#10;                            ) {&#10;                                IndividualDonutChart(&#10;                                    value = attendanceStatistics.present,&#10;                                    percentage = attendanceStatistics.presentPercentage,&#10;                                    label = &quot;Present&quot;,&#10;                                    color = Color(0xFF4CAF50)&#10;                                )&#10;                                IndividualDonutChart(&#10;                                    value = attendanceStatistics.excused,&#10;                                    percentage = attendanceStatistics.excusedPercentage,&#10;                                    label = &quot;Excused&quot;,&#10;                                    color = Color(0xFF2196F3)&#10;                                )&#10;                                IndividualDonutChart(&#10;                                    value = attendanceStatistics.sick,&#10;                                    percentage = attendanceStatistics.sickPercentage,&#10;                                    label = &quot;Sick&quot;,&#10;                                    color = Color(0xFFFF9800)&#10;                                )&#10;                                IndividualDonutChart(&#10;                                    value = attendanceStatistics.absent,&#10;                                    percentage = attendanceStatistics.absentPercentage,&#10;                                    label = &quot;Absent&quot;,&#10;                                    color = Color(0xFF9E9E9E)&#10;                                )&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;&#10;                // Request Permission card&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .clickable { onRequestPermission() },&#10;                    shape = RoundedCornerShape(10.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color.White),&#10;                    elevation = CardDefaults.cardElevation(defaultElevation = 8.dp)&#10;                ) {&#10;                    Column(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(24.dp),&#10;                        horizontalAlignment = Alignment.CenterHorizontally&#10;                    ) {&#10;                        Icon(&#10;                            imageVector = Icons.Outlined.Description,&#10;                            contentDescription = &quot;Request Permission&quot;,&#10;                            tint = Color.Black,&#10;                            modifier = Modifier.size(36.dp)&#10;                        )&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                        Text(&#10;                            text = &quot;Ask Permission&quot;,&#10;                            fontSize = 14.sp,&#10;                            color = Color.Black&#10;                        )&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(20.dp))&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun WeekDayIndicator(day: String, attended: Boolean, color: Color) {&#10;    Box(&#10;        modifier = Modifier&#10;            .size(40.dp)&#10;            .clip(CircleShape)&#10;            .background(if (attended) color else Color.White)&#10;            .border(2.dp, color, CircleShape),&#10;        contentAlignment = Alignment.Center&#10;    ) {&#10;        Text(&#10;            text = day,&#10;            color = if (attended) Color.White else color,&#10;            fontWeight = FontWeight.Bold&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;fun IndividualDonutChart(&#10;    value: Int,&#10;    percentage: Float,&#10;    label: String,&#10;    color: Color&#10;) {&#10;    Column(&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        verticalArrangement = Arrangement.Center&#10;    ) {&#10;        Box(&#10;            modifier = Modifier.size(60.dp),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Canvas(modifier = Modifier.fillMaxSize()) {&#10;                val strokeWidth = 8.dp.toPx()&#10;                // Background circle&#10;                drawCircle(&#10;                    color = Color.LightGray.copy(alpha = 0.3f),&#10;                    style = Stroke(width = strokeWidth)&#10;                )&#10;                // Foreground arc&#10;                drawArc(&#10;                    color = color,&#10;                    startAngle = -90f,&#10;                    sweepAngle = percentage * 360 / 100, // Convert percentage to angle&#10;                    useCenter = false,&#10;                    style = Stroke(width = strokeWidth, cap = StrokeCap.Round)&#10;                )&#10;            }&#10;            Text(&#10;                text = value.toString(),&#10;                fontSize = 16.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                color = Color.Black&#10;            )&#10;        }&#10;        Spacer(modifier = Modifier.height(4.dp))&#10;        Text(&#10;            text = label,&#10;            fontSize = 12.sp,&#10;            color = Color.Gray&#10;        )&#10;    }&#10;}&#10;&#10;@Preview(showBackground = true)&#10;@Composable&#10;fun HomeScreenPreview() {&#10;    SmartAttendanceTheme {&#10;        HomeScreen(user = AuthApi.User(full_name = &quot;Teo&quot;, email = &quot;&quot;, password_hash = &quot;&quot;), sessionManager = SessionManager(LocalContext.current))&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/database_functions.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/database_functions.sql" />
              <option name="updatedContent" value="-- ==============================&#10;-- STORED PROCEDURES FOR STATISTICS&#10;-- ==============================&#10;&#10;-- Function untuk mendapatkan statistik keseluruhan user&#10;CREATE OR REPLACE FUNCTION get_user_statistics(p_user_id VARCHAR)&#10;RETURNS TABLE(&#10;    total_present BIGINT,&#10;    total_late BIGINT, &#10;    total_absent BIGINT,&#10;    total_meetings BIGINT,&#10;    attendance_percentage NUMERIC&#10;) AS $$&#10;BEGIN&#10;    RETURN QUERY&#10;    SELECT &#10;        COALESCE(SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END), 0) as total_present,&#10;        COALESCE(SUM(CASE WHEN a.status = 'late' THEN 1 ELSE 0 END), 0) as total_late,&#10;        COALESCE(SUM(CASE WHEN a.status = 'absent' THEN 1 ELSE 0 END), 0) as total_absent,&#10;        COALESCE(COUNT(a.attendance_id), 0) as total_meetings,&#10;        COALESCE(&#10;            ROUND(&#10;                SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END) * 100.0 / &#10;                NULLIF(COUNT(a.attendance_id), 0), &#10;                2&#10;            ), &#10;            0&#10;        ) as attendance_percentage&#10;    FROM enrollments e&#10;    LEFT JOIN attendances a ON e.enrollment_id = a.enrollment_id&#10;    WHERE e.user_id = p_user_id;&#10;END;&#10;$$ LANGUAGE plpgsql;&#10;&#10;-- Function untuk mendapatkan statistik per mata kuliah&#10;CREATE OR REPLACE FUNCTION get_course_statistics(p_user_id VARCHAR)&#10;RETURNS TABLE(&#10;    course_code VARCHAR,&#10;    course_name VARCHAR,&#10;    total_pertemuan BIGINT,&#10;    hadir BIGINT,&#10;    terlambat BIGINT,&#10;    tidak_hadir BIGINT,&#10;    persentase_kehadiran NUMERIC&#10;) AS $$&#10;BEGIN&#10;    RETURN QUERY&#10;    SELECT &#10;        c.course_code,&#10;        c.course_name,&#10;        COUNT(a.attendance_id) as total_pertemuan,&#10;        SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END) as hadir,&#10;        SUM(CASE WHEN a.status = 'late' THEN 1 ELSE 0 END) as terlambat,&#10;        SUM(CASE WHEN a.status = 'absent' THEN 1 ELSE 0 END) as tidak_hadir,&#10;        ROUND(&#10;            SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END) * 100.0 / &#10;            NULLIF(COUNT(a.attendance_id), 0), &#10;            2&#10;        ) as persentase_kehadiran&#10;    FROM enrollments e&#10;    JOIN courses c ON e.course_id = c.course_id&#10;    LEFT JOIN attendances a ON e.enrollment_id = a.enrollment_id&#10;    WHERE e.user_id = p_user_id&#10;    GROUP BY c.course_code, c.course_name, c.course_id&#10;    ORDER BY c.course_code;&#10;END;&#10;$$ LANGUAGE plpgsql;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>