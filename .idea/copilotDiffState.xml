<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaSettingsScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaSettingsScreen.kt" />
              <option name="originalContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Security&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.MfaApi&#10;import com.example.smartattendance.ui.components.AppHeader&#10;import com.example.smartattendance.ui.components.HeaderType&#10;import com.example.smartattendance.ui.theme.AppFontFamily&#10;import kotlinx.coroutines.launch&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MfaSettingsScreen(&#10;    user: AuthApi.User,&#10;    onBackClick: () -&gt; Unit = {},&#10;    onSetupMfa: () -&gt; Unit = {}&#10;) {&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    var mfaSettings by remember { mutableStateOf&lt;MfaApi.MfaSettings?&gt;(null) }&#10;    var isLoading by remember { mutableStateOf(true) }&#10;    var showDisableDialog by remember { mutableStateOf(false) }&#10;    var isDisabling by remember { mutableStateOf(false) }&#10;    var errorMessage by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    // Load MFA settings&#10;    LaunchedEffect(Unit) {&#10;        val result = MfaApi.getMfaSettings(user.user_id ?: &quot;&quot;)&#10;        isLoading = false&#10;        result.onSuccess { settings -&gt;&#10;            mfaSettings = settings&#10;        }.onFailure {&#10;            errorMessage = it.message ?: &quot;Failed to load MFA settings&quot;&#10;        }&#10;    }&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(Color(0xFFF6F6F6))&#10;    ) {&#10;        // Use AppHeader component&#10;        AppHeader(&#10;            title = &quot;MFA Settings&quot;,&#10;            headerType = HeaderType.BACK,&#10;            onBackClick = onBackClick,&#10;            showIcon = false&#10;        )&#10;&#10;        if (isLoading) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(16.dp),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                CircularProgressIndicator(color = Color(0xFF2C2D32))&#10;            }&#10;        } else {&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(24.dp)&#10;                    .verticalScroll(rememberScrollState())&#10;            ) {&#10;                // Status Card&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = CardDefaults.cardColors(&#10;                        containerColor = if (mfaSettings?.mfa_enabled == true)&#10;                            Color(0xFFE8F5E9)&#10;                        else&#10;                            Color(0xFFFFF3E0)&#10;                    )&#10;                ) {&#10;                    Row(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(16.dp),&#10;                        verticalAlignment = Alignment.CenterVertically&#10;                    ) {&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .size(48.dp)&#10;                                .background(&#10;                                    color = if (mfaSettings?.mfa_enabled == true)&#10;                                        Color(0xFF4CAF50).copy(alpha = 0.2f)&#10;                                    else&#10;                                        Color(0xFFFF9800).copy(alpha = 0.2f),&#10;                                    shape = RoundedCornerShape(24.dp)&#10;                                ),&#10;                            contentAlignment = Alignment.Center&#10;                        ) {&#10;                            Icon(&#10;                                imageVector = Icons.Default.Security,&#10;                                contentDescription = &quot;Security&quot;,&#10;                                tint = if (mfaSettings?.mfa_enabled == true)&#10;                                    Color(0xFF4CAF50)&#10;                                else&#10;                                    Color(0xFFFF9800),&#10;                                modifier = Modifier.size(24.dp)&#10;                            )&#10;                        }&#10;&#10;                        Spacer(modifier = Modifier.width(16.dp))&#10;&#10;                        Column(modifier = Modifier.weight(1f)) {&#10;                            Text(&#10;                                text = if (mfaSettings?.mfa_enabled == true)&#10;                                    &quot;MFA Enabled&quot;&#10;                                else&#10;                                    &quot;MFA Disabled&quot;,&#10;                                fontSize = 18.sp,&#10;                                fontWeight = FontWeight.Bold,&#10;                                fontFamily = AppFontFamily,&#10;                                color = Color.Black&#10;                            )&#10;                            Text(&#10;                                text = if (mfaSettings?.mfa_enabled == true)&#10;                                    &quot;Your account is protected&quot;&#10;                                else&#10;                                    &quot;Enable for extra security&quot;,&#10;                                fontSize = 14.sp,&#10;                                fontFamily = AppFontFamily,&#10;                                color = Color.Gray&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;&#10;                // Information&#10;                Text(&#10;                    text = &quot;About Two-Factor Authentication&quot;,&#10;                    fontSize = 16.sp,&#10;                    fontWeight = FontWeight.Bold,&#10;                    fontFamily = AppFontFamily,&#10;                    color = Color.Black&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(12.dp))&#10;&#10;                Text(&#10;                    text = &quot;Two-factor authentication (2FA) adds an extra layer of security to your account. &quot; +&#10;                            &quot;In addition to your password, you'll need to enter a code from your authenticator app when logging in.&quot;,&#10;                    fontSize = 14.sp,&#10;                    fontFamily = AppFontFamily,&#10;                    color = Color.Gray,&#10;                    lineHeight = 20.sp&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;&#10;                // Benefits&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = CardDefaults.cardColors(containerColor = Color(0xFFF5F5F5))&#10;                ) {&#10;                    Column(modifier = Modifier.padding(16.dp)) {&#10;                        Text(&#10;                            text = &quot;Benefits:&quot;,&#10;                            fontSize = 14.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            fontFamily = AppFontFamily,&#10;                            color = Color.Black&#10;                        )&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                        BenefitItem(&quot; Enhanced account security&quot;)&#10;                        BenefitItem(&quot;️ Protection against unauthorized access&quot;)&#10;                        BenefitItem(&quot; Works with Google Authenticator, Authy, etc.&quot;)&#10;                        BenefitItem(&quot; Backup codes for emergency access&quot;)&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(32.dp))&#10;&#10;                if (errorMessage.isNotEmpty()) {&#10;                    Card(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(bottom = 16.dp),&#10;                        colors = CardDefaults.cardColors(containerColor = Color(0xFFFFEBEE))&#10;                    ) {&#10;                        Text(&#10;                            text = errorMessage,&#10;                            fontSize = 14.sp,&#10;                            color = Color(0xFFD32F2F),&#10;                            modifier = Modifier.padding(12.dp),&#10;                            fontFamily = AppFontFamily&#10;                        )&#10;                    }&#10;                }&#10;&#10;                // Action Button&#10;                if (mfaSettings?.mfa_enabled == true) {&#10;                    OutlinedButton(&#10;                        onClick = { showDisableDialog = true },&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .height(48.dp),&#10;                        shape = RoundedCornerShape(24.dp),&#10;                        colors = ButtonDefaults.outlinedButtonColors(&#10;                            contentColor = Color(0xFFD32F2F)&#10;                        ),&#10;                        enabled = !isDisabling&#10;                    ) {&#10;                        if (isDisabling) {&#10;                            CircularProgressIndicator(&#10;                                modifier = Modifier.size(20.dp),&#10;                                color = Color(0xFFD32F2F),&#10;                                strokeWidth = 2.dp&#10;                            )&#10;                        } else {&#10;                            Text(&#10;                                text = &quot;Disable Two-Factor Authentication&quot;,&#10;                                fontSize = 16.sp,&#10;                                fontFamily = AppFontFamily&#10;                            )&#10;                        }&#10;                    }&#10;&#10;                    // Show remaining backup codes count&#10;                    mfaSettings?.backup_codes?.let { codes -&gt;&#10;                        if (codes.isNotEmpty()) {&#10;                            Spacer(modifier = Modifier.height(16.dp))&#10;                            Text(&#10;                                text = &quot;You have ${codes.size} backup code${if (codes.size != 1) &quot;s&quot; else &quot;&quot;} remaining&quot;,&#10;                                fontSize = 14.sp,&#10;                                fontFamily = AppFontFamily,&#10;                                color = Color.Gray,&#10;                                modifier = Modifier.fillMaxWidth()&#10;                            )&#10;                        }&#10;                    }&#10;                } else {&#10;                    Button(&#10;                        onClick = onSetupMfa,&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .height(48.dp),&#10;                        shape = RoundedCornerShape(24.dp),&#10;                        colors = ButtonDefaults.buttonColors(containerColor = Color(0xFFE91E63))&#10;                    ) {&#10;                        Text(&#10;                            text = &quot;Enable Two-Factor Authentication&quot;,&#10;                            fontSize = 16.sp,&#10;                            fontFamily = AppFontFamily&#10;                        )&#10;                            .height(56.dp),&#10;                        shape = RoundedCornerShape(16.dp),&#10;                        colors = ButtonDefaults.buttonColors(containerColor = Color(0xFF2C2D32)),&#10;                        elevation = ButtonDefaults.buttonElevation(0.dp)&#10;        }&#10;&#10;        // Disable MFA Confirmation Dialog&#10;        if (showDisableDialog) {&#10;                            fontFamily = AppFontFamily,&#10;                            fontWeight = FontWeight.SemiBold&#10;                onDismissRequest = { if (!isDisabling) showDisableDialog = false },&#10;                title = {&#10;                    Text(&#10;                        text = &quot;Disable Two-Factor Authentication?&quot;,&#10;                        fontFamily = AppFontFamily,&#10;                        fontWeight = FontWeight.Bold&#10;                    )&#10;                },&#10;                text = {&#10;                    Text(&#10;                        text = &quot;Your account will be less secure without two-factor authentication. Are you sure you want to disable it?&quot;,&#10;                        fontFamily = AppFontFamily&#10;                    )&#10;                },&#10;                confirmButton = {&#10;                    TextButton(&#10;                        onClick = {&#10;                            isDisabling = true&#10;                            coroutineScope.launch {&#10;                                val result = MfaApi.disableMfa(user.user_id ?: &quot;&quot;)&#10;                                isDisabling = false&#10;                                showDisableDialog = false&#10;&#10;                                result.onSuccess {&#10;                                    mfaSettings = mfaSettings?.copy(mfa_enabled = false)&#10;                                }.onFailure {&#10;                                    errorMessage = it.message ?: &quot;Failed to disable MFA&quot;&#10;                                }&#10;                            }&#10;                        },&#10;                        enabled = !isDisabling&#10;                    ) {&#10;                        if (isDisabling) {&#10;                            CircularProgressIndicator(&#10;                                modifier = Modifier.size(16.dp),&#10;                                strokeWidth = 2.dp&#10;                            )&#10;                        } else {&#10;                            Text(&quot;Disable&quot;, fontFamily = AppFontFamily, color = Color(0xFFD32F2F))&#10;                        }&#10;                    }&#10;                },&#10;                dismissButton = {&#10;                    TextButton(&#10;                        onClick = { showDisableDialog = false },&#10;                        enabled = !isDisabling&#10;                    ) {&#10;                        Text(&quot;Cancel&quot;, fontFamily = AppFontFamily)&#10;                    }&#10;                }&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun BenefitItem(text: String) {&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(vertical = 4.dp),&#10;        verticalAlignment = Alignment.Top&#10;    ) {&#10;        Text(&#10;            text = text,&#10;            fontSize = 14.sp,&#10;            fontFamily = AppFontFamily,&#10;            color = Color.Black.copy(alpha = 0.8f)&#10;        )&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.Security&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.MfaApi&#10;import com.example.smartattendance.ui.components.AppHeader&#10;import com.example.smartattendance.ui.components.HeaderType&#10;import com.example.smartattendance.ui.theme.AppFontFamily&#10;import kotlinx.coroutines.launch&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MfaSettingsScreen(&#10;    user: AuthApi.User,&#10;    onBackClick: () -&gt; Unit = {},&#10;    onSetupMfa: () -&gt; Unit = {}&#10;) {&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    var mfaSettings by remember { mutableStateOf&lt;MfaApi.MfaSettings?&gt;(null) }&#10;    var isLoading by remember { mutableStateOf(true) }&#10;    var showDisableDialog by remember { mutableStateOf(false) }&#10;    var isDisabling by remember { mutableStateOf(false) }&#10;    var errorMessage by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    // Load MFA settings&#10;    LaunchedEffect(Unit) {&#10;        val result = MfaApi.getMfaSettings(user.user_id ?: &quot;&quot;)&#10;        isLoading = false&#10;        result.onSuccess { settings -&gt;&#10;            mfaSettings = settings&#10;        }.onFailure {&#10;            errorMessage = it.message ?: &quot;Failed to load MFA settings&quot;&#10;        }&#10;    }&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(Color(0xFFF6F6F6))&#10;    ) {&#10;        // Use AppHeader component&#10;        AppHeader(&#10;            title = &quot;MFA Settings&quot;,&#10;            headerType = HeaderType.BACK,&#10;            onBackClick = onBackClick,&#10;            showIcon = false&#10;        )&#10;&#10;        if (isLoading) {&#10;            Box(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(16.dp),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                CircularProgressIndicator(color = Color(0xFF2C2D32))&#10;            }&#10;        } else {&#10;            Column(&#10;                modifier = Modifier&#10;                    .fillMaxSize()&#10;                    .padding(24.dp)&#10;                    .verticalScroll(rememberScrollState())&#10;            ) {&#10;                // Status Card&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = CardDefaults.cardColors(&#10;                        containerColor = if (mfaSettings?.mfa_enabled == true)&#10;                            Color(0xFFE8F5E9)&#10;                        else&#10;                            Color(0xFFFFF3E0)&#10;                    )&#10;                ) {&#10;                    Row(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(16.dp),&#10;                        verticalAlignment = Alignment.CenterVertically&#10;                    ) {&#10;                        Box(&#10;                            modifier = Modifier&#10;                                .size(48.dp)&#10;                                .background(&#10;                                    color = if (mfaSettings?.mfa_enabled == true)&#10;                                        Color(0xFF4CAF50).copy(alpha = 0.2f)&#10;                                    else&#10;                                        Color(0xFFFF9800).copy(alpha = 0.2f),&#10;                                    shape = RoundedCornerShape(24.dp)&#10;                                ),&#10;                            contentAlignment = Alignment.Center&#10;                        ) {&#10;                            Icon(&#10;                                imageVector = Icons.Default.Security,&#10;                                contentDescription = &quot;Security&quot;,&#10;                                tint = if (mfaSettings?.mfa_enabled == true)&#10;                                    Color(0xFF4CAF50)&#10;                                else&#10;                                    Color(0xFFFF9800),&#10;                                modifier = Modifier.size(24.dp)&#10;                            )&#10;                        }&#10;&#10;                        Spacer(modifier = Modifier.width(16.dp))&#10;&#10;                        Column(modifier = Modifier.weight(1f)) {&#10;                            Text(&#10;                                text = if (mfaSettings?.mfa_enabled == true)&#10;                                    &quot;MFA Enabled&quot;&#10;                                else&#10;                                    &quot;MFA Disabled&quot;,&#10;                                fontSize = 18.sp,&#10;                                fontWeight = FontWeight.Bold,&#10;                                fontFamily = AppFontFamily,&#10;                                color = Color.Black&#10;                            )&#10;                            Text(&#10;                                text = if (mfaSettings?.mfa_enabled == true)&#10;                                    &quot;Your account is protected&quot;&#10;                                else&#10;                                    &quot;Enable for extra security&quot;,&#10;                                fontSize = 14.sp,&#10;                                fontFamily = AppFontFamily,&#10;                                color = Color.Gray&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;&#10;                // Information&#10;                Text(&#10;                    text = &quot;About Two-Factor Authentication&quot;,&#10;                    fontSize = 16.sp,&#10;                    fontWeight = FontWeight.Bold,&#10;                    fontFamily = AppFontFamily,&#10;                    color = Color.Black&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(12.dp))&#10;&#10;                Text(&#10;                    text = &quot;Two-factor authentication (2FA) adds an extra layer of security to your account. &quot; +&#10;                            &quot;In addition to your password, you'll need to enter a code from your authenticator app when logging in.&quot;,&#10;                    fontSize = 14.sp,&#10;                    fontFamily = AppFontFamily,&#10;                    color = Color.Gray,&#10;                    lineHeight = 20.sp&#10;                )&#10;&#10;                Spacer(modifier = Modifier.height(24.dp))&#10;&#10;                // Benefits&#10;                Card(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = CardDefaults.cardColors(containerColor = Color(0xFFF5F5F5))&#10;                ) {&#10;                    Column(modifier = Modifier.padding(16.dp)) {&#10;                        Text(&#10;                            text = &quot;Benefits:&quot;,&#10;                            fontSize = 14.sp,&#10;                            fontWeight = FontWeight.Bold,&#10;                            fontFamily = AppFontFamily,&#10;                            color = Color.Black&#10;                        )&#10;                        Spacer(modifier = Modifier.height(8.dp))&#10;                        BenefitItem(&quot; Enhanced account security&quot;)&#10;                        BenefitItem(&quot;️ Protection against unauthorized access&quot;)&#10;                        BenefitItem(&quot; Works with Google Authenticator, Authy, etc.&quot;)&#10;                        BenefitItem(&quot; Backup codes for emergency access&quot;)&#10;                    }&#10;                }&#10;&#10;                Spacer(modifier = Modifier.height(32.dp))&#10;&#10;                if (errorMessage.isNotEmpty()) {&#10;                    Card(&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .padding(bottom = 16.dp),&#10;                        colors = CardDefaults.cardColors(containerColor = Color(0xFFFFEBEE))&#10;                    ) {&#10;                        Text(&#10;                            text = errorMessage,&#10;                            fontSize = 14.sp,&#10;                            color = Color(0xFFD32F2F),&#10;                            modifier = Modifier.padding(12.dp),&#10;                            fontFamily = AppFontFamily&#10;                        )&#10;                    }&#10;                }&#10;&#10;                // Action Button&#10;                if (mfaSettings?.mfa_enabled == true) {&#10;                    OutlinedButton(&#10;                        onClick = { showDisableDialog = true },&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .height(48.dp),&#10;                        shape = RoundedCornerShape(24.dp),&#10;                        colors = ButtonDefaults.outlinedButtonColors(&#10;                            contentColor = Color(0xFFD32F2F)&#10;                        ),&#10;                        enabled = !isDisabling&#10;                    ) {&#10;                        if (isDisabling) {&#10;                            CircularProgressIndicator(&#10;                                modifier = Modifier.size(20.dp),&#10;                                color = Color(0xFFD32F2F),&#10;                                strokeWidth = 2.dp&#10;                            )&#10;                        } else {&#10;                            Text(&#10;                                text = &quot;Disable Two-Factor Authentication&quot;,&#10;                                fontSize = 16.sp,&#10;                                fontFamily = AppFontFamily&#10;                            )&#10;                        }&#10;                    }&#10;&#10;                    // Show remaining backup codes count&#10;                    mfaSettings?.backup_codes?.let { codes -&gt;&#10;                        if (codes.isNotEmpty()) {&#10;                            Spacer(modifier = Modifier.height(16.dp))&#10;                            Text(&#10;                                text = &quot;You have ${codes.size} backup code${if (codes.size != 1) &quot;s&quot; else &quot;&quot;} remaining&quot;,&#10;                                fontSize = 14.sp,&#10;                                fontFamily = AppFontFamily,&#10;                                color = Color.Gray,&#10;                                modifier = Modifier.fillMaxWidth()&#10;                            )&#10;                        }&#10;                    }&#10;                } else {&#10;                    Button(&#10;                        onClick = onSetupMfa,&#10;                        modifier = Modifier&#10;                            .fillMaxWidth()&#10;                            .height(56.dp),&#10;                        shape = RoundedCornerShape(16.dp),&#10;                        colors = ButtonDefaults.buttonColors(containerColor = Color(0xFF2C2D32)),&#10;                        elevation = ButtonDefaults.buttonElevation(0.dp)&#10;                    ) {&#10;                        Text(&#10;                            text = &quot;Enable Two-Factor Authentication&quot;,&#10;                            fontSize = 16.sp,&#10;                            fontFamily = AppFontFamily,&#10;                            fontWeight = FontWeight.SemiBold&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        // Disable MFA Confirmation Dialog&#10;        if (showDisableDialog) {&#10;            AlertDialog(&#10;                onDismissRequest = { if (!isDisabling) showDisableDialog = false },&#10;                title = {&#10;                    Text(&#10;                        text = &quot;Disable Two-Factor Authentication?&quot;,&#10;                        fontFamily = AppFontFamily,&#10;                        fontWeight = FontWeight.Bold&#10;                    )&#10;                },&#10;                text = {&#10;                    Text(&#10;                        text = &quot;Your account will be less secure without two-factor authentication. Are you sure you want to disable it?&quot;,&#10;                        fontFamily = AppFontFamily&#10;                    )&#10;                },&#10;                confirmButton = {&#10;                    TextButton(&#10;                        onClick = {&#10;                            isDisabling = true&#10;                            coroutineScope.launch {&#10;                                val result = MfaApi.disableMfa(user.user_id ?: &quot;&quot;)&#10;                                isDisabling = false&#10;                                showDisableDialog = false&#10;&#10;                                result.onSuccess {&#10;                                    mfaSettings = mfaSettings?.copy(mfa_enabled = false)&#10;                                }.onFailure {&#10;                                    errorMessage = it.message ?: &quot;Failed to disable MFA&quot;&#10;                                }&#10;                            }&#10;                        },&#10;                        enabled = !isDisabling&#10;                    ) {&#10;                        if (isDisabling) {&#10;                            CircularProgressIndicator(&#10;                                modifier = Modifier.size(16.dp),&#10;                                strokeWidth = 2.dp&#10;                            )&#10;                        } else {&#10;                            Text(&quot;Disable&quot;, fontFamily = AppFontFamily, color = Color(0xFFD32F2F))&#10;                        }&#10;                    }&#10;                },&#10;                dismissButton = {&#10;                    TextButton(&#10;                        onClick = { showDisableDialog = false },&#10;                        enabled = !isDisabling&#10;                    ) {&#10;                        Text(&quot;Cancel&quot;, fontFamily = AppFontFamily)&#10;                    }&#10;                }&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun BenefitItem(text: String) {&#10;    Row(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(vertical = 4.dp),&#10;        verticalAlignment = Alignment.Top&#10;    ) {&#10;        Text(&#10;            text = text,&#10;            fontSize = 14.sp,&#10;            fontFamily = AppFontFamily,&#10;            color = Color.Black.copy(alpha = 0.8f)&#10;        )&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaSetupScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaSetupScreen.kt" />
              <option name="updatedContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import android.graphics.Bitmap&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.ContentCopy&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.asImageBitmap&#10;import androidx.compose.ui.platform.LocalClipboardManager&#10;import androidx.compose.ui.text.AnnotatedString&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.MfaApi&#10;import com.example.smartattendance.ui.components.AppHeader&#10;import com.example.smartattendance.ui.components.HeaderType&#10;import com.example.smartattendance.ui.theme.AppFontFamily&#10;import com.example.smartattendance.utils.QRCodeGenerator&#10;import kotlinx.coroutines.launch&#10;&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MfaSetupScreen(&#10;    user: AuthApi.User,&#10;    onBackClick: () -&gt; Unit = {},&#10;    onSetupComplete: () -&gt; Unit = {}&#10;) {&#10;    val coroutineScope = rememberCoroutineScope()&#10;    val clipboardManager = LocalClipboardManager.current&#10;&#10;    var secret by remember { mutableStateOf(MfaApi.generateSecret()) }&#10;    var backupCodes by remember { mutableStateOf(MfaApi.generateBackupCodes()) }&#10;    var qrCodeBitmap by remember { mutableStateOf&lt;Bitmap?&gt;(null) }&#10;    var verificationCode by remember { mutableStateOf(&quot;&quot;) }&#10;    var isVerifying by remember { mutableStateOf(false) }&#10;    var errorMessage by remember { mutableStateOf(&quot;&quot;) }&#10;    var setupStep by remember { mutableStateOf(1) }&#10;    var showCopiedMessage by remember { mutableStateOf(false) }&#10;&#10;    LaunchedEffect(secret) {&#10;        val uri = MfaApi.getTOTPUri(secret, user.email, &quot;SmartAttendance&quot;)&#10;        qrCodeBitmap = QRCodeGenerator.generateQRCode(uri)&#10;    }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(Color(0xFFF6F6F6))&#10;    ) {&#10;        AppHeader(&#10;            title = &quot;Setup MFA&quot;,&#10;            headerType = HeaderType.BACK,&#10;            onBackClick = onBackClick,&#10;            showIcon = false&#10;        )&#10;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp)&#10;                .verticalScroll(rememberScrollState()),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            // Step indicator&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.Center,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                StepIndicator(1, setupStep, &quot;Scan QR&quot;)&#10;                HorizontalDivider(&#10;                    modifier = Modifier.width(40.dp).padding(horizontal = 8.dp),&#10;                    color = if (setupStep &gt; 1) Color(0xFF2C2D32) else Color.LightGray&#10;                )&#10;                StepIndicator(2, setupStep, &quot;Verify&quot;)&#10;                HorizontalDivider(&#10;                    modifier = Modifier.width(40.dp).padding(horizontal = 8.dp),&#10;                    color = if (setupStep &gt; 2) Color(0xFF2C2D32) else Color.LightGray&#10;                )&#10;                StepIndicator(3, setupStep, &quot;Backup&quot;)&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(32.dp))&#10;&#10;            when (setupStep) {&#10;                1 -&gt; Step1ScanQR(&#10;                    secret = secret,&#10;                    qrCodeBitmap = qrCodeBitmap,&#10;                    copied = showCopiedMessage,&#10;                    onCopy = {&#10;                        clipboardManager.setText(AnnotatedString(secret))&#10;                        showCopiedMessage = true&#10;                    },&#10;                    onNext = { setupStep = 2 }&#10;                )&#10;                2 -&gt; Step2Verify(&#10;                    code = verificationCode,&#10;                    error = errorMessage,&#10;                    loading = isVerifying,&#10;                    onChange = {&#10;                        if (it.length &lt;= 6 &amp;&amp; it.all { c -&gt; c.isDigit() }) {&#10;                            verificationCode = it&#10;                            errorMessage = &quot;&quot;&#10;                        }&#10;                    },&#10;                    onBack = { setupStep = 1 },&#10;                    onVerify = {&#10;                        if (verificationCode.length != 6) {&#10;                            errorMessage = &quot;Please enter 6 digits&quot;&#10;                            return@Step2Verify&#10;                        }&#10;                        isVerifying = true&#10;                        coroutineScope.launch {&#10;                            val valid = MfaApi.verifyTOTP(secret, verificationCode)&#10;                            isVerifying = false&#10;                            if (valid) {&#10;                                setupStep = 3&#10;                                errorMessage = &quot;&quot;&#10;                            } else {&#10;                                errorMessage = &quot;Invalid code&quot;&#10;                                verificationCode = &quot;&quot;&#10;                            }&#10;                        }&#10;                    }&#10;                )&#10;                3 -&gt; Step3BackupCodes(&#10;                    codes = backupCodes,&#10;                    copied = showCopiedMessage,&#10;                    error = errorMessage,&#10;                    loading = isVerifying,&#10;                    onCopy = {&#10;                        clipboardManager.setText(AnnotatedString(backupCodes.joinToString(&quot;\n&quot;)))&#10;                        showCopiedMessage = true&#10;                    },&#10;                    onComplete = {&#10;                        isVerifying = true&#10;                        coroutineScope.launch {&#10;                            MfaApi.enableMfa(user.user_id ?: &quot;&quot;, secret, backupCodes).onSuccess {&#10;                                onSetupComplete()&#10;                            }.onFailure {&#10;                                errorMessage = it.message ?: &quot;Failed&quot;&#10;                                isVerifying = false&#10;                            }&#10;                        }&#10;                    }&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun StepIndicator(step: Int, current: Int, label: String) {&#10;    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;        Box(&#10;            modifier = Modifier&#10;                .size(44.dp)&#10;                .background(&#10;                    if (step &lt;= current) Color(0xFF2C2D32) else Color(0xFFE5E7EB),&#10;                    RoundedCornerShape(22.dp)&#10;                ),&#10;            contentAlignment = Alignment.Center&#10;        ) {&#10;            Text(&#10;                if (step &lt; current) &quot;✓&quot; else &quot;$step&quot;,&#10;                color = if (step &lt;= current) Color.White else Color(0xFF94A3B8),&#10;                fontSize = 16.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                fontFamily = AppFontFamily&#10;            )&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;        Text(&#10;            label,&#10;            fontSize = 12.sp,&#10;            fontFamily = AppFontFamily,&#10;            color = if (step &lt;= current) Color(0xFF2C2D32) else Color(0xFF94A3B8)&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun Step1ScanQR(&#10;    secret: String,&#10;    qrCodeBitmap: Bitmap?,&#10;    copied: Boolean,&#10;    onCopy: () -&gt; Unit,&#10;    onNext: () -&gt; Unit&#10;) {&#10;    Text(&#10;        &quot;Scan QR Code&quot;,&#10;        fontSize = 24.sp,&#10;        fontWeight = FontWeight.Bold,&#10;        fontFamily = AppFontFamily,&#10;        color = Color(0xFF1E293B)&#10;    )&#10;    Spacer(Modifier.height(8.dp))&#10;    Text(&#10;        &quot;Scan this QR code with your authenticator app&quot;,&#10;        fontSize = 14.sp,&#10;        fontFamily = AppFontFamily,&#10;        color = Color(0xFF64748B),&#10;        textAlign = TextAlign.Center&#10;    )&#10;    Spacer(Modifier.height(24.dp))&#10;&#10;    qrCodeBitmap?.let {&#10;        Card(&#10;            modifier = Modifier.size(260.dp),&#10;            elevation = CardDefaults.cardElevation(4.dp),&#10;            colors = CardDefaults.cardColors(Color.White),&#10;            shape = RoundedCornerShape(16.dp)&#10;        ) {&#10;            Box(&#10;                modifier = Modifier.fillMaxSize().padding(20.dp),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Image(&#10;                    bitmap = it.asImageBitmap(),&#10;                    contentDescription = &quot;QR Code&quot;,&#10;                    modifier = Modifier.fillMaxSize()&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    Spacer(Modifier.height(24.dp))&#10;&#10;    Text(&#10;        &quot;Or enter this code manually:&quot;,&#10;        fontSize = 14.sp,&#10;        fontFamily = AppFontFamily,&#10;        fontWeight = FontWeight.Medium,&#10;        color = Color(0xFF1E293B)&#10;    )&#10;    Spacer(Modifier.height(12.dp))&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(Color(0xFFF8F9FA)),&#10;        elevation = CardDefaults.cardElevation(0.dp),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier.fillMaxWidth().padding(16.dp),&#10;            horizontalArrangement = Arrangement.SpaceBetween,&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Text(&#10;                text = secret.chunked(4).joinToString(&quot; &quot;),&#10;                fontSize = 16.sp,&#10;                fontFamily = AppFontFamily,&#10;                fontWeight = FontWeight.Medium,&#10;                color = Color(0xFF1E293B),&#10;                modifier = Modifier.weight(1f)&#10;            )&#10;            IconButton(onClick = onCopy) {&#10;                Icon(&#10;                    imageVector = Icons.Default.ContentCopy,&#10;                    contentDescription = &quot;Copy&quot;,&#10;                    tint = Color(0xFF2C2D32)&#10;                )&#10;            }&#10;        }&#10;    }&#10;&#10;    if (copied) {&#10;        Spacer(Modifier.height(8.dp))&#10;        Text(&#10;            &quot;✓ Copied to clipboard&quot;,&#10;            fontSize = 13.sp,&#10;            color = Color(0xFF10B981),&#10;            fontFamily = AppFontFamily,&#10;            fontWeight = FontWeight.Medium,&#10;            modifier = Modifier.fillMaxWidth(),&#10;            textAlign = TextAlign.Center&#10;        )&#10;    }&#10;&#10;    Spacer(Modifier.height(32.dp))&#10;&#10;    Button(&#10;        onClick = onNext,&#10;        modifier = Modifier.fillMaxWidth().height(56.dp),&#10;        shape = RoundedCornerShape(16.dp),&#10;        colors = ButtonDefaults.buttonColors(Color(0xFF2C2D32)),&#10;        elevation = ButtonDefaults.buttonElevation(0.dp)&#10;    ) {&#10;        Text(&#10;            &quot;Next&quot;,&#10;            fontSize = 16.sp,&#10;            fontFamily = AppFontFamily,&#10;            fontWeight = FontWeight.SemiBold&#10;        )&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun Step2Verify(&#10;    code: String,&#10;    error: String,&#10;    loading: Boolean,&#10;    onChange: (String) -&gt; Unit,&#10;    onBack: () -&gt; Unit,&#10;    onVerify: () -&gt; Unit&#10;) {&#10;    Text(&#10;        &quot;Verify Code&quot;,&#10;        fontSize = 24.sp,&#10;        fontWeight = FontWeight.Bold,&#10;        fontFamily = AppFontFamily,&#10;        color = Color(0xFF1E293B)&#10;    )&#10;    Spacer(Modifier.height(8.dp))&#10;    Text(&#10;        &quot;Enter the 6-digit code from your authenticator app&quot;,&#10;        fontSize = 14.sp,&#10;        fontFamily = AppFontFamily,&#10;        color = Color(0xFF64748B),&#10;        textAlign = TextAlign.Center&#10;    )&#10;    Spacer(Modifier.height(32.dp))&#10;&#10;    if (error.isNotEmpty()) {&#10;        Card(&#10;            modifier = Modifier.fillMaxWidth().padding(bottom = 16.dp),&#10;            colors = CardDefaults.cardColors(Color(0xFFFEF2F2)),&#10;            elevation = CardDefaults.cardElevation(0.dp),&#10;            shape = RoundedCornerShape(12.dp)&#10;        ) {&#10;            Text(&#10;                error,&#10;                fontSize = 14.sp,&#10;                color = Color(0xFFEF4444),&#10;                modifier = Modifier.padding(16.dp),&#10;                fontFamily = AppFontFamily&#10;            )&#10;        }&#10;    }&#10;&#10;    OutlinedTextField(&#10;        value = code,&#10;        onValueChange = onChange,&#10;        modifier = Modifier.fillMaxWidth(),&#10;        label = {&#10;            Text(&#10;                &quot;6-digit code&quot;,&#10;                fontFamily = AppFontFamily,&#10;                fontSize = 14.sp&#10;            )&#10;        },&#10;        singleLine = true,&#10;        enabled = !loading,&#10;        colors = OutlinedTextFieldDefaults.colors(&#10;            focusedBorderColor = Color(0xFF2C2D32),&#10;            unfocusedBorderColor = Color(0xFFE5E7EB),&#10;            focusedLabelColor = Color(0xFF2C2D32)&#10;        ),&#10;        shape = RoundedCornerShape(12.dp)&#10;    )&#10;&#10;    Spacer(Modifier.height(32.dp))&#10;&#10;    Row(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        horizontalArrangement = Arrangement.spacedBy(12.dp)&#10;    ) {&#10;        OutlinedButton(&#10;            onClick = onBack,&#10;            modifier = Modifier.weight(1f).height(56.dp),&#10;            shape = RoundedCornerShape(16.dp),&#10;            enabled = !loading,&#10;            colors = ButtonDefaults.outlinedButtonColors(&#10;                contentColor = Color(0xFF2C2D32)&#10;            )&#10;        ) {&#10;            Text(&#10;                &quot;Back&quot;,&#10;                fontFamily = AppFontFamily,&#10;                fontWeight = FontWeight.SemiBold&#10;            )&#10;        }&#10;&#10;        Button(&#10;            onClick = onVerify,&#10;            modifier = Modifier.weight(1f).height(56.dp),&#10;            shape = RoundedCornerShape(16.dp),&#10;            colors = ButtonDefaults.buttonColors(Color(0xFF2C2D32)),&#10;            enabled = !loading &amp;&amp; code.length == 6,&#10;            elevation = ButtonDefaults.buttonElevation(0.dp)&#10;        ) {&#10;            if (loading) {&#10;                CircularProgressIndicator(&#10;                    modifier = Modifier.size(20.dp),&#10;                    color = Color.White,&#10;                    strokeWidth = 2.dp&#10;                )&#10;            } else {&#10;                Text(&#10;                    &quot;Verify&quot;,&#10;                    fontSize = 16.sp,&#10;                    fontFamily = AppFontFamily,&#10;                    fontWeight = FontWeight.SemiBold&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun Step3BackupCodes(&#10;    codes: List&lt;String&gt;,&#10;    copied: Boolean,&#10;    error: String,&#10;    loading: Boolean,&#10;    onCopy: () -&gt; Unit,&#10;    onComplete: () -&gt; Unit&#10;) {&#10;    Text(&#10;        &quot;Save Backup Codes&quot;,&#10;        fontSize = 24.sp,&#10;        fontWeight = FontWeight.Bold,&#10;        fontFamily = AppFontFamily,&#10;        color = Color(0xFF1E293B)&#10;    )&#10;    Spacer(Modifier.height(8.dp))&#10;    Text(&#10;        &quot;Save these codes in a safe place for emergency access&quot;,&#10;        fontSize = 14.sp,&#10;        fontFamily = AppFontFamily,&#10;        color = Color(0xFF64748B),&#10;        textAlign = TextAlign.Center&#10;    )&#10;    Spacer(Modifier.height(24.dp))&#10;&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(Color(0xFFFEF3C7)),&#10;        elevation = CardDefaults.cardElevation(0.dp),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Row(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Text(&quot;⚠️&quot;, fontSize = 24.sp, modifier = Modifier.padding(end = 12.dp))&#10;            Text(&#10;                &quot;Save these codes in a safe place! You can use them if you lose your phone.&quot;,&#10;                fontSize = 13.sp,&#10;                fontFamily = AppFontFamily,&#10;                color = Color(0xFF92400E),&#10;                lineHeight = 18.sp&#10;            )&#10;        }&#10;    }&#10;&#10;    Spacer(Modifier.height(20.dp))&#10;&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(Color(0xFFF8F9FA)),&#10;        elevation = CardDefaults.cardElevation(0.dp),&#10;        shape = RoundedCornerShape(12.dp)&#10;    ) {&#10;        Column(modifier = Modifier.padding(20.dp)) {&#10;            codes.chunked(2).forEach { row -&gt;&#10;                Row(&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    horizontalArrangement = Arrangement.SpaceEvenly&#10;                ) {&#10;                    row.forEach {&#10;                        Text(&#10;                            it,&#10;                            fontSize = 15.sp,&#10;                            fontFamily = AppFontFamily,&#10;                            fontWeight = FontWeight.Medium,&#10;                            color = Color(0xFF1E293B),&#10;                            modifier = Modifier.padding(vertical = 6.dp)&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    Spacer(Modifier.height(16.dp))&#10;&#10;    OutlinedButton(&#10;        onClick = onCopy,&#10;        modifier = Modifier.fillMaxWidth().height(48.dp),&#10;        shape = RoundedCornerShape(12.dp),&#10;        colors = ButtonDefaults.outlinedButtonColors(&#10;            contentColor = Color(0xFF2C2D32)&#10;        )&#10;    ) {&#10;        Icon(&#10;            imageVector = Icons.Default.ContentCopy,&#10;            contentDescription = &quot;Copy&quot;,&#10;            modifier = Modifier.size(20.dp)&#10;        )&#10;        Spacer(Modifier.width(8.dp))&#10;        Text(&#10;            &quot;Copy All Codes&quot;,&#10;            fontFamily = AppFontFamily,&#10;            fontWeight = FontWeight.SemiBold&#10;        )&#10;    }&#10;&#10;    if (copied) {&#10;        Spacer(Modifier.height(8.dp))&#10;        Text(&#10;            &quot;✓ Copied to clipboard&quot;,&#10;            fontSize = 13.sp,&#10;            color = Color(0xFF10B981),&#10;            fontFamily = AppFontFamily,&#10;            fontWeight = FontWeight.Medium,&#10;            modifier = Modifier.fillMaxWidth(),&#10;            textAlign = TextAlign.Center&#10;        )&#10;    }&#10;&#10;    Spacer(Modifier.height(32.dp))&#10;&#10;    Button(&#10;        onClick = onComplete,&#10;        modifier = Modifier.fillMaxWidth().height(56.dp),&#10;        shape = RoundedCornerShape(16.dp),&#10;        colors = ButtonDefaults.buttonColors(Color(0xFF2C2D32)),&#10;        enabled = !loading,&#10;        elevation = ButtonDefaults.buttonElevation(0.dp)&#10;    ) {&#10;        if (loading) {&#10;            CircularProgressIndicator(&#10;                modifier = Modifier.size(20.dp),&#10;                color = Color.White,&#10;                strokeWidth = 2.dp&#10;            )&#10;        } else {&#10;            Text(&#10;                &quot;Complete Setup&quot;,&#10;                fontSize = 16.sp,&#10;                fontFamily = AppFontFamily,&#10;                fontWeight = FontWeight.SemiBold&#10;            )&#10;        }&#10;    }&#10;&#10;    if (error.isNotEmpty()) {&#10;        Spacer(Modifier.height(16.dp))&#10;        Card(&#10;            modifier = Modifier.fillMaxWidth(),&#10;            colors = CardDefaults.cardColors(Color(0xFFFEF2F2)),&#10;            elevation = CardDefaults.cardElevation(0.dp),&#10;            shape = RoundedCornerShape(12.dp)&#10;        ) {&#10;            Text(&#10;                error,&#10;                fontSize = 14.sp,&#10;                color = Color(0xFFEF4444),&#10;                modifier = Modifier.padding(16.dp),&#10;                fontFamily = AppFontFamily&#10;            )&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaVerifyScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/smartattendance/ui/screens/MfaVerifyScreen.kt" />
              <option name="updatedContent" value="package com.example.smartattendance.ui.screens&#10;&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.rememberScrollState&#10;import androidx.compose.foundation.shape.RoundedCornerShape&#10;import androidx.compose.foundation.verticalScroll&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.text.style.TextAlign&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.smartattendance.api.AuthApi&#10;import com.example.smartattendance.api.MfaApi&#10;import com.example.smartattendance.ui.components.AppHeader&#10;import com.example.smartattendance.ui.components.HeaderType&#10;import com.example.smartattendance.ui.theme.AppFontFamily&#10;import kotlinx.coroutines.launch&#10;&#10;@Composable&#10;fun MfaVerifyScreen(&#10;    user: AuthApi.User,&#10;    onVerificationSuccess: () -&gt; Unit = {},&#10;    onBackClick: () -&gt; Unit = {}&#10;) {&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    var verificationCode by remember { mutableStateOf(&quot;&quot;) }&#10;    var isVerifying by remember { mutableStateOf(false) }&#10;    var errorMessage by remember { mutableStateOf(&quot;&quot;) }&#10;    var useBackupCode by remember { mutableStateOf(false) }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .background(Color(0xFFF6F6F6))&#10;    ) {&#10;        AppHeader(&#10;            title = &quot;Two-Factor Authentication&quot;,&#10;            headerType = HeaderType.BACK,&#10;            onBackClick = onBackClick,&#10;            showIcon = false&#10;        )&#10;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(24.dp)&#10;                .verticalScroll(rememberScrollState()),&#10;            horizontalAlignment = Alignment.CenterHorizontally,&#10;            verticalArrangement = Arrangement.Center&#10;        ) {&#10;            // Icon&#10;            Box(&#10;                modifier = Modifier&#10;                    .size(80.dp)&#10;                    .background(&#10;                        color = Color(0xFF2C2D32).copy(alpha = 0.1f),&#10;                        shape = RoundedCornerShape(40.dp)&#10;                    ),&#10;                contentAlignment = Alignment.Center&#10;            ) {&#10;                Text(&#10;                    text = &quot;&quot;,&#10;                    fontSize = 40.sp&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(24.dp))&#10;&#10;            Text(&#10;                text = if (useBackupCode)&#10;                    &quot;Enter one of your backup codes&quot;&#10;                else&#10;                    &quot;Enter the 6-digit code from your authenticator app&quot;,&#10;                fontSize = 14.sp,&#10;                fontFamily = AppFontFamily,&#10;                color = Color(0xFF64748B),&#10;                textAlign = TextAlign.Center,&#10;                lineHeight = 20.sp&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(32.dp))&#10;&#10;            if (errorMessage.isNotEmpty()) {&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(bottom = 16.dp),&#10;                    colors = CardDefaults.cardColors(containerColor = Color(0xFFFEF2F2)),&#10;                    elevation = CardDefaults.cardElevation(0.dp),&#10;                    shape = RoundedCornerShape(12.dp)&#10;                ) {&#10;                    Text(&#10;                        text = errorMessage,&#10;                        fontSize = 14.sp,&#10;                        color = Color(0xFFEF4444),&#10;                        modifier = Modifier.padding(16.dp),&#10;                        fontFamily = AppFontFamily&#10;                    )&#10;                }&#10;            }&#10;&#10;            OutlinedTextField(&#10;                value = verificationCode,&#10;                onValueChange = {&#10;                    if (useBackupCode) {&#10;                        if (it.length &lt;= 9) {&#10;                            verificationCode = it.uppercase()&#10;                            errorMessage = &quot;&quot;&#10;                        }&#10;                    } else {&#10;                        if (it.length &lt;= 6 &amp;&amp; it.all { char -&gt; char.isDigit() }) {&#10;                            verificationCode = it&#10;                            errorMessage = &quot;&quot;&#10;                        }&#10;                    }&#10;                },&#10;                modifier = Modifier.fillMaxWidth(),&#10;                label = {&#10;                    Text(&#10;                        if (useBackupCode) &quot;Backup code&quot; else &quot;6-digit code&quot;,&#10;                        fontFamily = AppFontFamily,&#10;                        fontSize = 14.sp&#10;                    )&#10;                },&#10;                placeholder = {&#10;                    Text(&#10;                        if (useBackupCode) &quot;XXXX-XXXX&quot; else &quot;000000&quot;,&#10;                        fontFamily = AppFontFamily,&#10;                        color = Color(0xFFCBD5E1)&#10;                    )&#10;                },&#10;                singleLine = true,&#10;                enabled = !isVerifying,&#10;                colors = OutlinedTextFieldDefaults.colors(&#10;                    focusedBorderColor = Color(0xFF2C2D32),&#10;                    unfocusedBorderColor = Color(0xFFE5E7EB),&#10;                    focusedLabelColor = Color(0xFF2C2D32)&#10;                ),&#10;                shape = RoundedCornerShape(12.dp)&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(12.dp))&#10;&#10;            TextButton(&#10;                onClick = {&#10;                    useBackupCode = !useBackupCode&#10;                    verificationCode = &quot;&quot;&#10;                    errorMessage = &quot;&quot;&#10;                },&#10;                enabled = !isVerifying&#10;            ) {&#10;                Text(&#10;                    text = if (useBackupCode) &quot;Use authenticator code&quot; else &quot;Use backup code&quot;,&#10;                    fontFamily = AppFontFamily,&#10;                    color = Color(0xFF2C2D32),&#10;                    fontWeight = FontWeight.Medium,&#10;                    fontSize = 14.sp&#10;                )&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(24.dp))&#10;&#10;            Button(&#10;                onClick = {&#10;                    if (verificationCode.isEmpty()) {&#10;                        errorMessage = &quot;Please enter a code&quot;&#10;                        return@Button&#10;                    }&#10;                    if (!useBackupCode &amp;&amp; verificationCode.length != 6) {&#10;                        errorMessage = &quot;Please enter a 6-digit code&quot;&#10;                        return@Button&#10;                    }&#10;&#10;                    isVerifying = true&#10;                    coroutineScope.launch {&#10;                        val result = MfaApi.verifyMfaCode(user.user_id ?: &quot;&quot;, verificationCode)&#10;                        isVerifying = false&#10;&#10;                        result.onSuccess { isValid -&gt;&#10;                            if (isValid) {&#10;                                onVerificationSuccess()&#10;                            } else {&#10;                                errorMessage = &quot;Invalid code. Please try again.&quot;&#10;                                verificationCode = &quot;&quot;&#10;                            }&#10;                        }.onFailure {&#10;                            errorMessage = it.message ?: &quot;Verification failed&quot;&#10;                            verificationCode = &quot;&quot;&#10;                        }&#10;                    }&#10;                },&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .height(56.dp),&#10;                shape = RoundedCornerShape(16.dp),&#10;                colors = ButtonDefaults.buttonColors(containerColor = Color(0xFF2C2D32)),&#10;                enabled = !isVerifying &amp;&amp; verificationCode.isNotEmpty(),&#10;                elevation = ButtonDefaults.buttonElevation(0.dp)&#10;            ) {&#10;                if (isVerifying) {&#10;                    CircularProgressIndicator(&#10;                        modifier = Modifier.size(20.dp),&#10;                        color = Color.White,&#10;                        strokeWidth = 2.dp&#10;                    )&#10;                } else {&#10;                    Text(&#10;                        text = &quot;Verify&quot;,&#10;                        fontSize = 16.sp,&#10;                        fontFamily = AppFontFamily,&#10;                        fontWeight = FontWeight.SemiBold&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/database_functions.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/database_functions.sql" />
              <option name="updatedContent" value="-- ==============================&#10;-- STORED PROCEDURES FOR STATISTICS&#10;-- ==============================&#10;&#10;-- Function untuk mendapatkan statistik keseluruhan user&#10;CREATE OR REPLACE FUNCTION get_user_statistics(p_user_id VARCHAR)&#10;RETURNS TABLE(&#10;    total_present BIGINT,&#10;    total_late BIGINT, &#10;    total_absent BIGINT,&#10;    total_meetings BIGINT,&#10;    attendance_percentage NUMERIC&#10;) AS $$&#10;BEGIN&#10;    RETURN QUERY&#10;    SELECT &#10;        COALESCE(SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END), 0) as total_present,&#10;        COALESCE(SUM(CASE WHEN a.status = 'late' THEN 1 ELSE 0 END), 0) as total_late,&#10;        COALESCE(SUM(CASE WHEN a.status = 'absent' THEN 1 ELSE 0 END), 0) as total_absent,&#10;        COALESCE(COUNT(a.attendance_id), 0) as total_meetings,&#10;        COALESCE(&#10;            ROUND(&#10;                SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END) * 100.0 / &#10;                NULLIF(COUNT(a.attendance_id), 0), &#10;                2&#10;            ), &#10;            0&#10;        ) as attendance_percentage&#10;    FROM enrollments e&#10;    LEFT JOIN attendances a ON e.enrollment_id = a.enrollment_id&#10;    WHERE e.user_id = p_user_id;&#10;END;&#10;$$ LANGUAGE plpgsql;&#10;&#10;-- Function untuk mendapatkan statistik per mata kuliah&#10;CREATE OR REPLACE FUNCTION get_course_statistics(p_user_id VARCHAR)&#10;RETURNS TABLE(&#10;    course_code VARCHAR,&#10;    course_name VARCHAR,&#10;    total_pertemuan BIGINT,&#10;    hadir BIGINT,&#10;    terlambat BIGINT,&#10;    tidak_hadir BIGINT,&#10;    persentase_kehadiran NUMERIC&#10;) AS $$&#10;BEGIN&#10;    RETURN QUERY&#10;    SELECT &#10;        c.course_code,&#10;        c.course_name,&#10;        COUNT(a.attendance_id) as total_pertemuan,&#10;        SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END) as hadir,&#10;        SUM(CASE WHEN a.status = 'late' THEN 1 ELSE 0 END) as terlambat,&#10;        SUM(CASE WHEN a.status = 'absent' THEN 1 ELSE 0 END) as tidak_hadir,&#10;        ROUND(&#10;            SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END) * 100.0 / &#10;            NULLIF(COUNT(a.attendance_id), 0), &#10;            2&#10;        ) as persentase_kehadiran&#10;    FROM enrollments e&#10;    JOIN courses c ON e.course_id = c.course_id&#10;    LEFT JOIN attendances a ON e.enrollment_id = a.enrollment_id&#10;    WHERE e.user_id = p_user_id&#10;    GROUP BY c.course_code, c.course_name, c.course_id&#10;    ORDER BY c.course_code;&#10;END;&#10;$$ LANGUAGE plpgsql;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>